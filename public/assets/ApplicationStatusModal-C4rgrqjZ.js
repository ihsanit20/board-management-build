import{r as y,i as B,C as D,b as E,d,c as u,a as t,y as n,t as l,j as b,S as f,F as T,e as U,n as C,h as j}from"./index-_aqdL-fb.js";import{u as z}from"./application-CM_hhmWK.js";const F={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},L={class:"card-bg max-w-xl w-full p-6 space-y-5"},R={class:"rounded-lg border p-3 bg-white/60"},q={class:"grid grid-cols-2 gap-2 text-sm"},X={class:"flex items-center gap-6"},Z={class:"inline-flex items-center gap-2"},G={class:"inline-flex items-center gap-2"},H={class:"space-y-3"},J={key:0,class:"text-sm text-gray-600"},K={key:1,class:"text-sm text-red-600"},O={key:2,class:"max-h-60 overflow-y-auto space-y-2"},Q=["value"],W={class:"text-sm"},Y={class:"flex flex-wrap items-center gap-2"},$={class:"font-medium"},tt={class:"px-2 py-0.5 rounded-full text-xs bg-gray-100"},et={class:"px-2 py-0.5 rounded-full text-xs bg-gray-100"},st={class:"mt-1"},nt={__name:"ApplicationStatusModal",props:{applicationId:{required:!0}},emits:["data-updated"],setup(h,{emit:A}){const o=z(),p=h,I=A,i=y("Paid"),v=y([]),g=y(null),x=y(!1),r=B(()=>o.applications.find(a=>a.id===p.applicationId)||{}),_=()=>{o.showStatusModal=!1},w=a=>{var m;const e=Number(((m=r.value)==null?void 0:m.total_amount)||0),c=Number((a==null?void 0:a.amount)||0);return(a==null?void 0:a.status)==="Completed"&&c>=e},M=async()=>{if(p.applicationId){x.value=!0;try{const a=await o.fetchMatchingPayments(p.applicationId);v.value=a}finally{x.value=!1}}};D(()=>o.showStatusModal,a=>{a&&(i.value="Paid",g.value=null,M())},{immediate:!1});const N=async()=>{try{await o.updatePaymentStatus(p.applicationId,{payment_status:i.value,payment_id:g.value||null}),I("data-updated")}catch(a){console.error("Error updating status:",a)}finally{_()}};return(a,e)=>{var c,m,k,P;return E(o).showStatusModal?(d(),u("div",F,[t("div",L,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold text-gray-800 text-center"}," এই নিবন্ধনটি গ্রহণ করা হবে — আপনি কি টাকা পেয়েছেন? ",-1)),t("div",R,[t("div",q,[t("div",null,[e[3]||(e[3]=t("strong",null,"Application #:",-1)),n(" "+l((c=r.value)==null?void 0:c.id),1)]),t("div",null,[e[4]||(e[4]=t("strong",null,"Total Amount:",-1)),n(" "+l((m=r.value)==null?void 0:m.total_amount),1)]),t("div",null,[e[5]||(e[5]=t("strong",null,"Institute:",-1)),n(" "+l((k=r.value)==null?void 0:k.institute_code_name),1)]),t("div",null,[e[6]||(e[6]=t("strong",null,"Zamat:",-1)),n(" "+l((P=r.value)==null?void 0:P.zamat_name),1)])])]),t("div",X,[t("label",Z,[b(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=s=>i.value=s),value:"Paid"},null,512),[[f,i.value]]),e[7]||(e[7]=t("span",null,"হ্যা (Paid)",-1))]),t("label",G,[b(t("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),value:"Pending"},null,512),[[f,i.value]]),e[8]||(e[8]=t("span",null,"না (Pending)",-1))])]),t("div",H,[e[12]||(e[12]=t("div",{class:"font-semibold"},"ম্যাচিং পেমেন্ট সিলেক্ট করুন",-1)),x.value?(d(),u("div",J,"লোড হচ্ছে...")):v.value.length?(d(),u("div",O,[(d(!0),u(T,null,U(v.value,s=>{var S;return d(),u("label",{key:s.id,class:"flex items-start gap-3 rounded-lg border p-3 hover:bg-gray-50"},[b(t("input",{type:"radio",name:"payment",value:s.id,"onUpdate:modelValue":e[2]||(e[2]=V=>g.value=V)},null,8,Q),[[f,g.value]]),t("div",W,[t("div",Y,[t("span",$,"#"+l(s.id),1),t("span",{class:C(["px-2 py-0.5 rounded-full text-xs",{"bg-green-100 text-green-700":s.status==="Completed","bg-yellow-100 text-yellow-700":s.status==="Pending","bg-red-100 text-red-700":s.status==="Failed"}])},l(s.status),3),t("span",tt,l(s.payment_method),1),t("span",et,l(new Date(s.paid_at).toLocaleString("bn-BD")||"—"),1),t("span",{class:C(["px-2 py-0.5 rounded-full text-xs",w(s)?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-600"])},l(w(s)?"Eligible to link":"Not eligible to link"),3)]),t("div",st,[e[9]||(e[9]=t("strong",null,"Amount:",-1)),n(" "+l(s.amount)+" | ",1),e[10]||(e[10]=t("strong",null,"TRX:",-1)),n(" "+l(s.trx_id||"—")+" | ",1),e[11]||(e[11]=t("strong",null,"User:",-1)),n(" "+l(((S=s.user)==null?void 0:S.name)||"—"),1)])])])}),128))])):(d(),u("div",K," কোনো ম্যাচিং পেমেন্ট পাওয়া যায়নি। ")),e[13]||(e[13]=t("p",{class:"text-xs text-gray-500"},[n(" নোট: কেবলমাত্র "),t("em",null,"Completed"),n(" ও "),t("em",null,"Amount ≥ Application Total"),n(" হলে পেমেন্ট লিঙ্ক হবে। অন্যসব ক্ষেত্রে স্ট্যাটাস আপডেট হবে, কিন্তু পেমেন্ট লিঙ্ক স্কিপ হবে। ")],-1))]),t("div",{class:"flex justify-end gap-3"},[t("button",{onClick:_,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition"}," Close "),t("button",{onClick:N,class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition"}," Save ")])])])):j("",!0)}}};export{nt as _};
