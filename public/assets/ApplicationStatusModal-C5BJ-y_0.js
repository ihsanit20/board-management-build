import{r as y,i as p,C as U,d as m,c,a as e,y as n,t as l,j as b,S as _,F,e as L,n as N,h as R}from"./index-DcmbdSU1.js";import{u as Z}from"./application-De7w0uz5.js";const q={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},O={class:"card-bg max-w-xl w-full p-6 space-y-5"},X={class:"rounded-lg border p-3 bg-white/60"},G={class:"grid grid-cols-2 gap-2 text-sm"},H={class:"flex items-center gap-6"},J={class:"inline-flex items-center gap-2"},K={class:"inline-flex items-center gap-2"},Q={class:"space-y-3"},W={key:0,class:"text-sm text-gray-600"},Y={key:1,class:"text-sm text-red-600"},$={key:2,class:"max-h-60 overflow-y-auto space-y-2"},tt=["value"],et={class:"text-sm"},at={class:"flex flex-wrap items-center gap-2"},st={class:"font-medium"},lt={class:"px-2 py-0.5 rounded-full text-xs bg-gray-100"},nt={class:"px-2 py-0.5 rounded-full text-xs bg-gray-100"},ot={class:"mt-1"},ut={__name:"ApplicationStatusModal",props:{applicationId:{type:[Number,String],required:!0},show:{type:Boolean,default:null}},emits:["data-updated","close"],setup(B,{emit:M}){const o=Z(),i=B,w=M,r=y("Paid"),x=y([]),g=y(null),f=y(!1),A=p(()=>typeof i.show=="boolean"?i.show:o.showStatusModal),d=p(()=>{const a=Number(i.applicationId),t=(o.applications||[]).find(u=>Number(u.id)===a),s=o.application&&Number(o.application.id)===a?o.application:null;return t||s||null}),V=p(()=>{var a;return((a=d.value)==null?void 0:a.id)??i.applicationId}),h=p(()=>{var a;return Number(((a=d.value)==null?void 0:a.total_amount)??0)}),T=p(()=>{var u,v,P,S,C;const a=(u=d.value)==null?void 0:u.institute_code_name,t=(P=(v=d.value)==null?void 0:v.institute)==null?void 0:P.institute_code,s=(C=(S=d.value)==null?void 0:S.institute)==null?void 0:C.name;return a||(t||s?[t,s].filter(Boolean).join(" - "):"—")}),j=p(()=>{var a,t,s;return((a=d.value)==null?void 0:a.zamat_name)||((s=(t=d.value)==null?void 0:t.zamat)==null?void 0:s.name)||"—"}),k=()=>{w("close"),o.showStatusModal=!1},I=a=>{const t=h.value||0,s=Number((a==null?void 0:a.amount)||0);return(a==null?void 0:a.status)==="Completed"&&s>=t},z=async()=>{if(i.applicationId){f.value=!0;try{const a=await o.fetchMatchingPayments(i.applicationId);x.value=Array.isArray(a)?a:[]}finally{f.value=!1}}},D=async()=>{if(!d.value&&i.applicationId)try{await o.fetchApplication(i.applicationId)}catch{}};U(()=>A.value,async a=>{a&&(r.value="Paid",g.value=null,await D(),await z())},{immediate:!1});const E=async()=>{try{await o.updatePaymentStatus(i.applicationId,{payment_status:r.value,payment_id:g.value||null}),w("data-updated")}catch(a){console.error("Error updating status:",a)}finally{k()}};return(a,t)=>A.value?(m(),c("div",q,[e("div",O,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold text-gray-800 text-center"}," এই নিবন্ধনটি গ্রহণ করা হবে — আপনি কি টাকা পেয়েছেন? ",-1)),e("div",X,[e("div",G,[e("div",null,[t[3]||(t[3]=e("strong",null,"Application #:",-1)),n(" "+l(V.value),1)]),e("div",null,[t[4]||(t[4]=e("strong",null,"Total Amount:",-1)),n(" "+l(h.value),1)]),e("div",null,[t[5]||(t[5]=e("strong",null,"Institute:",-1)),n(" "+l(T.value),1)]),e("div",null,[t[6]||(t[6]=e("strong",null,"Zamat:",-1)),n(" "+l(j.value),1)])])]),e("div",H,[e("label",J,[b(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),value:"Paid"},null,512),[[_,r.value]]),t[7]||(t[7]=e("span",null,"হ্যা (Paid)",-1))]),e("label",K,[b(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),value:"Pending"},null,512),[[_,r.value]]),t[8]||(t[8]=e("span",null,"না (Pending)",-1))])]),e("div",Q,[t[12]||(t[12]=e("div",{class:"font-semibold"},"ম্যাচিং পেমেন্ট সিলেক্ট করুন",-1)),f.value?(m(),c("div",W,"লোড হচ্ছে...")):x.value.length?(m(),c("div",$,[(m(!0),c(F,null,L(x.value,s=>{var u;return m(),c("label",{key:s.id,class:"flex items-start gap-3 rounded-lg border p-3 hover:bg-gray-50"},[b(e("input",{type:"radio",name:"payment",value:s.id,"onUpdate:modelValue":t[2]||(t[2]=v=>g.value=v)},null,8,tt),[[_,g.value]]),e("div",et,[e("div",at,[e("span",st,"#"+l(s.id),1),e("span",{class:N(["px-2 py-0.5 rounded-full text-xs",{"bg-green-100 text-green-700":s.status==="Completed","bg-yellow-100 text-yellow-700":s.status==="Pending","bg-red-100 text-red-700":s.status==="Failed"}])},l(s.status),3),e("span",lt,l(s.payment_method),1),e("span",nt,l(s.paid_at?new Date(s.paid_at).toLocaleString("bn-BD"):"—"),1),e("span",{class:N(["px-2 py-0.5 rounded-full text-xs",I(s)?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-600"])},l(I(s)?"Eligible to link":"Not eligible to link"),3)]),e("div",ot,[t[9]||(t[9]=e("strong",null,"Amount:",-1)),n(" "+l(s.amount)+" | ",1),t[10]||(t[10]=e("strong",null,"TRX:",-1)),n(" "+l(s.trx_id||"—")+" | ",1),t[11]||(t[11]=e("strong",null,"User:",-1)),n(" "+l(((u=s.user)==null?void 0:u.name)||"—"),1)])])])}),128))])):(m(),c("div",Y," কোনো ম্যাচিং পেমেন্ট পাওয়া যায়নি। ")),t[13]||(t[13]=e("p",{class:"text-xs text-gray-500"},[n(" নোট: কেবলমাত্র "),e("em",null,"Completed"),n(" ও "),e("em",null,"Amount ≥ Application Total"),n(" হলে পেমেন্ট লিঙ্ক হবে। অন্যসব ক্ষেত্রে স্ট্যাটাস আপডেট হবে, কিন্তু পেমেন্ট লিঙ্ক স্কিপ হবে। ")],-1))]),e("div",{class:"flex justify-end gap-3"},[e("button",{onClick:k,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition"}," Close "),e("button",{onClick:E,class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition"}," Save ")])])])):R("",!0)}};export{ut as _};
