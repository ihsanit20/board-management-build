import{A as q,r,o as P,i as U,B as $,c as i,a as t,t as l,b as g,m as D,C as G,F as _,e as E,v as H,D as J,z as n,f as O,w as Q,h as v,x as X,M as Y,j as ee,p as te,y as le,d as u,L as se}from"./index-CyA6YVnO.js";import{u as ne}from"./zamat-DHWWPpLk.js";import{u as oe}from"./student-DYn1VZRD.js";import{u as ae}from"./collect-fee-BBpVZW20.js";import{u as ue}from"./fee-Ci1FUoIW.js";const ie={class:"my-container"},de={class:"space-y-2 p-2"},re={class:"card-bg p-4"},ce={class:"title-lg text-center"},ve={class:"grid md:grid-cols-3 gap-4"},pe=["value"],me={key:0,class:"card-bg items-center py-8"},be={class:"flex justify-center items-center text-3xl text-green-600"},ge={key:1,class:"flex justify-center items-center text-3xl text-red-500 py-8"},fe={key:1,class:"card-bg p-4"},xe={class:"title-md"},ye={key:3,class:"space-y-2"},ke={key:0,class:"card-bg p-4"},Se={key:1,class:"flex gap-2"},he={key:2,class:"space-y-2"},Ce=["onClick"],Le={class:"md:col-span-3 md:flex items-center gap-2 space-y-2 md:space-y-0"},we={class:""},Be=["value","checked"],De={class:""},_e={class:""},Fe={class:"md:col-span-2"},Re={class:"md:col-span-1 md:px-2"},Ve={class:"md:col-span-1 md:px-2 md:text-end"},ze={key:3,class:"card-bg"},Me={key:4,class:"card-bg p-4"},We={__name:"CollectFee",setup(Ae){const k=q(),L=ne(),w=oe(),T=ae(),F=ue(),K=te(),R=r(!0),f=r(!1),S=r(""),p=r(""),c=r([]),a=r([]),x=r(0),m=r(null),B=r(!0),h=r(0),V=r(!1),{success:z,error:M}=K.query;P(async()=>{try{f.value=!0,await Promise.all([k.fetchLastExam(),L.fetchZamats(),F.fetchFees()])}finally{f.value=!1}});const y=U(()=>{var e,d;const s=F.fees.find(b=>{var o;return b.exam_id===((o=k.exam)==null?void 0:o.id)});return((d=(e=s==null?void 0:s.zamat_amounts)==null?void 0:e.find(b=>b.zamat_id===p.value))==null?void 0:d.amount)||0}),C=()=>{const s=a.value.length*y.value;h.value=Math.round(s*.01),x.value=Math.round(s+h.value)};$(p,()=>{c.value=[],a.value=[],C()});const W=()=>{B.value?a.value=c.value.map(s=>s.id):a.value=[],C()},Z=s=>{a.value.includes(s)?a.value=a.value.filter(e=>e!==s):a.value.push(s),C()},A=async()=>{if(!p.value||!S.value){alert("মারহালা সিলেক্ট করুন এবং ইলহাক নাম্বার দিয়ে অনুসন্ধান করুন।");return}f.value=!0,V.value=!0;try{await w.fetchStudentsWithoutRollNumber({instituteCode:S.value,zamatId:p.value}),R.value=!1,m.value=w.institute||null,c.value=w.students,a.value=c.value.map(s=>s.id),C()}catch(s){console.error("ডাটা ফেচ করতে সমস্যা হচ্ছে:",s)}finally{f.value=!1}},N=async()=>{var s,e;if(!a.value.length||!x.value){console.log("সকল শিক্ষার্থী এবং মোট ফি এমাউন্ট নির্বাচন করুন।");return}console.log(m.value);try{const d=await T.createCollectFee({student_ids:a.value,total_amount:x.value,payment_method:"online",exam_id:(s=k.exam)==null?void 0:s.id,institute_id:(e=m.value)==null?void 0:e.id,zamat_id:p.value});console.log(d),d!=null&&d.success?(localStorage.setItem("ToReturn","CollectFee"),window.location=d.bkashURL):(console.error("bKash URL not found or response not successful."),console.log("Full Response:",d))}catch(d){console.error("Error during fee collection:",d)}},j=U(()=>{const s=L.zamats.find(e=>e.id===p.value);return s?s.name:"মারহালা নির্বাচন করা হয়নি"});return(s,e)=>{var b;const d=le("RouterLink");return u(),i("div",ie,[t("div",de,[t("div",re,[t("h1",ce,l((b=g(k).exam)==null?void 0:b.name)+"-এর ফি প্রদান",1),t("div",ve,[t("div",null,[D(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),class:"text-black input-1 px-2 py-1 text-center"},[e[3]||(e[3]=t("option",{value:"",selected:"",disabled:""},"- মারহালা সিলেক্ট করুন -",-1)),(u(!0),i(_,null,E(g(L).zamats,o=>(u(),i("option",{key:o.id,value:o.id},l(o.name),9,pe))),128))],512),[[G,p.value]])]),t("div",null,[D(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>S.value=o),type:"text",class:"input-1 w-full text-black px-3 py-1 text-center",placeholder:"ইলহাক নং",onKeyup:J(A,["enter"])},null,544),[[H,S.value]])]),t("div",{class:"w-full"},[t("button",{onClick:A,class:"btn-2 w-full"},e[4]||(e[4]=[t("i",{class:"fas fa-search"},null,-1),n(" অনুসন্ধান ")]))])])]),R.value?(u(),i(_,{key:0},[g(z)?(u(),i("div",me,[t("div",be,l(g(z)),1),O(d,{to:{name:"StudentWithRoll"},class:"btn-link"},{default:Q(()=>e[5]||(e[5]=[n(" পরিক্ষার্থী তালিকা দেখুন ")])),_:1})])):v("",!0),g(M)?(u(),i("div",ge,l(g(M)),1)):v("",!0)],64)):v("",!0),m.value?(u(),i("div",fe,[t("h2",xe,l(m.value.name),1),t("p",null,[e[6]||(e[6]=t("b",null,"ইলহাক:",-1)),n(" "+l(m.value.institute_code),1)]),t("p",null,[e[7]||(e[7]=t("b",null,"ফোন:",-1)),n(" "+l(m.value.phone),1)])])):v("",!0),f.value?(u(),X(se,{key:2})):(u(),i("div",ye,[c.value.length?(u(),i("div",ke,[t("p",null,[e[8]||(e[8]=n(" মারহালা: ")),t("b",null,l(j.value),1)]),t("p",null,[e[9]||(e[9]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,l(a.value.length.toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[10]||(e[10]=n(" প্রতি শিক্ষার্থী ফি: ")),t("b",null,l(y.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[11]||(e[11]=n(" মোট ফি: ")),t("b",null,l((a.value.length*y.value).toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[12]||(e[12]=n(" সার্ভিস চার্জ (১%): ")),t("b",null,l(h.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[13]||(e[13]=n(" সার্ভিস চার্জ সহ জমা : ")),t("b",null,l(x.value.toLocaleString("bn-BD"))+" ৳",1)]),t("div",{class:"flex justify-center"},[t("button",{onClick:N,class:"btn-2"},e[14]||(e[14]=[t("i",{class:"fas fa-money-bill-wave"},null,-1),n(" ফি প্রদান (বিকাশ) ")]))])])):v("",!0),c.value.length?(u(),i("div",Se,[D(t("input",{type:"checkbox",id:"selectAllCheckbox","onUpdate:modelValue":e[2]||(e[2]=o=>B.value=o),onChange:W},null,544),[[Y,B.value]]),e[15]||(e[15]=t("label",{for:"selectAllCheckbox"},"সব সিলেক্ট",-1))])):v("",!0),c.value.length?(u(),i("div",he,[e[21]||(e[21]=ee('<div class="bg-gray-400 text-white md:grid md:grid-cols-7 p-4 hidden rounded-md"><p class="md:col-span-3 px-2">পরীক্ষার্থীর নাম</p><p class="md:col-span-2 px-2">পিতার নাম</p><p class="md:col-span-1 px-2">জন্ম তারিখ</p><p class="md:col-span-1 px-2 md:text-end">রেজি. নং</p></div>',1)),(u(!0),i(_,null,E(c.value,(o,I)=>(u(),i("div",{key:o.id,onClick:Ne=>Z(o.id),class:"cursor-pointer card-bg grid relative md:grid-cols-7 p-4"},[t("div",Le,[t("div",we,[t("input",{type:"checkbox",value:o.id,checked:a.value.includes(o.id),class:"text-center"},null,8,Be)]),t("p",De,[e[16]||(e[16]=t("b",{class:"inline-block md:hidden"},"ক্র:",-1)),n(" "+l((I+1).toLocaleString("bn-BD"))+". ",1)]),t("p",_e,[e[17]||(e[17]=t("b",{class:"inline-block md:hidden"},"নাম:",-1)),n(" "+l(o.name),1)])]),t("p",Fe,[e[18]||(e[18]=t("b",{class:"inline-block md:hidden"},"পিতা:",-1)),n(" "+l(o.father_name),1)]),t("p",Re,[e[19]||(e[19]=t("b",{class:"inline-block md:hidden"},"জন্ম তারিখ:",-1)),n(" "+l(new Date(o.date_of_birth).toLocaleDateString("bn-BD")),1)]),t("p",Ve,[e[20]||(e[20]=t("b",{class:"inline-block md:hidden"},"রেজি. নং:",-1)),n(" "+l(o.registration_number),1)])],8,Ce))),128))])):v("",!0),V.value&&!c.value.length?(u(),i("div",ze,e[22]||(e[22]=[t("p",{class:"text-center text-red-500 py-6"}," ফি জমার জন্য কোন পরীক্ষার্থীর তথ্য পাওয়া যায়নি ",-1)]))):v("",!0),c.value.length?(u(),i("div",Me,[t("p",null,[e[23]||(e[23]=n(" মারহালা: ")),t("b",null,l(j.value),1)]),t("p",null,[e[24]||(e[24]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,l(a.value.length.toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[25]||(e[25]=n(" প্রতি শিক্ষার্থী ফি: ")),t("b",null,l(y.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[26]||(e[26]=n(" মোট ফি: ")),t("b",null,l((a.value.length*y.value).toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[27]||(e[27]=n(" সার্ভিস চার্জ (১%): ")),t("b",null,l(h.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[28]||(e[28]=n(" সার্ভিস চার্জ সহ জমা : ")),t("b",null,l(x.value.toLocaleString("bn-BD"))+" ৳",1)]),t("div",{class:"flex justify-center"},[t("button",{onClick:N,class:"btn-2"},e[29]||(e[29]=[t("i",{class:"fas fa-money-bill-wave"},null,-1),n(" ফি প্রদান (বিকাশ) ")]))])])):v("",!0)]))])])}}};export{We as default};
