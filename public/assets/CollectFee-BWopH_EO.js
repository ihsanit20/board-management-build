import{r as m,o as G,C as P,i as b,c as u,a as t,b as S,t as s,k as n,j as z,D as q,F as R,e as $,v as H,G as I,m as J,h as p,N as O,s as Q,f as W,w as X,l as Y,d as i,y as ee,p as te,L as le}from"./index-CBPYhcDR.js";import{u as se}from"./zamat-BfJiESFX.js";import{u as ne}from"./registered-student-5v3rbxXh.js";import{u as ae}from"./collect-fee-Bz7pXWb8.js";import{u as oe}from"./fee-Dhtd7C02.js";const ie={class:"my-container"},ue={class:"space-y-2 p-2"},re={class:"card-bg p-4"},de={key:0},ve={class:"title-lg text-center"},ce={class:"md:flex gap-4 justify-center text-sm"},me={key:1,class:"text-center"},pe={class:"grid md:grid-cols-3 gap-4"},be=["value"],ge={key:1,class:"space-y-2"},fe={key:0,class:"card-bg p-4"},xe={class:"title-md"},ye={key:0},ke={key:0},Se={key:1,class:"flex gap-2"},De={key:2,class:"space-y-2"},Le=["onClick"],_e={class:"md:col-span-3 md:flex items-center gap-2 space-y-2 md:space-y-0"},Be=["value","checked"],he={class:"md:col-span-2"},we={class:"md:col-span-1 md:px-2"},Fe={class:"md:col-span-1 md:px-2 md:text-end"},Ce={key:3,class:"card-bg"},Ne={key:4,class:"card-bg"},Ve={key:5,class:"card-bg p-4"},ze={key:0},Ae={class:"flex justify-center"},Ke={__name:"CollectFee",setup(Me){const _=se(),D=ne(),U=ae(),v=oe(),Z=te(),E=m(!0),g=m(!1),f=m(""),c=m(""),d=m([]),o=m([]),x=m(null),B=m(!0),h=m(!1),w=l=>alert(`ত্রুটি: ${l}`);G(async()=>{try{g.value=!0,await _.fetchZamats(),await v.fetchLatestFee()}catch(l){w("ডাটা লোড করতে সমস্যা হয়েছে।"),console.error(l)}finally{g.value=!1}}),P(c,()=>{d.value=[],o.value=[]});const K=()=>{B.value?o.value=d.value.map(l=>l.id):o.value=[]},T=l=>{o.value.includes(l)?o.value=o.value.filter(e=>e!==l):o.value.push(l)},A=async()=>{var l;if(!c.value||!f.value){alert("মারহালা সিলেক্ট করুন এবং ইলহাক নাম্বার দিয়ে অনুসন্ধান করুন।");return}g.value=!0,h.value=!0;try{await D.fetchRegisteredStudents({exam_id:(l=v.lastFee)==null?void 0:l.exam_id,zamat_id:Number(c.value),institute_code:f.value,sort:"registration",dir:"asc"});const e=D.students||[];E.value=!1,x.value=D.institute?{...D.institute}:null,d.value=e.map(r=>({id:r.registration,name:r.name,father_name:r.father_name,date_of_birth:r.date_of_birth,registration_number:r.registration})),o.value=d.value.map(r=>r.id)}catch(e){w(`ডাটা ফেচ করতে সমস্যা হচ্ছে: ${e.message}`),console.error(e)}finally{g.value=!1}},M=async()=>{var l;if(!((l=o.value)!=null&&l.length)||!L.value){alert("সকল পরীক্ষার্থী এবং মোট ফি এমাউন্ট নির্বাচন করুন।");return}try{await U.createCollectFee({registrations:o.value,total_amount:L.value,payment_method:"offline",exam_id:v.lastFee.exam_id,institute_code:f.value,zamat_id:Number(c.value)}),alert("ফি জমা সফল হয়েছে!"),Z.push({name:"CollectFeeList"})}catch(e){w(`ফি জমার সময় সমস্যা হয়েছে: ${e.message}`),console.error(e)}},j=b(()=>{const l=_.zamats.find(e=>Number(e.id)===Number(c.value));return l?l.name:"মারহালা নির্বাচন করা হয়নি"}),F=b(()=>{var e;const l=(e=v.lastFee)==null?void 0:e.zamat_amounts.find(r=>Number(r.zamat_id)===Number(c.value));return(l==null?void 0:l.amount)||0}),y=b(()=>{var k,a;const l=(k=v.lastFee)==null?void 0:k.zamat_amounts.find(V=>Number(V.zamat_id)===Number(c.value)),e=new Date((a=v.lastFee)==null?void 0:a.last_date);return new Date>e&&(l==null?void 0:l.late_fee)||0}),C=b(()=>{var l;return((l=o.value)==null?void 0:l.length)*F.value}),N=b(()=>{var l;return((l=o.value)==null?void 0:l.length)*y.value}),L=b(()=>C.value+N.value);return(l,e)=>{var k;const r=Y("RouterLink");return i(),u("div",ie,[t("div",ue,[t("div",re,[S(v).lastFee?(i(),u("div",de,[t("h1",ve,s(((k=S(v).lastFee.exam)==null?void 0:k.name)||"পরীক্ষার নাম নেই")+"-এর ফি প্রদান ",1),t("div",ce,[t("p",null,[e[4]||(e[4]=n(" ফি জমার শেষ তারিখ: ")),t("b",null,s(new Date(S(v).lastFee.last_date).toLocaleDateString("bn-BD")),1)]),t("p",null,[e[5]||(e[5]=n(" চূড়ান্ত তারিখ: ")),t("b",null,s(new Date(S(v).lastFee.final_date).toLocaleDateString("bn-BD")),1),e[6]||(e[6]=n(" (বিলম্ব ফি সহ) "))])])])):(i(),u("div",me,"ডাটা লোড হচ্ছে...")),t("div",pe,[t("div",null,[z(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),class:"text-black input-1 px-2 py-1 text-center"},[e[7]||(e[7]=t("option",{value:"",selected:"",disabled:""},"- মারহালা সিলেক্ট করুন -",-1)),(i(!0),u(R,null,$(S(_).zamats,a=>(i(),u("option",{key:a.id,value:a.id},s(a.name),9,be))),128))],512),[[q,c.value,void 0,{number:!0}]])]),t("div",null,[z(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),type:"text",class:"input-1 w-full text-black px-3 py-1 text-center",placeholder:"ইলহাক নং",onKeyup:I(A,["enter"])},null,544),[[H,f.value]])]),t("div",{class:"w-full"},[t("button",{onClick:A,class:"btn-2 w-full"},e[8]||(e[8]=[t("i",{class:"fas fa-search"},null,-1),n(" অনুসন্ধান ")]))])])]),g.value?(i(),J(le,{key:0})):(i(),u("div",ge,[x.value?(i(),u("div",fe,[t("div",null,[t("h2",xe,s(x.value.name),1),t("p",null,[e[9]||(e[9]=t("b",null,"ইলহাক:",-1)),n(" "+s(x.value.code),1)]),t("p",null,[e[10]||(e[10]=t("b",null,"ফোন:",-1)),n(" "+s(x.value.phone||"—"),1)])]),e[17]||(e[17]=t("hr",{class:"w-full"},null,-1)),d.value.length?(i(),u("div",ye,[t("div",null,[t("p",null,[e[11]||(e[11]=n(" মারহালা: ")),t("b",null,s(j.value),1)]),t("p",null,[e[12]||(e[12]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,s((o.value.length||0).toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[13]||(e[13]=n(" ফি: ")),t("b",null,s((F.value||0).toLocaleString("bn-BD"))+" x "+s((o.value.length||0).toLocaleString("bn-BD"))+" = "+s((C.value||0).toLocaleString("bn-BD"))+" ৳ ",1)]),y.value>0?(i(),u("p",ke,[e[14]||(e[14]=n(" বিলম্ব ফি: ")),t("b",null,s((y.value||0).toLocaleString("bn-BD"))+" x "+s((o.value.length||0).toLocaleString("bn-BD"))+" = "+s((N.value||0).toLocaleString("bn-BD"))+" ৳ ",1)])):p("",!0),t("p",null,[e[15]||(e[15]=n(" মোট জমা ")),t("b",null,s((L.value||0).toLocaleString("bn-BD"))+" ৳",1)])]),t("div",{class:"flex justify-center"},[t("button",{onClick:M,class:"btn-2"},e[16]||(e[16]=[t("i",{class:"fas fa-money-bill-wave"},null,-1),n(" ফি গ্রহণ করুন ")]))])])):p("",!0)])):p("",!0),d.value.length?(i(),u("div",Se,[z(t("input",{type:"checkbox",id:"selectAllCheckbox","onUpdate:modelValue":e[2]||(e[2]=a=>B.value=a),onChange:K},null,544),[[O,B.value]]),e[18]||(e[18]=t("label",{for:"selectAllCheckbox"},"সব সিলেক্ট",-1))])):p("",!0),d.value.length?(i(),u("div",De,[e[24]||(e[24]=Q('<div class="bg-gray-400 text-white md:grid md:grid-cols-7 p-4 hidden rounded-md"><p class="md:col-span-3 px-2">পরীক্ষার্থীর নাম</p><p class="md:col-span-2 px-2">পিতার নাম</p><p class="md:col-span-1 px-2">জন্ম তারিখ</p><p class="md:col-span-1 px-2 md:text-end">রেজি. নং</p></div>',1)),(i(!0),u(R,null,$(d.value,(a,V)=>(i(),u("div",{key:a.id,onClick:je=>T(a.id),class:"cursor-pointer card-bg grid relative md:grid-cols-7 p-4"},[t("div",_e,[t("div",null,[t("input",{type:"checkbox",value:a.id,checked:o.value.includes(a.id),class:"text-center",onClick:e[3]||(e[3]=ee(()=>{},["stop"]))},null,8,Be)]),t("p",null,[e[19]||(e[19]=t("b",{class:"inline-block md:hidden"},"ক্র:",-1)),n(" "+s((V+1).toLocaleString("bn-BD"))+". ",1)]),t("p",null,[e[20]||(e[20]=t("b",{class:"inline-block md:hidden"},"নাম:",-1)),n(" "+s(a.name),1)])]),t("p",he,[e[21]||(e[21]=t("b",{class:"inline-block md:hidden"},"পিতা:",-1)),n(" "+s(a.father_name),1)]),t("p",we,[e[22]||(e[22]=t("b",{class:"inline-block md:hidden"},"জন্ম তারিখ:",-1)),n(" "+s(new Date(a.date_of_birth).toLocaleDateString("bn-BD")),1)]),t("p",Fe,[e[23]||(e[23]=t("b",{class:"inline-block md:hidden"},"রেজি. নং:",-1)),n(" "+s(a.registration_number),1)])],8,Le))),128))])):p("",!0),h.value&&!d.value.length?(i(),u("div",Ce,e[25]||(e[25]=[t("p",{class:"text-center text-red-500 p-6"}," ফি জমার জন্য কোন পরীক্ষার্থীর তথ্য পাওয়া যায়নি। সঠিক তথ্য দিয়ে অনুসন্ধান করুন। ",-1)]))):p("",!0),!h.value&&!d.value.length?(i(),u("div",Ne,e[26]||(e[26]=[t("p",{class:"text-center p-6"}," মারহালা সিলেক্ট করে ইলহাক নাম্বার দিয়ে নিবন্ধিত পরীক্ষার্থীদের অনুসন্ধান করুন ",-1)]))):p("",!0),d.value.length?(i(),u("div",Ve,[t("div",null,[t("p",null,[e[27]||(e[27]=n(" মারহালা: ")),t("b",null,s(j.value),1)]),t("p",null,[e[28]||(e[28]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,s((o.value.length||0).toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[29]||(e[29]=n(" ফি: ")),t("b",null,s((F.value||0).toLocaleString("bn-BD"))+" x "+s((o.value.length||0).toLocaleString("bn-BD"))+" = "+s((C.value||0).toLocaleString("bn-BD"))+" ৳ ",1)]),y.value>0?(i(),u("p",ze,[e[30]||(e[30]=n(" বিলম্ব ফি: ")),t("b",null,s((y.value||0).toLocaleString("bn-BD"))+" x "+s((o.value.length||0).toLocaleString("bn-BD"))+" = "+s((N.value||0).toLocaleString("bn-BD"))+" ৳ ",1)])):p("",!0),t("p",null,[e[31]||(e[31]=n(" মোট জমা: ")),t("b",null,s((L.value||0).toLocaleString("bn-BD"))+" ৳",1)])]),t("div",{class:"flex justify-center"},[t("button",{type:"button",onClick:M,class:"btn-2"},"ফি জমা করুন")])])):p("",!0)]))]),t("div",Ae,[W(r,{to:{name:"CollectFeeList"},class:"btn-3"},{default:X(()=>e[32]||(e[32]=[n("তালিকায় যান")])),_:1})])])}}};export{Ke as default};
