import{A as q,r as d,o as P,i as j,B as $,c as i,a as t,t as l,b as g,m as B,C as G,F as D,e as U,v as H,D as J,z as n,f as O,w as Q,h as p,x as X,M as Y,j as ee,p as te,y as le,d as u,L as se}from"./index-pGQr_bJm.js";import{_ as ne}from"./bks-pmnt-le7Z3-q2.js";import{u as oe}from"./zamat-D4S9W2o9.js";import{u as ae}from"./student-Biw9R0fs.js";import{u as ue}from"./collect-fee-DeIF548C.js";import{u as ie}from"./fee-BdRLyLDn.js";const re={class:"my-container"},de={class:"space-y-2 p-2"},ce={class:"card-bg p-4"},pe={class:"title-lg text-center"},ve={class:"grid md:grid-cols-3 gap-4"},me=["value"],be={key:0,class:"card-bg items-center py-8"},ge={class:"flex justify-center items-center text-3xl text-green-600"},fe={key:1,class:"flex justify-center items-center text-3xl text-red-500 py-8"},xe={key:1,class:"card-bg p-4"},ye={class:"title-md"},ke={key:3,class:"space-y-2"},Se={key:0,class:"card-bg p-4"},he={key:1,class:"flex gap-2"},Ce={key:2,class:"space-y-2"},Le=["onClick"],we={class:"md:col-span-3 md:flex items-center gap-2 space-y-2 md:space-y-0"},_e={class:""},Be=["value","checked"],De={class:""},Fe={class:""},Re={class:"md:col-span-2"},Ve={class:"md:col-span-1 md:px-2"},ze={class:"md:col-span-1 md:px-2 md:text-end"},Me={key:3,class:"card-bg"},Ae={key:4,class:"card-bg p-4"},Ze={__name:"CollectFee",setup(Ne){const k=q(),L=oe(),w=ae(),E=ue(),F=ie(),T=te(),R=d(!0),f=d(!1),S=d(""),v=d(""),c=d([]),a=d([]),x=d(0),m=d(null),_=d(!0),h=d(0),V=d(!1),{success:z,error:M}=T.query;P(async()=>{try{f.value=!0,await Promise.all([k.fetchLastExam(),L.fetchZamats(),F.fetchFees()])}finally{f.value=!1}});const y=j(()=>{var e,r;const s=F.fees.find(b=>{var o;return parseInt(b.exam_id)===parseInt((o=k.exam)==null?void 0:o.id)});return((r=(e=s==null?void 0:s.zamat_amounts)==null?void 0:e.find(b=>parseInt(b.zamat_id)===parseInt(v.value)))==null?void 0:r.amount)||0}),C=()=>{const s=a.value.length*y.value;h.value=Math.round(s*.01),x.value=Math.round(s+h.value)};$(v,()=>{c.value=[],a.value=[],C()});const K=()=>{_.value?a.value=c.value.map(s=>s.id):a.value=[],C()},W=s=>{a.value.includes(s)?a.value=a.value.filter(e=>e!==s):a.value.push(s),C()},A=async()=>{if(!v.value||!S.value){alert("মারহালা সিলেক্ট করুন এবং ইলহাক নাম্বার দিয়ে অনুসন্ধান করুন।");return}f.value=!0,V.value=!0;try{await w.fetchStudentsWithoutRollNumber({instituteCode:S.value,zamatId:v.value}),R.value=!1,m.value=w.institute||null,c.value=w.students,a.value=c.value.map(s=>s.id),C()}catch(s){console.error("ডাটা ফেচ করতে সমস্যা হচ্ছে:",s)}finally{f.value=!1}},N=async()=>{var s,e;if(!a.value.length||!x.value){console.log("সকল শিক্ষার্থী এবং মোট ফি এমাউন্ট নির্বাচন করুন।");return}console.log(m.value);try{const r=await E.createCollectFee({student_ids:a.value,total_amount:x.value,payment_method:"online",exam_id:(s=k.exam)==null?void 0:s.id,institute_id:(e=m.value)==null?void 0:e.id,zamat_id:v.value});console.log(r),r!=null&&r.success?(localStorage.setItem("ToReturn","CollectFee"),window.location=r.bkashURL):(console.error("bKash URL not found or response not successful."),console.log("Full Response:",r))}catch(r){console.error("Error during fee collection:",r)}},I=j(()=>{const s=L.zamats.find(e=>e.id===v.value);return s?s.name:"মারহালা নির্বাচন করা হয়নি"});return(s,e)=>{var b;const r=le("RouterLink");return u(),i("div",re,[t("div",de,[t("div",ce,[t("h1",pe,l((b=g(k).exam)==null?void 0:b.name)+"-এর ফি প্রদান",1),t("div",ve,[t("div",null,[B(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),class:"text-black input-1 px-2 py-1 text-center"},[e[3]||(e[3]=t("option",{value:"",selected:"",disabled:""},"- মারহালা সিলেক্ট করুন -",-1)),(u(!0),i(D,null,U(g(L).zamats,o=>(u(),i("option",{key:o.id,value:o.id},l(o.name),9,me))),128))],512),[[G,v.value]])]),t("div",null,[B(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>S.value=o),type:"text",class:"input-1 w-full text-black px-3 py-1 text-center",placeholder:"ইলহাক নং",onKeyup:J(A,["enter"])},null,544),[[H,S.value]])]),t("div",{class:"w-full"},[t("button",{onClick:A,class:"btn-2 w-full"},e[4]||(e[4]=[t("i",{class:"fas fa-search"},null,-1),n(" অনুসন্ধান ")]))])])]),R.value?(u(),i(D,{key:0},[g(z)?(u(),i("div",be,[t("div",ge,l(g(z)),1),O(r,{to:{name:"StudentWithRoll"},class:"btn-link"},{default:Q(()=>e[5]||(e[5]=[n(" পরিক্ষার্থী তালিকা দেখুন ")])),_:1})])):p("",!0),g(M)?(u(),i("div",fe,l(g(M)),1)):p("",!0)],64)):p("",!0),m.value?(u(),i("div",xe,[t("h2",ye,l(m.value.name),1),t("p",null,[e[6]||(e[6]=t("b",null,"ইলহাক:",-1)),n(" "+l(m.value.institute_code),1)]),t("p",null,[e[7]||(e[7]=t("b",null,"ফোন:",-1)),n(" "+l(m.value.phone),1)])])):p("",!0),f.value?(u(),X(se,{key:2})):(u(),i("div",ke,[c.value.length?(u(),i("div",Se,[t("p",null,[e[8]||(e[8]=n(" মারহালা: ")),t("b",null,l(I.value),1)]),t("p",null,[e[9]||(e[9]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,l(a.value.length.toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[10]||(e[10]=n(" প্রতি শিক্ষার্থী ফি: ")),t("b",null,l(y.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[11]||(e[11]=n(" মোট ফি: ")),t("b",null,l((a.value.length*y.value).toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[12]||(e[12]=n(" সার্ভিস চার্জ (১%): ")),t("b",null,l(h.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[13]||(e[13]=n(" সার্ভিস চার্জ সহ জমা : ")),t("b",null,l(x.value.toLocaleString("bn-BD"))+" ৳",1)]),t("div",{class:"flex justify-center"},[t("button",{onClick:N,class:"btn-2"},e[14]||(e[14]=[t("i",{class:"fas fa-money-bill-wave"},null,-1),n(" ফি প্রদান (বিকাশ) ")]))])])):p("",!0),c.value.length?(u(),i("div",he,[B(t("input",{type:"checkbox",id:"selectAllCheckbox","onUpdate:modelValue":e[2]||(e[2]=o=>_.value=o),onChange:K},null,544),[[Y,_.value]]),e[15]||(e[15]=t("label",{for:"selectAllCheckbox"},"সব সিলেক্ট",-1))])):p("",!0),c.value.length?(u(),i("div",Ce,[e[21]||(e[21]=ee('<div class="bg-gray-400 text-white md:grid md:grid-cols-7 p-4 hidden rounded-md"><p class="md:col-span-3 px-2">পরীক্ষার্থীর নাম</p><p class="md:col-span-2 px-2">পিতার নাম</p><p class="md:col-span-1 px-2">জন্ম তারিখ</p><p class="md:col-span-1 px-2 md:text-end">রেজি. নং</p></div>',1)),(u(!0),i(D,null,U(c.value,(o,Z)=>(u(),i("div",{key:o.id,onClick:Ie=>W(o.id),class:"cursor-pointer card-bg grid relative md:grid-cols-7 p-4"},[t("div",we,[t("div",_e,[t("input",{type:"checkbox",value:o.id,checked:a.value.includes(o.id),class:"text-center"},null,8,Be)]),t("p",De,[e[16]||(e[16]=t("b",{class:"inline-block md:hidden"},"ক্র:",-1)),n(" "+l((Z+1).toLocaleString("bn-BD"))+". ",1)]),t("p",Fe,[e[17]||(e[17]=t("b",{class:"inline-block md:hidden"},"নাম:",-1)),n(" "+l(o.name),1)])]),t("p",Re,[e[18]||(e[18]=t("b",{class:"inline-block md:hidden"},"পিতা:",-1)),n(" "+l(o.father_name),1)]),t("p",Ve,[e[19]||(e[19]=t("b",{class:"inline-block md:hidden"},"জন্ম তারিখ:",-1)),n(" "+l(new Date(o.date_of_birth).toLocaleDateString("bn-BD")),1)]),t("p",ze,[e[20]||(e[20]=t("b",{class:"inline-block md:hidden"},"রেজি. নং:",-1)),n(" "+l(o.registration_number),1)])],8,Le))),128))])):p("",!0),V.value&&!c.value.length?(u(),i("div",Me,e[22]||(e[22]=[t("p",{class:"text-center text-red-500 py-6"}," ফি জমার জন্য কোন পরীক্ষার্থীর তথ্য পাওয়া যায়নি ",-1)]))):p("",!0),c.value.length?(u(),i("div",Ae,[t("p",null,[e[23]||(e[23]=n(" মারহালা: ")),t("b",null,l(I.value),1)]),t("p",null,[e[24]||(e[24]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,l(a.value.length.toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[25]||(e[25]=n(" প্রতি শিক্ষার্থী ফি: ")),t("b",null,l(y.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[26]||(e[26]=n(" মোট ফি: ")),t("b",null,l((a.value.length*y.value).toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[27]||(e[27]=n(" সার্ভিস চার্জ (১%): ")),t("b",null,l(h.value.toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[28]||(e[28]=n(" সার্ভিস চার্জ সহ জমা : ")),t("b",null,l(x.value.toLocaleString("bn-BD"))+" ৳",1)]),t("div",{class:"flex justify-center"},[t("button",{type:"button",onClick:N,class:"w-52 px-4 py-2 border-2 rounded-lg hover:border-pink-600"},e[29]||(e[29]=[t("img",{src:ne,alt:""},null,-1)]))]),e[30]||(e[30]=t("p",{class:"text-red-500"},[t("b",null,"বি. দ্র."),n(" কোন তথ্য ভুল থাকলে অনলাইনে ফি প্রদান না করে অফিসে স্বশরীরে উপস্থিত হয়ে তথ্য সম্পাদনা করে ফি প্রদান করুন। ")],-1))])):p("",!0)]))])])}}};export{Ze as default};
