import{d as o,c as u,a as t,k as c,t as a,F as L,e as R,m as at,w as Z,h as $,f as q,l as nt,B as rt,r as v,i as S,o as ut,C as dt,j as F,D as z,b as P,v as et,G as st,s as it,n as lt,p as pt,L as ct}from"./index-hvT126dx.js";import{u as mt}from"./collect-fee-Dl5XMWB6.js";import{u as vt}from"./zamat-H2xY0ueG.js";const xt={key:0,class:"modal-bg z-50"},yt={class:"modal-card max-w-5xl w-full"},gt={class:"space-y-4"},bt={class:"grid md:grid-cols-3 gap-3"},ht={class:"grid md:grid-cols-4 gap-3"},_t={class:"grid md:grid-cols-4 gap-3"},kt={class:"mt-4"},Ct={class:"max-h-72 overflow-y-auto"},ft={class:"w-full border-collapse border border-gray-300 text-sm"},$t={class:"border px-2 py-1 text-center"},wt={class:"border px-2 py-1"},St={class:"border px-2 py-1 text-center"},Ft={class:"border px-2 py-1 text-right"},Lt={class:"border px-2 py-1 text-right"},Vt={class:"border px-2 py-1 text-right"},Nt={class:"border px-2 py-1 text-right font-semibold"},Dt={class:"border px-2 py-1 text-center"},Pt={class:"max-h-72 overflow-y-auto"},Rt={class:"w-full border-collapse border border-gray-300 text-sm"},Ut={class:"border px-2 py-1 text-center"},Bt={class:"border px-2 py-1"},Et={class:"border px-2 py-1 text-center"},It={class:"border px-2 py-1 text-center"},jt={class:"border px-2 py-1 text-center"},Mt={__name:"CollectFeeShow",props:{visible:{type:Boolean,required:!0},payment:{type:Object,default:()=>null},items:{type:Array,default:()=>[]},students:{type:Array,default:()=>[]}},emits:["close"],setup(i,{emit:O}){const T=O,y=()=>T("close"),p=h=>Number(h??0).toFixed(2);return(h,l)=>{var k,C,g,b,x,V,N,U,B,E,f,d,m,K,G,X,I,j,A;const _=nt("RouterLink");return i.visible?(o(),u("div",xt,[t("div",yt,[t("div",{class:"flex justify-between items-center border-b pb-3"},[l[1]||(l[1]=t("h3",{class:"title-md"},"Payment Details",-1)),t("button",{onClick:y,class:"text-gray-600 hover:text-gray-800"},l[0]||(l[0]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",gt,[t("div",bt,[t("p",null,[l[2]||(l[2]=t("strong",null,"মাদ্রাসা:",-1)),c(" "+a((C=(k=i.payment)==null?void 0:k.institute)==null?void 0:C.institute_code)+" - "+a((b=(g=i.payment)==null?void 0:g.institute)==null?void 0:b.name),1)]),t("p",null,[l[3]||(l[3]=t("strong",null,"মারহালা:",-1)),c(" "+a((V=(x=i.payment)==null?void 0:x.zamat)==null?void 0:V.name),1)]),t("p",null,[l[4]||(l[4]=t("strong",null,"এক্সাম:",-1)),c(" "+a((U=(N=i.payment)==null?void 0:N.exam)==null?void 0:U.name),1)])]),t("div",ht,[t("p",null,[l[5]||(l[5]=t("strong",null,"Channel/Method:",-1)),c(" "+a((((B=i.payment)==null?void 0:B.channel)||"").toUpperCase())+" / "+a((((E=i.payment)==null?void 0:E.method)||"-").toUpperCase()),1)]),t("p",null,[l[6]||(l[6]=t("strong",null,"TRX:",-1)),c(" "+a(((f=i.payment)==null?void 0:f.trx_id)||"—"),1)]),t("p",null,[l[7]||(l[7]=t("strong",null,"Paid at:",-1)),c(" "+a(new Date(((d=i.payment)==null?void 0:d.paid_at)||((m=i.payment)==null?void 0:m.created_at)).toLocaleString()),1)]),t("p",null,[l[8]||(l[8]=t("strong",null,"Students:",-1)),c(" "+a(((K=i.payment)==null?void 0:K.students_count)??0),1)])]),t("div",_t,[t("p",null,[l[9]||(l[9]=t("strong",null,"Gross:",-1)),c(" "+a(p((G=i.payment)==null?void 0:G.gross_amount)),1)]),t("p",null,[l[10]||(l[10]=t("strong",null,"Service:",-1)),c(" "+a(p((X=i.payment)==null?void 0:X.service_charge)),1)]),t("p",null,[l[11]||(l[11]=t("strong",null,"Net:",-1)),c(" "+a(((I=i.payment)==null?void 0:I.net_amount)!=null?p((j=i.payment)==null?void 0:j.net_amount):"—"),1)]),t("p",null,[l[12]||(l[12]=t("strong",null,"Payer:",-1)),c(" "+a(((A=i.payment)==null?void 0:A.payer_msisdn)||"—"),1)])]),t("div",kt,[l[15]||(l[15]=t("h4",{class:"font-semibold mb-2"},"Line Items",-1)),t("div",Ct,[t("table",ft,[l[14]||(l[14]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{class:"border px-2 py-2"},"#"),t("th",{class:"border px-2 py-2"},"নাম"),t("th",{class:"border px-2 py-2"},"রেজি.নং"),t("th",{class:"border px-2 py-2 text-right"},"Base"),t("th",{class:"border px-2 py-2 text-right"},"Late"),t("th",{class:"border px-2 py-2 text-right"},"Discount"),t("th",{class:"border px-2 py-2 text-right"},"Net"),t("th",{class:"border px-2 py-2"},"একশন")])],-1)),t("tbody",null,[(o(!0),u(L,null,R(i.items,(n,w)=>{var D;return o(),u("tr",{key:w},[t("td",$t,a(w+1),1),t("td",wt,a(((D=n==null?void 0:n.student)==null?void 0:D.name)||"—"),1),t("td",St,a((n==null?void 0:n.registration_number)||"—"),1),t("td",Ft,a(p(n==null?void 0:n.base_amount)),1),t("td",Lt,a(p(n==null?void 0:n.late_fee)),1),t("td",Vt,a(p(n==null?void 0:n.discount)),1),t("td",Nt,a(p(n==null?void 0:n.net_amount)),1),t("td",Dt,[n!=null&&n.student_id?(o(),at(_,{key:0,to:{name:"StudentEdit",params:{id:n.student_id}},class:"btn-icon",title:"Edit Student"},{default:Z(()=>l[13]||(l[13]=[t("i",{class:"fas fa-edit"},null,-1)])),_:2},1032,["to"])):$("",!0)])])}),128))])])])]),t("div",null,[l[18]||(l[18]=t("h4",{class:"font-semibold mb-2"},"পরিক্ষার্থী তালিকা",-1)),t("div",Pt,[t("table",Rt,[l[17]||(l[17]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{class:"border px-2 py-2"},"#"),t("th",{class:"border px-2 py-2"},"নাম"),t("th",{class:"border px-2 py-2"},"রোল"),t("th",{class:"border px-2 py-2"},"রেজিস্ট্রেশন"),t("th",{class:"border px-2 py-2"},"একশন")])],-1)),t("tbody",null,[(o(!0),u(L,null,R(i.students,(n,w)=>(o(),u("tr",{key:n.id},[t("td",Ut,a(w+1),1),t("td",Bt,a(n.name),1),t("td",Et,a(n.roll_number?n.roll_number.replace(/(\\d{3})(\\d+)/,"$1-$2"):"নেই"),1),t("td",It,a(n.registration_number),1),t("td",jt,[q(_,{to:{name:"StudentEdit",params:{id:n.id}},class:"btn-icon",title:"Edit Student"},{default:Z(()=>l[16]||(l[16]=[t("i",{class:"fas fa-edit"},null,-1)])),_:2},1032,["to"])])]))),128))])])])])])])])):$("",!0)}}},zt={class:"px-4 space-y-6"},Tt={class:"flex justify-between items-center"},Kt={class:"card-bg p-4"},Gt={class:"grid grid-cols-1 md:grid-cols-6 gap-4"},Xt=["value"],At={class:"relative"},Ot=["value"],Zt={class:"relative"},qt={class:"flex items-center justify-between mt-3"},Ht={key:0,class:"text-sm text-gray-600"},Jt={class:"flex items-center gap-2"},Qt={key:0,class:"text-red-600 font-semibold"},Wt={key:2,class:"overflow-x-auto"},Yt={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},te={class:"text-gray-700 text-sm"},ee={class:"py-3 px-2"},se={class:"py-3 px-2"},le={class:"py-3 px-2 text-center"},ae={class:"py-3 px-2 text-center"},ne={class:"py-3 px-2 text-center"},oe={class:"py-3 px-2 text-center"},re={class:"py-3 px-2 text-center"},ue={class:"py-3 px-2 text-center"},de={class:"py-3 px-2 text-center"},ie={class:"flex items-center justify-center gap-4"},pe=["onClick"],ce=["onClick"],me={key:1},ve={class:"flex items-center justify-between mt-4"},xe={class:"text-sm text-gray-600"},ye={class:"flex items-center gap-2"},ge=["disabled"],be={class:"flex items-center gap-1"},he=["onClick"],_e={key:0,class:"px-2"},ke=["disabled"],we={__name:"CollectFeeList",setup(i){const O=pt(),T=vt(),y=rt(),p=mt(),h=v(!0),l=v(""),_=v(""),k=v(""),C=v(""),g=v(""),b=v(""),x=S({get:()=>p.meta.current_page||1,set:r=>p.meta.current_page=r}),V=S({get:()=>p.meta.per_page||15,set:r=>p.meta.per_page=r}),N=v(!1),U=v(null),B=v([]),E=v([]),f=S(()=>p.collectFees||[]),d=S(()=>p.meta||{current_page:1,last_page:1,total:0,per_page:15}),m=async()=>{try{h.value=!0;const r={page:x.value,per_page:V.value};l.value&&l.value!=="all"&&(r.exam_id=l.value),_.value&&(r.zamat_id=_.value),k.value&&(r.payment_method=k.value),C.value&&(r.method=C.value),g.value&&(r.institute_code=g.value),b.value&&(r.transaction_id=b.value),await p.fetchCollectFees(r)}finally{h.value=!1}};ut(async()=>{var r;await Promise.all([T.fetchZamats(),y.fetchExams(),y.fetchLastExam()]),l.value=y.lastExamId||((r=y.exam)==null?void 0:r.id)||"",await m()}),dt([()=>d.value.current_page,()=>d.value.per_page],()=>{m()});const K=async r=>{try{h.value=!0;const s=await p.fetchCollectFee(r),M=(s==null?void 0:s.data)||{};U.value=M.payment||null,B.value=M.items||[],E.value=M.students||[],N.value=!0}finally{h.value=!1}},G=r=>{O.push({name:"CollectFeeReceipt",params:{id:r}})},X=async()=>{_.value="",k.value="",C.value="",g.value="",b.value="",x.value=1,await m()},I=S(()=>d.value.current_page>1),j=S(()=>d.value.current_page<d.value.last_page),A=()=>{I.value&&(x.value=x.value-1)},n=()=>{j.value&&(x.value=x.value+1)},w=r=>{r>=1&&r<=d.value.last_page&&(x.value=r)},D=S(()=>(d.value.current_page-1)*d.value.per_page+1);return(r,s)=>{var H,J;const M=nt("RouterLink");return o(),u(L,null,[t("div",zt,[t("div",Tt,[s[10]||(s[10]=t("h1",{class:"title-lg"},"Fee Payments",-1)),q(M,{to:{name:"CollectFee"},class:"btn-2"},{default:Z(()=>s[9]||(s[9]=[c("নতুন ফি গ্রহণ")])),_:1})]),t("div",Kt,[t("div",Gt,[F(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>l.value=e),class:"input-1 text-center",onChange:m},[s[11]||(s[11]=t("option",{value:"",disabled:""},"— এক্সাম নির্বাচন করুন —",-1)),s[12]||(s[12]=t("option",{value:"all"},"— সব এক্সাম —",-1)),(o(!0),u(L,null,R(P(y).exams,e=>(o(),u("option",{key:e.id,value:e.id},a(e.name),9,Xt))),128))],544),[[z,l.value]]),t("div",At,[F(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>g.value=e),type:"text",class:"input-1 text-center",placeholder:"ইলহাক নং",onKeyup:st(m,["enter"])},null,544),[[et,g.value]]),g.value?(o(),u("button",{key:0,onClick:m,class:"absolute right-3 top-2.5"},s[13]||(s[13]=[t("i",{class:"fas fa-search"},null,-1)]))):$("",!0)]),F(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>_.value=e),class:"input-1 text-center",onChange:m},[s[14]||(s[14]=t("option",{value:""},"- সকল মারহালা -",-1)),(o(!0),u(L,null,R(P(T).zamats,e=>(o(),u("option",{key:e.id,value:e.id},a(e.name),9,Ot))),128))],544),[[z,_.value]]),F(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>k.value=e),class:"input-1 text-center",onChange:m},s[15]||(s[15]=[t("option",{value:""},"- Channel -",-1),t("option",{value:"offline"},"অফলাইন",-1),t("option",{value:"online"},"অনলাইন",-1)]),544),[[z,k.value]]),F(t("select",{"onUpdate:modelValue":s[4]||(s[4]=e=>C.value=e),class:"input-1 text-center",onChange:m},s[16]||(s[16]=[it('<option value="">- Method -</option><option value="bkash">bKash</option><option value="nagad">Nagad</option><option value="card">Card</option><option value="cash">Cash</option><option value="bank">Bank</option><option value="other">Other</option>',7)]),544),[[z,C.value]]),t("div",Zt,[F(t("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>b.value=e),type:"text",placeholder:"TRX ID",class:"input-1 text-center",onKeyup:st(m,["enter"])},null,544),[[et,b.value]]),b.value?(o(),u("button",{key:0,onClick:m,class:"absolute right-3 top-2.5"},s[17]||(s[17]=[t("i",{class:"fas fa-search"},null,-1)]))):$("",!0)])]),t("div",qt,[l.value&&l.value!=="all"?(o(),u("div",Ht,[s[18]||(s[18]=c(" বর্তমান এক্সাম: ")),t("strong",null,a(((H=P(y).exams.find(e=>e.id===Number(l.value)))==null?void 0:H.name)||((J=P(y).exam)==null?void 0:J.name)),1)])):$("",!0),t("div",Jt,[F(t("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>V.value=e),class:"input-1 w-28 text-center"},s[19]||(s[19]=[t("option",{value:10},"10",-1),t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1)]),512),[[z,V.value,void 0,{number:!0}]]),t("button",{class:"btn-ghost",onClick:X},s[20]||(s[20]=[t("i",{class:"fas fa-undo"},null,-1),c(" রিসেট")]))])])]),P(p).error?(o(),u("div",Qt,a(P(p).error),1)):$("",!0),h.value?(o(),at(ct,{key:1})):(o(),u("div",Wt,[t("table",Yt,[s[24]||(s[24]=t("thead",null,[t("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[t("th",{class:"py-3 px-2 text-left"},"#"),t("th",{class:"py-3 px-2 text-left"},"মাদ্রাসা"),t("th",{class:"py-3 px-2 text-center"},"মারহালা"),t("th",{class:"py-3 px-2 text-center"},"পরিক্ষার্থী"),t("th",{class:"py-3 px-2 text-center"},"ফি (Gross)"),t("th",{class:"py-3 px-2 text-center"},"Channel / Method"),t("th",{class:"py-3 px-2 text-center"},"TRX"),t("th",{class:"py-3 px-2 text-center"},"তারিখ"),t("th",{class:"py-3 px-2 text-center"},"একশন")])],-1)),t("tbody",te,[f.value.length?(o(!0),u(L,{key:0},R(f.value,(e,Q)=>{var W,Y,tt;return o(),u("tr",{key:e.id,class:"border-b border-gray-200 hover:bg-gray-50"},[t("td",ee,a(D.value+Q),1),t("td",se,a((W=e==null?void 0:e.institute)==null?void 0:W.institute_code)+" - "+a((Y=e==null?void 0:e.institute)==null?void 0:Y.name),1),t("td",le,a((tt=e==null?void 0:e.zamat)==null?void 0:tt.name),1),t("td",ae,a((e==null?void 0:e.students_count)??0),1),t("td",ne,a(Number((e==null?void 0:e.gross_amount)??0).toFixed(2)),1),t("td",oe,a(((e==null?void 0:e.channel)||"").toUpperCase())+" / "+a(((e==null?void 0:e.method)||"-").toUpperCase()),1),t("td",re,a((e==null?void 0:e.trx_id)||"—"),1),t("td",ue,a(new Date((e==null?void 0:e.paid_at)||(e==null?void 0:e.created_at)).toLocaleString("bn-BD",{hour12:!0})),1),t("td",de,[t("div",ie,[t("button",{onClick:ot=>K(e.id),class:"text-blue-600 hover:text-blue-800",title:"Details"},s[21]||(s[21]=[t("i",{class:"fas fa-eye"},null,-1)]),8,pe),t("button",{onClick:ot=>G(e.id),class:"text-emerald-600 hover:text-emerald-800",title:"Receipt"},s[22]||(s[22]=[t("i",{class:"fas fa-receipt"},null,-1)]),8,ce)])])])}),128)):(o(),u("tr",me,s[23]||(s[23]=[t("td",{colspan:"9",class:"text-center text-red-500 py-4"},"No payments found",-1)])))])]),t("div",ve,[t("div",xe,[s[25]||(s[25]=c(" Showing ")),t("strong",null,a(f.value.length?D.value:0)+" – "+a(f.value.length?D.value+f.value.length-1:0),1),s[26]||(s[26]=c(" of ")),t("strong",null,a(d.value.total),1)]),t("div",ye,[t("button",{class:"btn-ghost",disabled:!I.value,onClick:A},s[27]||(s[27]=[t("i",{class:"fas fa-chevron-left"},null,-1)]),8,ge),t("div",be,[(o(!0),u(L,null,R(Math.min(d.value.last_page,7),e=>(o(),u("button",{key:e,class:lt(["btn-ghost",{"btn-2":e===d.value.current_page}]),onClick:Q=>w(e)},a(e),11,he))),128)),d.value.last_page>7?(o(),u("span",_e,"…")):$("",!0),d.value.last_page>7?(o(),u("button",{key:1,class:lt(["btn-ghost",{"btn-2":d.value.last_page===d.value.current_page}]),onClick:s[7]||(s[7]=e=>w(d.value.last_page))},a(d.value.last_page),3)):$("",!0)]),t("button",{class:"btn-ghost",disabled:!j.value,onClick:n},s[28]||(s[28]=[t("i",{class:"fas fa-chevron-right"},null,-1)]),8,ke)])])]))]),q(Mt,{visible:N.value,payment:U.value,items:B.value,students:E.value,onClose:s[8]||(s[8]=e=>N.value=!1)},null,8,["visible","payment","items","students"])],64)}}};export{we as default};
