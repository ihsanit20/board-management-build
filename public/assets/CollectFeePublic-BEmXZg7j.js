import{_ as ze,r as g,i as p,o as Ie,C as Pe,c as o,a as t,t as s,h as v,f as K,w as T,m as Le,k as a,b as w,j as E,D as Me,F as we,e as Be,v as Ue,G as Ae,N as qe,s as Ke,l as Te,d as n,q as Ee,p as Ze,L as Fe}from"./index-CBPYhcDR.js";import{_ as Ge}from"./bks-pmnt-le7Z3-q2.js";import{u as We}from"./zamat-BfJiESFX.js";import{u as Xe}from"./registered-student-5v3rbxXh.js";import{u as $e}from"./collect-fee-Bz7pXWb8.js";import{u as He}from"./fee-Dhtd7C02.js";const Je={class:"my-container space-y-4 py-4"},Oe={key:0,class:"space-y-3"},Qe={key:0,class:"card-bg p-4 border border-red-300 bg-red-50/70"},Ye={class:"flex items-start justify-between gap-4"},et={class:"text-sm text-red-700/90"},tt={key:1,class:"card-bg p-4 border border-emerald-300 bg-emerald-50/60"},lt={class:"flex items-start justify-between gap-4"},st={key:0,class:"text-sm text-gray-600"},at={class:"mt-3"},nt={class:"flex justify-between items-center"},ot={key:1,class:"text-sm text-red-600"},ut={key:0,class:"mt-3"},it={class:"grid md:grid-cols-2 gap-3 text-sm"},rt={class:"space-y-1"},dt={class:"space-y-1 md:text-right"},vt={class:"grid md:grid-cols-3 gap-3 mt-3"},pt={class:"card-bg p-3"},ct={class:"text-lg font-semibold"},mt={class:"card-bg p-3"},bt={class:"text-lg font-semibold"},gt={class:"card-bg p-3"},ft={class:"text-lg font-semibold"},yt={key:1,class:"card-bg text-center text-red-500 py-4 mt-4"},xt={key:2,class:"space-y-2"},kt={class:"card-bg p-4"},_t={key:0},St={class:"title-lg text-center"},Dt={class:"md:flex gap-4 justify-center text-sm"},Lt={key:1,class:"text-center"},wt={class:"grid md:grid-cols-3 gap-4"},Bt=["value"],Ft={key:1,class:"space-y-2"},Ct={key:0,class:"card-bg p-4"},ht={class:"title-md"},Nt={key:0},Rt={key:0},Vt={key:1,class:"flex gap-2"},jt={key:2,class:"space-y-2"},zt=["onClick"],It={class:"md:col-span-3 md:flex items-center gap-2 space-y-2 md:space-y-0"},Pt=["value","checked"],Mt={class:"md:col-span-2"},Ut={class:"md:col-span-1 md:px-2"},At={class:"md:col-span-1 md:px-2 md:text-end"},qt={key:3,class:"card-bg"},Kt={key:4,class:"card-bg"},Tt={key:5,class:"card-bg p-4"},Et={key:0},Zt={class:"text-xl"},Gt={class:"card-bg items-center p-4"},Wt={class:"flex justify-center gap-4"},Xt={__name:"CollectFeePublic",setup($t){const I=We(),B=Xe(),F=$e(),c=He(),P=Ee(),Ce=Ze(),k=g(!1),f=g(""),b=g(""),m=g([]),i=g([]),y=g(null),C=g(!0),h=g(!1),Z=p(()=>{var l;return((l=P.query)==null?void 0:l.success)||null}),M=p(()=>{var l;return((l=P.query)==null?void 0:l.error)||null}),N=p(()=>{var e;const l=(e=P.query)==null?void 0:e.fee_payment_id;return l?Number(l):null}),_=g(!1),x=g(null),r=p(()=>{const l=F.receipt;return(l==null?void 0:l.data)??l??null}),U=p(()=>!!N.value||!!M.value);Ie(async()=>{var l,e;try{k.value=!0,await I.fetchZamats(),await c.fetchLatestFee()}finally{k.value=!1}if(N.value)try{_.value=!0,x.value=null,await F.fetchReceipt(N.value)}catch(u){x.value=((e=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:e.message)||(u==null?void 0:u.message)||"রশিদের ডাটা আনা যায়নি"}finally{_.value=!1}}),Pe(b,()=>{m.value=[],i.value=[]});const he=()=>{C.value?i.value=m.value.map(l=>l.id):i.value=[]},Ne=l=>{i.value.includes(l)?i.value=i.value.filter(e=>e!==l):i.value.push(l)},G=async()=>{await Ce.replace({name:"CollectFeePublic"}),f.value="",b.value="",m.value=[],i.value=[],y.value=null,h.value=!1,C.value=!0,x.value=null,_.value=!1,F.receipt=null},W=async()=>{var l;if(!b.value||!f.value){alert("মারহালা সিলেক্ট করুন এবং ইলহাক নাম্বার দিয়ে অনুসন্ধান করুন।");return}k.value=!0,h.value=!0;try{await B.fetchRegisteredStudents({exam_id:(l=c.lastFee)==null?void 0:l.exam_id,zamat_id:Number(b.value),institute_code:f.value,sort:"registration",dir:"asc"});const e=B.students||[];y.value=B.institute?{...B.institute}:null,m.value=e.map(u=>({id:u.registration,name:u.name,father_name:u.father_name,date_of_birth:u.date_of_birth,registration_number:u.registration})),i.value=m.value.map(u=>u.id)}catch(e){console.error("ডাটা ফেচ করতে সমস্যা হচ্ছে:",e)}finally{k.value=!1}},Re=async()=>{var l;if(!((l=i.value)!=null&&l.length)||!j.value){console.log("সকল পরীক্ষার্থী এবং মোট ফি এমাউন্ট নির্বাচন করুন।");return}try{const e=await F.createCollectFee({registrations:i.value,total_amount:j.value,payment_method:"online",exam_id:c.lastFee.exam_id,institute_code:f.value,zamat_id:Number(b.value)});e!=null&&e.success?(localStorage.setItem("ToReturn","CollectFeePublic"),window.location=e.bkashURL):console.error("bKash URL not found or response not successful.")}catch(e){console.error("Error during fee collection:",e)}},X=p(()=>{const l=I.zamats.find(e=>Number(e.id)===Number(b.value));return l?l.name:"মারহালা নির্বাচন করা হয়নি"}),Ve=p(()=>{var u;if(!((u=c.lastFee)!=null&&u.final_date))return!1;const l=new Date(c.lastFee.final_date);return new Date>l}),A=p(()=>{var e;const l=(e=c.lastFee)==null?void 0:e.zamat_amounts.find(u=>parseInt(u.zamat_id)===parseInt(b.value));return(l==null?void 0:l.amount)||0}),S=p(()=>{var D,L;const l=(D=c.lastFee)==null?void 0:D.zamat_amounts.find(z=>parseInt(z.zamat_id)===parseInt(b.value)),e=new Date((L=c.lastFee)==null?void 0:L.last_date);return new Date>e&&(l==null?void 0:l.late_fee)||0}),R=p(()=>{var l;return((l=i.value)==null?void 0:l.length)*A.value}),V=p(()=>{var l;return((l=i.value)==null?void 0:l.length)*S.value}),q=p(()=>Math.round((R.value+V.value)*.01)),j=p(()=>R.value+V.value+q.value);return(l,e)=>{var D,L,z,$,H,J,O,Q,Y,ee,te,le,se,ae,ne,oe,ue,ie,re,de,ve,pe,ce,me,be,ge,fe,ye,xe,ke,_e,Se,De;const u=Te("RouterLink");return n(),o("div",Je,[U.value?(n(),o("div",Oe,[M.value?(n(),o("div",Qe,[t("div",Ye,[t("div",null,[e[3]||(e[3]=t("h3",{class:"title-md text-red-700"},"পেমেন্ট ব্যর্থ হয়েছে",-1)),t("p",et,s(M.value),1)]),t("button",{class:"btn-2",onClick:G},"নতুন ফি প্রদান")])])):(n(),o("div",tt,[t("div",lt,[t("div",null,[e[4]||(e[4]=t("h3",{class:"title-md text-emerald-700"},"পেমেন্ট সফল হয়েছে",-1)),Z.value?(n(),o("p",st,s(Z.value),1)):v("",!0)]),K(u,{class:"btn-2",to:{name:"CollectFeeReceipt",params:{id:N.value}}},{default:T(()=>e[5]||(e[5]=[a(" রশিদ প্রিন্ট ")])),_:1},8,["to"])]),t("div",at,[t("div",nt,[e[6]||(e[6]=t("div",{class:"text-sm text-gray-500"},null,-1)),_.value?(n(),Le(Fe,{key:0})):x.value?(n(),o("span",ot,s(x.value),1)):v("",!0)]),!_.value&&!x.value&&r.value?(n(),o("div",ut,[t("div",it,[t("div",rt,[t("p",null,[e[7]||(e[7]=t("b",null,"ইনস্টিটিউট:",-1)),a(" "+s((L=(D=r.value)==null?void 0:D.institute)!=null&&L.institute_code?r.value.institute.institute_code+" - ":"")+" "+s((($=(z=r.value)==null?void 0:z.institute)==null?void 0:$.name)||"—"),1)]),t("p",null,[e[8]||(e[8]=t("b",null,"পরীক্ষা:",-1)),a(" "+s(((J=(H=r.value)==null?void 0:H.exam)==null?void 0:J.name)||"—"),1)]),t("p",null,[e[9]||(e[9]=t("b",null,"মারহালা:",-1)),a(" "+s(((Q=(O=r.value)==null?void 0:O.zamat)==null?void 0:Q.name)||"—"),1)]),t("p",null,[e[10]||(e[10]=t("b",null,"পরীক্ষার্থী:",-1)),a(" "+s((((ee=(Y=r.value)==null?void 0:Y.amounts)==null?void 0:ee.students_count)??0).toLocaleString("bn-BD")),1)])]),t("div",dt,[t("p",null,[e[11]||(e[11]=t("b",null,"চ্যানেল/পদ্ধতি:",-1)),a(" "+s((((le=(te=r.value)==null?void 0:te.payment)==null?void 0:le.channel)||"-").toUpperCase())+" / "+s((((ae=(se=r.value)==null?void 0:se.payment)==null?void 0:ae.method)||"-").toUpperCase()),1)]),t("p",null,[e[12]||(e[12]=t("b",null,"TRX:",-1)),a(" "+s(((oe=(ne=r.value)==null?void 0:ne.payment)==null?void 0:oe.trx_id)||"—"),1)]),t("p",null,[e[13]||(e[13]=t("b",null,"Payment ID:",-1)),a(" "+s(((ie=(ue=r.value)==null?void 0:ue.payment)==null?void 0:ie.gateway_payment_id)||"—"),1)]),t("p",null,[e[14]||(e[14]=t("b",null,"তারিখ:",-1)),a(" "+s(new Date(((de=(re=r.value)==null?void 0:re.payment)==null?void 0:de.paid_at)||((pe=(ve=r.value)==null?void 0:ve.payment)==null?void 0:pe.created_at)||Date.now()).toLocaleString("bn-BD")),1)])])]),t("div",vt,[t("div",pt,[e[15]||(e[15]=t("p",{class:"text-xs text-gray-500"},"মোট (Gross)",-1)),t("p",ct,s(Number(((me=(ce=r.value)==null?void 0:ce.amounts)==null?void 0:me.gross)??0).toLocaleString("bn-BD"))+" ৳ ",1)]),t("div",mt,[e[16]||(e[16]=t("p",{class:"text-xs text-gray-500"},"সার্ভিস চার্জ",-1)),t("p",bt,s(Number(((ge=(be=r.value)==null?void 0:be.amounts)==null?void 0:ge.service_charge)??0).toLocaleString("bn-BD"))+" ৳ ",1)]),t("div",gt,[e[17]||(e[17]=t("p",{class:"text-xs text-gray-500"},"নেট (Net)",-1)),t("p",ft,s(Number(((ye=(fe=r.value)==null?void 0:fe.amounts)==null?void 0:ye.net)??(((ke=(xe=r.value)==null?void 0:xe.amounts)==null?void 0:ke.gross)??0)-(((Se=(_e=r.value)==null?void 0:_e.amounts)==null?void 0:Se.service_charge)??0)).toLocaleString("bn-BD"))+" ৳ ",1)])])])):v("",!0)])])),t("div",{class:"flex justify-center"},[t("button",{class:"btn-3",onClick:G},"নতুন ফি প্রদান")])])):v("",!0),!U.value&&Ve.value?(n(),o("div",yt,e[18]||(e[18]=[t("b",null,"দুঃখিত! অনলাইনে ফি জমা বন্ধ রয়েছে",-1)]))):U.value?v("",!0):(n(),o("div",xt,[t("div",kt,[w(c).lastFee?(n(),o("div",_t,[t("h1",St,s(((De=w(c).lastFee.exam)==null?void 0:De.name)||"পরীক্ষার নাম নেই")+"-এর ফি প্রদান ",1),t("div",Dt,[t("p",null,[e[19]||(e[19]=a(" ফি জমার শেষ তারিখ: ")),t("b",null,s(new Date(w(c).lastFee.last_date).toLocaleDateString("bn-BD")),1)]),t("p",null,[e[20]||(e[20]=a(" চূড়ান্ত তারিখ: ")),t("b",null,s(new Date(w(c).lastFee.final_date).toLocaleDateString("bn-BD")),1),e[21]||(e[21]=a(" (বিলম্ব ফি সহ) "))])])])):(n(),o("div",Lt,"ডাটা লোড হচ্ছে...")),t("div",wt,[t("div",null,[E(t("select",{"onUpdate:modelValue":e[0]||(e[0]=d=>b.value=d),class:"text-black input-1 px-2 py-1 text-center"},[e[22]||(e[22]=t("option",{value:"",selected:"",disabled:""},"- মারহালা সিলেক্ট করুন -",-1)),(n(!0),o(we,null,Be(w(I).zamats,d=>(n(),o("option",{key:d.id,value:d.id},s(d.name),9,Bt))),128))],512),[[Me,b.value]])]),t("div",null,[E(t("input",{"onUpdate:modelValue":e[1]||(e[1]=d=>f.value=d),type:"text",class:"input-1 w-full text-black px-3 py-1 text-center",placeholder:"ইলহাক নং",onKeyup:Ae(W,["enter"])},null,544),[[Ue,f.value]])]),t("div",{class:"w-full"},[t("button",{onClick:W,class:"btn-2 w-full"},e[23]||(e[23]=[t("i",{class:"fas fa-search"},null,-1),a(" অনুসন্ধান ")]))])])]),k.value?(n(),Le(Fe,{key:0})):(n(),o("div",Ft,[y.value?(n(),o("div",Ct,[t("div",null,[t("h2",ht,s(y.value.name),1),t("p",null,[e[24]||(e[24]=t("b",null,"ইলহাক:",-1)),a(" "+s(y.value.code),1)]),t("p",null,[e[25]||(e[25]=t("b",null,"ফোন:",-1)),a(" "+s(y.value.phone),1)])]),e[32]||(e[32]=t("hr",{class:"w-full"},null,-1)),m.value.length?(n(),o("div",Nt,[t("div",null,[t("p",null,[e[26]||(e[26]=a(" মারহালা: ")),t("b",null,s(X.value),1)]),t("p",null,[e[27]||(e[27]=a(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,s((i.value.length||0).toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[28]||(e[28]=a(" ফি: ")),t("b",null,s((A.value||0).toLocaleString("bn-BD"))+" x "+s((i.value.length||0).toLocaleString("bn-BD"))+" = "+s((R.value||0).toLocaleString("bn-BD"))+" ৳ ",1)]),S.value>0?(n(),o("p",Rt,[e[29]||(e[29]=a(" বিলম্ব ফি: ")),t("b",null,s((S.value||0).toLocaleString("bn-BD"))+" x "+s((i.value.length||0).toLocaleString("bn-BD"))+" = "+s((V.value||0).toLocaleString("bn-BD"))+" ৳ ",1)])):v("",!0),t("p",null,[e[30]||(e[30]=a(" সার্ভিস চার্জ (১%): ")),t("b",null,s((q.value||0).toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[31]||(e[31]=a(" মোট জমা (চার্জ সহ): ")),t("b",null,s((j.value||0).toLocaleString("bn-BD"))+" ৳",1)])])])):v("",!0)])):v("",!0),m.value.length?(n(),o("div",Vt,[E(t("input",{type:"checkbox",id:"selectAllCheckbox","onUpdate:modelValue":e[2]||(e[2]=d=>C.value=d),onChange:he},null,544),[[qe,C.value]]),e[33]||(e[33]=t("label",{for:"selectAllCheckbox"},"সব সিলেক্ট",-1))])):v("",!0),m.value.length?(n(),o("div",jt,[e[39]||(e[39]=Ke('<div class="bg-gray-400 text-white md:grid md:grid-cols-7 p-4 hidden rounded-md" data-v-0f6b873e><p class="md:col-span-3 px-2" data-v-0f6b873e>পরীক্ষার্থীর নাম</p><p class="md:col-span-2 px-2" data-v-0f6b873e>পিতার নাম</p><p class="md:col-span-1 px-2" data-v-0f6b873e>জন্ম তারিখ</p><p class="md:col-span-1 px-2 md:text-end" data-v-0f6b873e>রেজি. নং</p></div>',1)),(n(!0),o(we,null,Be(m.value,(d,je)=>(n(),o("div",{key:d.id,onClick:Ht=>Ne(d.id),class:"cursor-pointer card-bg grid relative md:grid-cols-7 p-4"},[t("div",It,[t("div",null,[t("input",{type:"checkbox",value:d.id,checked:i.value.includes(d.id),class:"text-center"},null,8,Pt)]),t("p",null,[e[34]||(e[34]=t("b",{class:"inline-block md:hidden"},"ক্র:",-1)),a(" "+s((je+1).toLocaleString("bn-BD"))+". ",1)]),t("p",null,[e[35]||(e[35]=t("b",{class:"inline-block md:hidden"},"নাম:",-1)),a(" "+s(d.name),1)])]),t("p",Mt,[e[36]||(e[36]=t("b",{class:"inline-block md:hidden"},"পিতা:",-1)),a(" "+s(d.father_name),1)]),t("p",Ut,[e[37]||(e[37]=t("b",{class:"inline-block md:hidden"},"জন্ম তারিখ:",-1)),a(" "+s(new Date(d.date_of_birth).toLocaleDateString("bn-BD")),1)]),t("p",At,[e[38]||(e[38]=t("b",{class:"inline-block md:hidden"},"রেজি. নং:",-1)),a(" "+s(d.registration_number),1)])],8,zt))),128))])):v("",!0),h.value&&!m.value.length?(n(),o("div",qt,e[40]||(e[40]=[t("p",{class:"text-center text-red-500 p-6"}," ফি জমার জন্য কোন পরীক্ষার্থীর তথ্য পাওয়া যায়নি। সঠিক তথ্য দিয়ে অনুসন্ধান করুন। ",-1)]))):v("",!0),!h.value&&!m.value.length?(n(),o("div",Kt,e[41]||(e[41]=[t("p",{class:"text-center p-6"}," মারহালা সিলেক্ট করে ইলহাক নাম্বার দিয়ে নিবন্ধিত পরীক্ষার্থীদের অনুসন্ধান করুন ",-1)]))):v("",!0),m.value.length?(n(),o("div",Tt,[t("div",null,[t("p",null,[e[42]||(e[42]=a(" মারহালা: ")),t("b",null,s(X.value),1)]),t("p",null,[e[43]||(e[43]=a(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,s((i.value.length||0).toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[44]||(e[44]=a(" ফি: ")),t("b",null,s((A.value||0).toLocaleString("bn-BD"))+" x "+s((i.value.length||0).toLocaleString("bn-BD"))+" = "+s((R.value||0).toLocaleString("bn-BD"))+" ৳ ",1)]),S.value>0?(n(),o("p",Et,[e[45]||(e[45]=a(" বিলম্ব ফি: ")),t("b",null,s((S.value||0).toLocaleString("bn-BD"))+" x "+s((i.value.length||0).toLocaleString("bn-BD"))+" = "+s((V.value||0).toLocaleString("bn-BD"))+" ৳ ",1)])):v("",!0),t("p",null,[e[46]||(e[46]=a(" সার্ভিস চার্জ (১%): ")),t("b",null,s((q.value||0).toLocaleString("bn-BD"))+" ৳",1)]),t("p",Zt,[e[47]||(e[47]=a(" মোট জমা (চার্জ সহ): ")),t("b",null,s((j.value||0).toLocaleString("bn-BD"))+" ৳",1)]),e[48]||(e[48]=t("p",{class:"text-xs"}," ** আপনার বিকাশ একাউন্টে উল্লেখিত পরিমাণ টাকা আছে কিনা তা নিশ্চিত হোন। ",-1))]),t("div",{class:"flex justify-center"},[t("div",{class:"relative"},[t("button",{type:"button",onClick:Re,class:"w-52 px-4 py-2 border-2 border-sky-500 rounded-lg hover:border-pink-600"},e[49]||(e[49]=[t("img",{src:Ge,alt:"bKash Pay"},null,-1)])),e[50]||(e[50]=t("div",{class:"absolute top-2 left-2"},[t("span",{class:"relative flex h-3 w-3"},[t("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-pink-400 opacity-75"}),t("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-pink-500"})])],-1))])]),e[51]||(e[51]=t("div",{class:"text-center text-red-500 text-xs"}," বিকাশ পেমেন্ট বাটনে একবার ক্লিক করে পরের পেজ আসা পর্যন্ত অপেক্ষা করুন। ",-1))])):v("",!0)]))])),t("div",Gt,[e[54]||(e[54]=t("p",{class:"text-center text-sky-600 font-bold"}," যদি ইতমধ্যে ফি জমা দেওয়া থাকে তাহলে নিচের বাটনে ক্লিক করে পরিক্ষার্থী তালিকা যাচাই অথবা টাকা জমার রশীদ প্রিন্ট করুন। ",-1)),t("div",Wt,[K(u,{to:{name:"StudentWithRoll"},class:"btn-2"},{default:T(()=>e[52]||(e[52]=[a(" পরিক্ষার্থী তালিকা যাচাই ")])),_:1}),K(u,{to:{name:"CollectFeeReceiptFind"},class:"btn-3"},{default:T(()=>e[53]||(e[53]=[a(" টাকা জমার রশীদ ")])),_:1})])])])}}},ll=ze(Xt,[["__scopeId","data-v-0f6b873e"]]);export{ll as default};
