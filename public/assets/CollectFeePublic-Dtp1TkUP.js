import{r as m,o as H,B as J,i as g,c as u,a as t,b,t as l,y as n,j as V,C as O,F as z,e as P,v as Q,D as X,f as T,w as W,h as c,k as Y,M as ee,l as te,q as le,z as se,d as o,L as ne}from"./index-BIw34FRE.js";import{_ as oe}from"./bks-pmnt-le7Z3-q2.js";import{u as ae}from"./zamat-CyQiT8SA.js";import{u as ue}from"./student-FhAa3E8x.js";import{u as ie}from"./collect-fee-BhFmqTkw.js";import{u as re}from"./fee-CXRfL9dn.js";const de={class:"my-container space-y-4"},ce={key:0,class:"card-bg text-center text-red-500 py-4 mt-4"},ve={key:1,class:"space-y-2 p-2"},pe={class:"card-bg p-4"},me={key:0},be={class:"title-lg text-center"},ge={class:"md:flex gap-4 justify-center text-sm"},fe={key:1,class:"text-center"},ye={class:"grid md:grid-cols-3 gap-4"},xe=["value"],ke={key:0,class:"card-bg items-center py-8"},Se={class:"flex justify-center items-center text-3xl text-green-600"},De={key:1,class:"flex justify-center items-center text-3xl text-red-500 py-8"},Le={key:2,class:"space-y-2"},_e={key:0,class:"card-bg p-4"},Be={class:"title-md"},we={key:0},Fe={key:0},Ce={key:1,class:"flex gap-2"},he={key:2,class:"space-y-2"},Re=["onClick"],Ve={class:"md:col-span-3 md:flex items-center gap-2 space-y-2 md:space-y-0"},ze={class:""},Me=["value","checked"],Ne={class:""},je={class:""},Ie={class:"md:col-span-2"},Ue={class:"md:col-span-1 md:px-2"},Ae={class:"md:col-span-1 md:px-2 md:text-end"},Ke={key:3,class:"card-bg"},Pe={key:4,class:"card-bg p-4"},Te={key:0},We={class:"card-bg items-center p-4"},Qe={__name:"CollectFeePublic",setup(Ze){const B=ae(),w=ue(),Z=ie(),d=re(),q=le(),M=m(!0),y=m(!1),S=m(""),p=m(""),v=m([]),i=m([]),f=m(null),F=m(!0),N=m(!1),{success:j,error:I}=q.query;H(async()=>{try{y.value=!0,await B.fetchZamats(),await d.fetchLatestFee(),(!d.lastFee||!d.lastFee.exam)&&console.error("Fee data not loaded correctly.")}finally{y.value=!1}}),J(p,()=>{v.value=[],i.value=[]});const E=()=>{F.value?i.value=v.value.map(s=>s.id):i.value=[]},$=s=>{i.value.includes(s)?i.value=i.value.filter(e=>e!==s):i.value.push(s)},U=async()=>{if(!p.value||!S.value){alert("মারহালা সিলেক্ট করুন এবং ইলহাক নাম্বার দিয়ে অনুসন্ধান করুন।");return}y.value=!0,N.value=!0;try{await w.fetchStudentsWithoutRollNumber({instituteCode:S.value,zamatId:p.value}),M.value=!1,f.value=w.institute||null,v.value=w.students,i.value=v.value.map(s=>s.id)}catch(s){console.error("ডাটা ফেচ করতে সমস্যা হচ্ছে:",s)}finally{y.value=!1}},A=async()=>{var s,e;if(!((s=i.value)!=null&&s.length)||!_.value){console.log("সকল পরীক্ষার্থী এবং মোট ফি এমাউন্ট নির্বাচন করুন।");return}try{const r=await Z.createCollectFee({student_ids:i.value,total_amount:_.value,payment_method:"online",exam_id:d.lastFee.exam_id,institute_id:(e=f.value)==null?void 0:e.id,zamat_id:p.value});r!=null&&r.success?(localStorage.setItem("ToReturn","CollectFeePublic"),window.location=r.bkashURL):console.error("bKash URL not found or response not successful.")}catch(r){console.error("Error during fee collection:",r)}},K=g(()=>{const s=B.zamats.find(e=>e.id===p.value);return s?s.name:"মারহালা নির্বাচন করা হয়নি"}),G=g(()=>{var r;if(!((r=d.lastFee)!=null&&r.final_date))return!1;const s=new Date(d.lastFee.final_date);return new Date>s}),C=g(()=>{var e;const s=(e=d.lastFee)==null?void 0:e.zamat_amounts.find(r=>parseInt(r.zamat_id)===parseInt(p.value));return(s==null?void 0:s.amount)||0}),x=g(()=>{var k,a;const s=(k=d.lastFee)==null?void 0:k.zamat_amounts.find(R=>parseInt(R.zamat_id)===parseInt(p.value)),e=new Date((a=d.lastFee)==null?void 0:a.last_date);return new Date>e&&(s==null?void 0:s.late_fee)||0}),D=g(()=>{var s;return((s=i.value)==null?void 0:s.length)*C.value}),L=g(()=>{var s;return((s=i.value)==null?void 0:s.length)*x.value}),h=g(()=>Math.round((D.value+L.value)*.01)),_=g(()=>D.value+L.value+h.value);return(s,e)=>{var k;const r=se("RouterLink");return o(),u("div",de,[G.value?(o(),u("div",ce,e[3]||(e[3]=[t("b",null,"দুঃখিত! অনলাইনে ফি জমা বন্ধ রয়েছে",-1)]))):(o(),u("div",ve,[t("div",pe,[b(d).lastFee?(o(),u("div",me,[t("h1",be,l(((k=b(d).lastFee.exam)==null?void 0:k.name)||"পরীক্ষার নাম নেই")+"-এর ফি প্রদান ",1),t("div",ge,[t("p",null,[e[4]||(e[4]=n(" ফি জমার শেষ তারিখ: ")),t("b",null,l(new Date(b(d).lastFee.last_date).toLocaleDateString("bn-BD")),1)]),t("p",null,[e[5]||(e[5]=n(" চূড়ান্ত তারিখ: ")),t("b",null,l(new Date(b(d).lastFee.final_date).toLocaleDateString("bn-BD")),1),e[6]||(e[6]=n(" (বিলম্ব ফি সহ) "))])])])):(o(),u("div",fe,"ডাটা লোড হচ্ছে...")),t("div",ye,[t("div",null,[V(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),class:"text-black input-1 px-2 py-1 text-center"},[e[7]||(e[7]=t("option",{value:"",selected:"",disabled:""},"- মারহালা সিলেক্ট করুন -",-1)),(o(!0),u(z,null,P(b(B).zamats,a=>(o(),u("option",{key:a.id,value:a.id},l(a.name),9,xe))),128))],512),[[O,p.value]])]),t("div",null,[V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),type:"text",class:"input-1 w-full text-black px-3 py-1 text-center",placeholder:"ইলহাক নং",onKeyup:X(U,["enter"])},null,544),[[Q,S.value]])]),t("div",{class:"w-full"},[t("button",{onClick:U,class:"btn-2 w-full"},e[8]||(e[8]=[t("i",{class:"fas fa-search"},null,-1),n(" অনুসন্ধান ")]))])])]),M.value?(o(),u(z,{key:0},[b(j)?(o(),u("div",ke,[t("div",Se,l(b(j)),1),T(r,{to:{name:"StudentWithRoll"},class:"btn-link"},{default:W(()=>e[9]||(e[9]=[n(" পরিক্ষার্থী তালিকা দেখুন ")])),_:1})])):c("",!0),b(I)?(o(),u("div",De,l(b(I)),1)):c("",!0)],64)):c("",!0),y.value?(o(),Y(ne,{key:1})):(o(),u("div",Le,[f.value?(o(),u("div",_e,[t("div",null,[t("h2",Be,l(f.value.name),1),t("p",null,[e[10]||(e[10]=t("b",null,"ইলহাক:",-1)),n(" "+l(f.value.institute_code),1)]),t("p",null,[e[11]||(e[11]=t("b",null,"ফোন:",-1)),n(" "+l(f.value.phone),1)])]),e[19]||(e[19]=t("hr",{class:"w-full"},null,-1)),v.value.length?(o(),u("div",we,[t("div",null,[t("p",null,[e[12]||(e[12]=n(" মারহালা: ")),t("b",null,l(K.value),1)]),t("p",null,[e[13]||(e[13]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,l((i.value.length||0).toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[14]||(e[14]=n(" ফি: ")),t("b",null,l((C.value||0).toLocaleString("bn-BD"))+" x "+l((i.value.length||0).toLocaleString("bn-BD"))+" = "+l((D.value||0).toLocaleString("bn-BD"))+" ৳",1)]),x.value>0?(o(),u("p",Fe,[e[15]||(e[15]=n(" বিলম্ব ফি: ")),t("b",null,l((x.value||0).toLocaleString("bn-BD"))+" x "+l((i.value.length||0).toLocaleString("bn-BD"))+" = "+l((L.value||0).toLocaleString("bn-BD"))+" ৳",1)])):c("",!0),t("p",null,[e[16]||(e[16]=n(" সার্ভিস চার্জ (১%): ")),t("b",null,l((h.value||0).toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[17]||(e[17]=n(" মোট জমা (চার্জ সহ): ")),t("b",null,l((_.value||0).toLocaleString("bn-BD"))+" ৳",1)])]),t("div",{class:"flex justify-center"},[t("button",{onClick:A,class:"btn-2"},e[18]||(e[18]=[t("i",{class:"fas fa-money-bill-wave"},null,-1),n(" ফি প্রদান (বিকাশ) ")]))])])):c("",!0)])):c("",!0),v.value.length?(o(),u("div",Ce,[V(t("input",{type:"checkbox",id:"selectAllCheckbox","onUpdate:modelValue":e[2]||(e[2]=a=>F.value=a),onChange:E},null,544),[[ee,F.value]]),e[20]||(e[20]=t("label",{for:"selectAllCheckbox"},"সব সিলেক্ট",-1))])):c("",!0),v.value.length?(o(),u("div",he,[e[26]||(e[26]=te('<div class="bg-gray-400 text-white md:grid md:grid-cols-7 p-4 hidden rounded-md"><p class="md:col-span-3 px-2">পরীক্ষার্থীর নাম</p><p class="md:col-span-2 px-2">পিতার নাম</p><p class="md:col-span-1 px-2">জন্ম তারিখ</p><p class="md:col-span-1 px-2 md:text-end">রেজি. নং</p></div>',1)),(o(!0),u(z,null,P(v.value,(a,R)=>(o(),u("div",{key:a.id,onClick:qe=>$(a.id),class:"cursor-pointer card-bg grid relative md:grid-cols-7 p-4"},[t("div",Ve,[t("div",ze,[t("input",{type:"checkbox",value:a.id,checked:i.value.includes(a.id),class:"text-center"},null,8,Me)]),t("p",Ne,[e[21]||(e[21]=t("b",{class:"inline-block md:hidden"},"ক্র:",-1)),n(" "+l((R+1).toLocaleString("bn-BD"))+". ",1)]),t("p",je,[e[22]||(e[22]=t("b",{class:"inline-block md:hidden"},"নাম:",-1)),n(" "+l(a.name),1)])]),t("p",Ie,[e[23]||(e[23]=t("b",{class:"inline-block md:hidden"},"পিতা:",-1)),n(" "+l(a.father_name),1)]),t("p",Ue,[e[24]||(e[24]=t("b",{class:"inline-block md:hidden"},"জন্ম তারিখ:",-1)),n(" "+l(new Date(a.date_of_birth).toLocaleDateString("bn-BD")),1)]),t("p",Ae,[e[25]||(e[25]=t("b",{class:"inline-block md:hidden"},"রেজি. নং:",-1)),n(" "+l(a.registration_number),1)])],8,Re))),128))])):c("",!0),N.value&&!v.value.length?(o(),u("div",Ke,e[27]||(e[27]=[t("p",{class:"text-center text-red-500 p-6"}," ফি জমার জন্য কোন পরীক্ষার্থীর তথ্য পাওয়া যায়নি। সঠিক তথ্য দিয়ে অনুসন্ধান করুন। ",-1)]))):c("",!0),v.value.length?(o(),u("div",Pe,[t("div",null,[t("p",null,[e[28]||(e[28]=n(" মারহালা: ")),t("b",null,l(K.value),1)]),t("p",null,[e[29]||(e[29]=n(" নির্বাচিত পরীক্ষার্থীর সংখ্যা: ")),t("b",null,l((i.value.length||0).toLocaleString("bn-BD"))+" জন",1)]),t("p",null,[e[30]||(e[30]=n(" ফি: ")),t("b",null,l((C.value||0).toLocaleString("bn-BD"))+" x "+l((i.value.length||0).toLocaleString("bn-BD"))+" = "+l((D.value||0).toLocaleString("bn-BD"))+" ৳",1)]),x.value>0?(o(),u("p",Te,[e[31]||(e[31]=n(" বিলম্ব ফি: ")),t("b",null,l((x.value||0).toLocaleString("bn-BD"))+" x "+l((i.value.length||0).toLocaleString("bn-BD"))+" = "+l((L.value||0).toLocaleString("bn-BD"))+" ৳",1)])):c("",!0),t("p",null,[e[32]||(e[32]=n(" সার্ভিস চার্জ (১%): ")),t("b",null,l((h.value||0).toLocaleString("bn-BD"))+" ৳",1)]),t("p",null,[e[33]||(e[33]=n(" মোট জমা (চার্জ সহ): ")),t("b",null,l((_.value||0).toLocaleString("bn-BD"))+" ৳",1)])]),t("div",{class:"flex justify-center"},[t("button",{type:"button",onClick:A,class:"w-52 px-4 py-2 border-2 rounded-lg hover:border-pink-600"},e[34]||(e[34]=[t("img",{src:oe,alt:""},null,-1)]))])])):c("",!0)]))])),t("div",We,[e[36]||(e[36]=t("p",{class:"text-center text-sky-600 font-bold"}," যদি ইতমধ্যে ফি জমা দেওয়া থাকে তাহলে নিচের বাটনে ক্লিক করে পরিক্ষার্থী তালিকা যাচাই করুন ",-1)),T(r,{to:{name:"StudentWithRoll"},class:"btn-1"},{default:W(()=>e[35]||(e[35]=[n("পরিক্ষার্থী তালিকা যাচাই")])),_:1})])])}}};export{Qe as default};
