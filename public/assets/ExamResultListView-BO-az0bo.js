import{r as h,i as L,o as T,I as U,c as r,a as s,j as M,J as N,F as k,e as _,b as c,y as w,t as n,h as g,k as A,q as J,d as a,f as P,w as Z,n as B,s as G,z as H,L as K}from"./index-4YhllknO.js";import{u as O}from"./center-BLle967Z.js";import{u as Q}from"./result-BbDwF4xA.js";import{u as W}from"./zamat-jOZQWl1Y.js";const X={class:"my-container"},Y={class:"px-4 space-y-4"},S={class:"card-bg p-4"},j={class:"grid md:grid-cols-3 gap-4"},ee=["label"],te=["value"],se=["value"],ae={key:0,class:"text-center text-red-500"},re={key:2,class:"text-center text-gray-500"},le={key:3,class:"card-bg p-4"},oe={class:"flex flex-col md:flex-row justify-center md:items-center gap-y-1 gap-x-4"},ne={key:0,class:"md:text-center text-gray-700 font-semibold"},ue={key:1,class:"md:text-center text-gray-700 font-semibold"},ie={class:"w-full overflow-x-auto"},de={class:"table-auto w-full border-collapse border border-black"},ce={class:"bg-gray-100"},ve={class:"border border-black px-2 py-1 text-center"},pe={class:"border border-black px-2 py-1"},be={class:"border border-black px-2 py-1 text-center"},xe={__name:"ExamResultListView",setup(fe){const l=Q(),z=O(),C=W(),q=G(),D=J(),i=h(D.query.center||""),u=h(D.query.zamat||""),f=h(!1),I=h(!0),m=h(""),E=L(()=>l.results.length),x=L(()=>l.students.length);T(async()=>{try{f.value=!0,await C.fetchZamats(),u.value&&await z.fetchCenters({zamat_id:u.value}),u.value&&i.value&&await l.fetchResultData({center_id:i.value,zamat_id:u.value})}catch(o){m.value="ডাটা লোড করতে সমস্যা হয়েছে।",console.error(o)}finally{f.value=!1}}),U(u,async o=>{if(l.students=[],l.results=[],l.examSubjects=[],I.value=!0,!o){i.value="",z.centers=[];return}try{f.value=!0,await z.fetchCenters({zamat_id:o})}catch(t){m.value="সেন্টার লোড করতে সমস্যা হয়েছে।",console.error(t)}finally{f.value=!1}});const F=async()=>{var o,t;if(!u.value||!i.value){m.value="মারহালা এবং মারকায নির্বাচন করুন।";return}I.value=!1,q.replace({path:D.path,query:{...D.query,zamat:u.value,center:i.value}});try{f.value=!0,m.value="",await l.fetchResultData({center_id:i.value,zamat_id:u.value})}catch(v){m.value=((t=(o=v.response)==null?void 0:o.data)==null?void 0:t.message)||"ডাটা লোড করতে সমস্যা হয়েছে।",console.error("Fetch Error:",v)}finally{f.value=!1}},R=(o,t)=>{var v,p;return(p=(v=l.results)==null?void 0:v.find(d=>parseInt(d.student_id)===parseInt(o)&&parseInt(d.exam_subject_id)===parseInt(t)))==null?void 0:p.mark},V=o=>{var p;const t=(p=l.results)==null?void 0:p.filter(d=>parseInt(d.student_id)===parseInt(o));return t!=null&&t.length?t.reduce((d,e)=>d+Number(e.mark),0).toFixed(2):""},$=L(()=>l.examSubjects.reduce((o,t)=>o+t.pass_marks,0));return(o,t)=>{var p,d;const v=H("RouterLink");return a(),r("div",X,[s("div",Y,[t[13]||(t[13]=s("div",{class:"flex items-center justify-between"},[s("h1",{class:"title-lg"},"পরিক্ষার ফলাফল")],-1)),s("div",S,[s("div",j,[s("div",null,[M(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),class:"input-1"},[t[2]||(t[2]=s("option",{value:"",disabled:""},"-মারহালা সিলেক্ট করুন-",-1)),(a(!0),r(k,null,_(c(C).departments,e=>(a(),r("optgroup",{label:e.name,key:e.id},[(a(!0),r(k,null,_(e.zamats,b=>(a(),r("option",{key:b.id,value:b.id},n(b.name),9,te))),128))],8,ee))),128))],512),[[N,u.value]])]),s("div",null,[M(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"input-1"},[t[3]||(t[3]=s("option",{value:"",selected:"",disabled:""},"- মারকায নির্বাচন করুন -",-1)),(a(!0),r(k,null,_(c(z).centers,e=>(a(),r("option",{key:e==null?void 0:e.institute.id,value:e==null?void 0:e.institute.id},n(e==null?void 0:e.institute.name),9,se))),128))],512),[[N,i.value]])]),s("div",{class:"w-full"},[s("button",{onClick:F,class:"btn-2 py-2.5 w-full"},t[4]||(t[4]=[s("i",{class:"fas fa-search"},null,-1),w(" অনুসন্ধান ")]))])])]),m.value?(a(),r("div",ae,n(m.value),1)):g("",!0),f.value||c(l).loading?(a(),A(K,{key:1})):g("",!0),!c(l).loading&&x.value===0&&E.value===0?(a(),r("div",re,n(I.value?"অনুসন্ধান বাটনে ক্লিক করুন":"কোন ডাটা পাওয়া যায়নি।"),1)):g("",!0),x.value>0&&!c(l).loading?(a(),r("div",le,[s("div",oe,[x.value>0?(a(),r("div",ne,[t[5]||(t[5]=w(" মারহালা: ")),s("b",null,n((d=(p=c(C).zamats)==null?void 0:p.find(e=>parseInt(e.id)===parseInt(u.value)))==null?void 0:d.name),1)])):g("",!0),x.value>0?(a(),r("div",ue,[t[6]||(t[6]=w(" পরীক্ষার্থীর সংখ্যা: ")),s("b",null,n(Number(x.value).toLocaleString("bn-BD"))+" জন",1)])):g("",!0)]),s("div",ie,[s("table",de,[s("thead",null,[s("tr",ce,[t[9]||(t[9]=s("th",{class:"border border-black px-2 py-1"},"#",-1)),t[10]||(t[10]=s("th",{class:"border border-black px-2 py-1"},"পরীক্ষার্থীর নাম",-1)),t[11]||(t[11]=s("th",{class:"border border-black px-2 py-1"},"রোল",-1)),(a(!0),r(k,null,_(c(l).examSubjects,e=>{var b;return a(),r("th",{key:e.id,class:"border border-black px-2 py-1"},[P(v,{title:(b=e==null?void 0:e.subject)==null?void 0:b.name,to:`/exam-results/centers/${i.value}/zamats/${u.value}/exam-subjects/${e.id}/marks`},{default:Z(()=>{var y;return[w(n((y=e==null?void 0:e.subject)==null?void 0:y.name)+" ",1),t[7]||(t[7]=s("br",null,null,-1)),w(" ("+n(e.pass_marks)+"/"+n(e.full_marks)+") ",1),t[8]||(t[8]=s("i",{class:"fas fa-external-link text-sky-600 hover:text-sky-700"},null,-1))]}),_:2},1032,["title","to"])])}),128)),t[12]||(t[12]=s("th",{class:"border border-black px-2 py-1"},"মোট নাম্বার",-1))])]),s("tbody",null,[(a(!0),r(k,null,_(c(l).students,(e,b)=>(a(),r("tr",{key:e.id},[s("td",ve,n(Number(b+1).toLocaleString("bn-BD")),1),s("td",pe,n(e==null?void 0:e.name),1),s("td",be,n(e==null?void 0:e.roll_number),1),(a(!0),r(k,null,_(c(l).examSubjects,y=>(a(),r("td",{key:y.id,class:B(["border border-black px-2 py-1 text-center",{"bg-red-200":R(e.id,y.id)<y.pass_marks}])},n(R(e.id,y.id)||"অনুপস্থিত"),3))),128)),s("td",{class:B(["border border-black px-2 py-1 text-center",{"bg-red-200":V(e.id)<$.value}])},n(V(e.id)),3)]))),128))])])])])):g("",!0)])])}}};export{xe as default};
