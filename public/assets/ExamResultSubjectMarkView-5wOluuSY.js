import{r as _,i as C,o as A,c,t as d,h as i,k as O,b,a as t,f as D,w as E,F as P,e as Y,p as y,q as G,z as H,d as n,y as K,j as R,v as U,D as k,Y as I,L as J}from"./index-BZgx-h2G.js";import{u as Q}from"./result-D39Uf41Z.js";const W={class:"my-container space-y-4"},X={key:0,class:"text-center text-red-500"},Z={key:2,class:"text-center text-gray-500"},ee={key:3},te={class:"mb-4 flex gap-4 justify-between"},se={class:"card-bg p-4"},oe={class:"title-md text-center"},re={class:""},ae={class:"table-auto border-collapse w-full"},le={class:"border border-black px-2 py-1 text-center"},ne={class:"border border-black px-2 py-1"},ce={class:"border border-black px-2 py-1 text-center"},ue={class:"border border-black px-2 py-1 text-center"},de={class:"border border-black px-2 py-1 text-center"},ie=["onUpdate:modelValue","onKeydown"],be={class:"border border-black px-2 py-1 text-center"},pe=["onUpdate:modelValue","onKeydown"],me={class:"mt-4 flex gap-4 justify-between"},fe={__name:"ExamResultSubjectMarkView",setup(ve){const a=Q(),T=G(),{centerId:h,zamatId:f,examSubjectId:j}=T.params,w=_(null),p=_(!1),g=_(""),l=_({}),F=C(()=>a.results.length),V=C(()=>a.students.length);A(async()=>{try{p.value=!0,l.value={},await a.fetchResultData({center_id:h,zamat_id:f,exam_subject_id:j});const s=Object.fromEntries(a.results.map(e=>[e.student_id,e]));a.students.forEach(e=>{const o=s[e.id]||null,m=(o==null?void 0:o.marks)||["",""];l.value[e.id]=[m[0]??"",m[1]??""]}),w.value=a.examSubjects[0]}catch(s){g.value="ডাটা লোড করতে সমস্যা হয়েছে।",console.error(s)}finally{p.value=!1}});async function M(){await a.submitMarks(f,j,{marks:l.value})}const q=s=>{let e=0,o=0;return s&&s[0]!==""&&(e+=Number(s[0]),o++),s&&s[1]!==""&&(e+=Number(s[1]),o++),o>0?e/o:""},x=_([]),S=(s,e)=>{s>0&&I(()=>{var o;(o=x.value[(s-1)*2+e])==null||o.focus()})},N=(s,e)=>{s<a.students.length-1&&I(()=>{var o;(o=x.value[(s+1)*2+e])==null||o.focus()})};return(s,e)=>{var m,$,L,z,B;const o=H("RouterLink");return n(),c("div",W,[g.value?(n(),c("div",X,d(g.value),1)):i("",!0),p.value?(n(),O(J,{key:1})):i("",!0),!p.value&&V.value===0&&F.value===0?(n(),c("div",Z," কোন ডাটা পাওয়া যায়নি। ")):i("",!0),!b(a).loading&&!p.value&&V.value>0?(n(),c("div",ee,[t("form",{onSubmit:y(M,["prevent"]),class:"w-full overflow-x-auto"},[t("div",te,[D(o,{to:`/exam-results?zamat=${b(f)}&center=${b(h)}`,class:"btn-contrast"},{default:E(()=>e[0]||(e[0]=[K(" পিছনে যান ")])),_:1},8,["to"]),e[1]||(e[1]=t("h1",{class:"title-lg"},"পরীক্ষার ফলাফল যুক্ত করুন",-1)),e[2]||(e[2]=t("button",{type:"submit",class:"btn-2"},"সংরক্ষণ করুন",-1))]),t("div",se,[t("div",oe,[t("p",re,"মারহালা: "+d((L=($=(m=w.value)==null?void 0:m.subject)==null?void 0:$.zamat)==null?void 0:L.name),1),t("p",null,"সাবজেক্ট: "+d((B=(z=w.value)==null?void 0:z.subject)==null?void 0:B.name),1)]),t("table",ae,[e[3]||(e[3]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"border border-black px-2 py-1"},"#"),t("th",{class:"border border-black px-2 py-1"},"পরীক্ষার্থীর নাম"),t("th",{class:"border border-black px-2 py-1"},"রোল"),t("th",{class:"border border-black px-2 py-1"},"চূরান্ত মার্ক (গড়)"),t("th",{class:"border border-black px-2 py-1"},"মার্ক (১ম পরিক্ষক)"),t("th",{class:"border border-black px-2 py-1"},"মার্ক (২য় পরিক্ষক)")])],-1)),t("tbody",null,[(n(!0),c(P,null,Y(b(a).students,(r,v)=>(n(),c("tr",{key:r.id},[t("td",le,d(Number(v+1).toLocaleString("bn-BD")),1),t("td",ne,d(r==null?void 0:r.name),1),t("td",ce,d(r.roll_number),1),t("td",ue,d(q(l.value[r.id])),1),t("td",de,[l.value[r.id]?R((n(),c("input",{key:0,type:"text","onUpdate:modelValue":u=>l.value[r.id][0]=u,class:"input-1 text-center",ref_for:!0,ref_key:"inputs",ref:x,onKeydown:[k(y(u=>S(v,0),["prevent"]),["up"]),k(y(u=>N(v,0),["prevent"]),["down"])]},null,40,ie)),[[U,l.value[r.id][0]]]):i("",!0)]),t("td",be,[l.value[r.id]?R((n(),c("input",{key:0,type:"text","onUpdate:modelValue":u=>l.value[r.id][1]=u,class:"input-1 text-center",ref_for:!0,ref_key:"inputs",ref:x,onKeydown:[k(y(u=>S(v,1),["prevent"]),["up"]),k(y(u=>N(v,1),["prevent"]),["down"])]},null,40,pe)),[[U,l.value[r.id][1]]]):i("",!0)])]))),128))])])]),t("div",me,[D(o,{to:`/exam-results?zamat=${b(f)}&center=${b(h)}`,class:"btn-contrast"},{default:E(()=>e[4]||(e[4]=[K(" পিছনে যান ")])),_:1},8,["to"]),e[5]||(e[5]=t("button",{type:"submit",class:"btn-2"},"সংরক্ষণ করুন",-1))])],32)])):i("",!0)])}}};export{fe as default};
