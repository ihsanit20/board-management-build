import{r as x,i as C,o as O,c as u,t as i,h as v,k as P,b as m,a as t,f as E,w as K,F as H,e as J,p as b,q as Q,z as W,d as c,y as D,j as U,v as I,G as f,$ as k,L as X}from"./index-4ATOSoLI.js";import{u as Y}from"./result-DsrK5pjZ.js";const Z={class:"my-container space-y-4"},ee={key:0,class:"text-center text-red-500"},te={key:2,class:"text-center text-gray-500"},se={key:3},oe={class:"mb-4 flex gap-4 justify-between"},re={class:"card-bg p-4"},ae={class:"title-md text-center"},le={class:""},ne={class:"table-auto border-collapse w-full"},ce={class:"border border-black px-2 py-1 text-center"},ue={class:"border border-black px-2 py-1"},de={class:"border border-black px-2 py-1 text-center"},ie={class:"border border-black px-2 py-1 text-center"},be={class:"border border-black px-2 py-1 text-center"},pe=["onUpdate:modelValue","onKeydown"],ve={class:"border border-black px-2 py-1 text-center"},me=["onUpdate:modelValue","onKeydown"],fe={class:"mt-4 flex gap-4 justify-between"},he={__name:"ExamResultSubjectMarkView",setup(_e){const a=Y(),T=Q(),{centerId:w,zamatId:h,examSubjectId:$}=T.params,g=x(null),_=x(!1),j=x(""),l=x({}),F=C(()=>a.results.length),V=C(()=>a.students.length);O(async()=>{try{_.value=!0,l.value={},await a.fetchResultData({center_id:w,zamat_id:h,exam_subject_id:$});const o=Object.fromEntries(a.results.map(e=>[e.student_id,e]));a.students.forEach(e=>{const s=o[e.id]||null,y=(s==null?void 0:s.marks)||["",""];l.value[e.id]=[y[0]??"",y[1]??""]}),g.value=a.examSubjects[0]}catch(o){j.value="ডাটা লোড করতে সমস্যা হয়েছে।",console.error(o)}finally{_.value=!1}});async function M(){await a.submitMarks(h,$,{marks:l.value})}const q=o=>{let e=0,s=0;return o&&o[0]!==""&&(e+=Number(o[0]),s++),o&&o[1]!==""&&(e+=Number(o[1]),s++),s>0?e/s:""},p=x([]),S=(o,e)=>{o>0&&k(()=>{var s;(s=p.value[(o-1)*2+e])==null||s.focus()})},L=(o,e)=>{o<a.students.length-1&&k(()=>{var s;(s=p.value[(o+1)*2+e])==null||s.focus()})},A=(o,e)=>{k(()=>{var s;(s=p.value[o*2])==null||s.focus()})},G=(o,e)=>{k(()=>{var s;(s=p.value[o*2+1])==null||s.focus()})};return(o,e)=>{var y,N,z,R,B;const s=W("RouterLink");return c(),u("div",Z,[j.value?(c(),u("div",ee,i(j.value),1)):v("",!0),_.value?(c(),P(X,{key:1})):v("",!0),!_.value&&V.value===0&&F.value===0?(c(),u("div",te," কোন ডাটা পাওয়া যায়নি। ")):v("",!0),!m(a).loading&&!_.value&&V.value>0?(c(),u("div",se,[t("form",{onSubmit:b(M,["prevent"]),class:"w-full overflow-x-auto"},[t("div",oe,[E(s,{to:`/exam-results?zamat=${m(h)}&center=${m(w)}`,class:"btn-contrast"},{default:K(()=>e[0]||(e[0]=[D(" পিছনে যান ")])),_:1},8,["to"]),e[1]||(e[1]=t("h1",{class:"title-lg"},"পরীক্ষার ফলাফল যুক্ত করুন",-1)),e[2]||(e[2]=t("button",{type:"submit",class:"btn-2"},"সংরক্ষণ করুন",-1))]),t("div",re,[t("div",ae,[t("p",le,"মারহালা: "+i((z=(N=(y=g.value)==null?void 0:y.subject)==null?void 0:N.zamat)==null?void 0:z.name),1),t("p",null,"সাবজেক্ট: "+i((B=(R=g.value)==null?void 0:R.subject)==null?void 0:B.name),1)]),t("table",ne,[e[3]||(e[3]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"border border-black px-2 py-1"},"#"),t("th",{class:"border border-black px-2 py-1"},"পরীক্ষার্থীর নাম"),t("th",{class:"border border-black px-2 py-1"},"রোল"),t("th",{class:"border border-black px-2 py-1"},"চূরান্ত মার্ক (গড়)"),t("th",{class:"border border-black px-2 py-1"},"মার্ক (১ম পরিক্ষক)"),t("th",{class:"border border-black px-2 py-1"},"মার্ক (২য় পরিক্ষক)")])],-1)),t("tbody",null,[(c(!0),u(H,null,J(m(a).students,(r,d)=>(c(),u("tr",{key:r.id},[t("td",ce,i(Number(d+1).toLocaleString("bn-BD")),1),t("td",ue,i(r==null?void 0:r.name),1),t("td",de,i(r.roll_number),1),t("td",ie,i(q(l.value[r.id])),1),t("td",be,[l.value[r.id]?U((c(),u("input",{key:0,type:"text","onUpdate:modelValue":n=>l.value[r.id][0]=n,class:"input-1 text-center",ref_for:!0,ref_key:"inputs",ref:p,onKeydown:[f(b(n=>S(d,0),["prevent"]),["up"]),f(b(n=>L(d,0),["prevent"]),["down"]),f(b(n=>G(d),["prevent"]),["right"])]},null,40,pe)),[[I,l.value[r.id][0]]]):v("",!0)]),t("td",ve,[l.value[r.id]?U((c(),u("input",{key:0,type:"text","onUpdate:modelValue":n=>l.value[r.id][1]=n,class:"input-1 text-center",ref_for:!0,ref_key:"inputs",ref:p,onKeydown:[f(b(n=>S(d,1),["prevent"]),["up"]),f(b(n=>L(d,1),["prevent"]),["down"]),f(b(n=>A(d),["prevent"]),["left"])]},null,40,me)),[[I,l.value[r.id][1]]]):v("",!0)])]))),128))])])]),t("div",fe,[E(s,{to:`/exam-results?zamat=${m(h)}&center=${m(w)}`,class:"btn-contrast"},{default:K(()=>e[4]||(e[4]=[D(" পিছনে যান ")])),_:1},8,["to"]),e[5]||(e[5]=t("button",{type:"submit",class:"btn-2"},"সংরক্ষণ করুন",-1))])],32)])):v("",!0)])}}};export{he as default};
