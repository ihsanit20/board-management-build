import{_ as K,r as x,o as L,i as w,O,c as o,a as t,n as U,j as n,v as u,G as $,D as M,F as C,e as E,t as r,h as k,k as V,N as D,b as j,f as G,w as H,l as J,d}from"./index-wkA3WKam.js";import{u as Q}from"./institute-application-pD6NQajB.js";import{u as R}from"./area-CntMuBDy.js";const X={class:"my-container space-y-4 py-4"},Y={class:"card-bg p-4 md:p-8"},Z={class:"flex items-center gap-2 text-sm mb-6"},ee={key:0,class:"space-y-4"},te={class:"grid md:grid-cols-3 gap-3"},le=["value"],se=["disabled"],ae={class:"mt-4"},ne={key:0,class:"text-gray-500 text-sm"},ue={key:1,class:"text-gray-500 text-sm"},oe={key:2,class:"border rounded divide-y"},de={class:"font-medium"},re={class:"text-sm text-gray-600"},ie={key:0},me=["onClick"],pe={key:1,class:"space-y-6"},be={class:"flex items-center justify-between"},ye={class:"text-sm"},ve={class:"grid md:grid-cols-3 gap-3"},fe=["value"],xe={class:"grid gap-4"},ge={class:"grid grid-cols-2 gap-3"},ke={class:"border rounded p-3"},_e={class:"grid md:grid-cols-3 gap-3"},he={class:"border rounded p-3"},ce={class:"grid md:grid-cols-4 gap-3"},we=["value"],Ue={class:"border rounded p-3"},Ve={class:"grid md:grid-cols-4 gap-3"},Ne=["value"],ze={class:"grid md:grid-cols-2 gap-3"},Ae={class:"inline-flex items-center gap-2"},Se={class:"inline-flex items-center gap-2"},Ce={class:"inline-flex items-center gap-2"},Ee={class:"flex items-center gap-3 pt-2"},De=["disabled"],Ie={key:0,class:"text-red-600 text-sm mt-2"},Te={key:2,class:"space-y-3"},qe={class:"p-4 border rounded bg-green-50"},Me={class:"text-sm mt-1"},je={class:"font-semibold"},We={class:"flex items-center gap-3"},Pe={__name:"InstituteApply",setup(Be){const y=Q(),N=R(),i=x(1),v=x("NEW"),z=x(null);L(async()=>{var a;(a=N.areas)!=null&&a.length||await N.fetchAreas()});const A=w(()=>N.areas||[]),W=w(()=>Object.fromEntries((A.value||[]).map(a=>[Number(a.id),a.name]))),f=x(""),_=x(null),g=x([]),S=w(()=>y.suggesting===!0);async function I(){const a=String(f.value||"").trim();if(a.length<2){g.value=[];return}try{const e=await y.suggestMatches(a,_.value||null);g.value=Array.isArray(e)?e:[]}catch{g.value=[]}}const h=x(null),l=O({name:"",phone:"",area_id:"",address:"",established_on:"",founder_name:"",muhtamim:{name:"",qualification:"",ihtemam_years:null},upto_class:"",students:{maktab:null,hifz:null,kitab:null,total:null},teachers:{maktab:null,hifz:null,kitab:null,total:null},has_hostel:!1,land_info:"",building_summary:"",has_library_for_students:!1,has_kutubkhana:!1,kutubkhana:{kitab_count:null}});function T(a=0,e=0,b=0){return Number(a||0)+Number(e||0)+Number(b||0)}function m(a,e=null){return typeof a>"u"?e:a}async function P(a){var e;h.value=a,v.value="UPDATE",l.name=m(a==null?void 0:a.name,""),l.phone=m(a==null?void 0:a.phone,""),l.area_id=m(a==null?void 0:a.area_id,"");try{const b=await y.prefill(a.id),s=(b==null?void 0:b.institute_info)||null;s&&(l.address=m(s.address,""),l.established_on=m(s.established_on,""),l.founder_name=m(s.founder_name,""),l.muhtamim={...s.muhtamim||{},ihtemam_years:m((e=s.muhtamim)==null?void 0:e.ihtemam_years,null)},l.upto_class=m(s.upto_class,""),l.students={maktab:null,hifz:null,kitab:null,total:null,...s.students||{}},l.teachers={maktab:null,hifz:null,kitab:null,total:null,...s.teachers||{}},l.has_hostel=!!s.has_hostel,l.land_info=m(s.land_info,""),l.building_summary=m(s.building_summary,""),l.has_library_for_students=!!s.has_library_for_students,l.has_kutubkhana=!!s.has_kutubkhana,l.kutubkhana={kitab_count:null,...s.kutubkhana||{}})}catch{}i.value=2}function B(){h.value=null,v.value="NEW",!l.name&&f.value&&isNaN(Number(f.value))&&(l.name=String(f.value)),i.value=2}const q=w(()=>y.saving);function p(a){if(a===""||a===null||typeof a>"u")return null;const e=Number(a);return Number.isFinite(e)?e:null}async function F(){var b,s;if(v.value==="UPDATE"&&!((b=h.value)!=null&&b.id)){alert("অনুগ্রহ করে একটি বিদ্যমান প্রতিষ্ঠান সিলেক্ট করুন।");return}if(!l.name||!l.phone){alert("নাম এবং ফোন আবশ্যক।");return}const a={address:l.address||null,established_on:l.established_on||null,founder_name:l.founder_name||null,muhtamim:{name:l.muhtamim.name||null,qualification:l.muhtamim.qualification||null,ihtemam_years:p(l.muhtamim.ihtemam_years)},upto_class:l.upto_class||null,students:{maktab:p(l.students.maktab),hifz:p(l.students.hifz),kitab:p(l.students.kitab),total:p(l.students.total)},teachers:{maktab:p(l.teachers.maktab),hifz:p(l.teachers.hifz),kitab:p(l.teachers.kitab),total:p(l.teachers.total)},has_hostel:!!l.has_hostel,land_info:l.land_info||null,building_summary:l.building_summary||null,has_library_for_students:!!l.has_library_for_students,has_kutubkhana:!!l.has_kutubkhana,kutubkhana:{kitab_count:p(l.kutubkhana.kitab_count)}},e={type:v.value==="NEW"?"NEW":"UPDATE",institute_id:v.value==="UPDATE"?(s=h.value)==null?void 0:s.id:null,name:l.name,phone:l.phone,area_id:l.area_id||null,payload_json:a};try{const c=await y.submitApplication(e);z.value=(c==null?void 0:c.id)||null,i.value=3}catch{alert(y.error||"আবেদন সাবমিট করা যায়নি।")}}return(a,e)=>{const b=J("router-link");return d(),o("div",X,[e[53]||(e[53]=t("h1",{class:"title-lg"},"মাদরসার ইলহাকি আবেদন ও তথ্য হালনাগাদ ফরম",-1)),t("div",Y,[t("div",Z,[t("div",{class:U(["px-3 py-1 rounded-full",i.value>=1?"bg-blue-600 text-white":"bg-gray-200"])}," Step 1 ",2),e[26]||(e[26]=t("div",{class:"text-gray-400"},"—",-1)),t("div",{class:U(["px-3 py-1 rounded-full",i.value>=2?"bg-blue-600 text-white":"bg-gray-200"])}," Step 2 ",2),e[27]||(e[27]=t("div",{class:"text-gray-400"},"—",-1)),t("div",{class:U(["px-3 py-1 rounded-full",i.value>=3?"bg-blue-600 text-white":"bg-gray-200"])}," Done ",2)]),i.value===1?(d(),o("section",ee,[t("div",te,[n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),type:"text",placeholder:"নাম বা ফোন লিখুন",class:"border rounded px-3 py-2 w-full",onKeyup:$(I,["enter"])},null,544),[[u,f.value]]),n(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),class:"border rounded px-3 py-2 w-full"},[e[28]||(e[28]=t("option",{value:null},"সকল এরিয়া",-1)),(d(!0),o(C,null,E(A.value,s=>(d(),o("option",{key:s.id,value:Number(s.id)},r(s.name)+" ("+r(s.area_code)+") ",9,le))),128))],512),[[M,_.value,void 0,{number:!0}]]),t("button",{onClick:I,disabled:S.value,class:"px-4 py-2 rounded bg-blue-600 text-white disabled:opacity-60"},r(S.value?"খোঁজা হচ্ছে…":"খুঁজুন"),9,se)]),t("div",{class:"flex items-center gap-2"},[e[29]||(e[29]=t("span",{class:"text-sm text-gray-600"},"বিদ্যমান খুঁজে না পেলে—",-1)),t("button",{onClick:B,class:"text-blue-700 underline"}," নতুন হিসেবে চালিয়ে যান ")]),t("div",ae,[e[30]||(e[30]=t("h3",{class:"font-medium mb-2"},"সম্ভাব্য মিল",-1)),S.value?(d(),o("div",ne,"লোড হচ্ছে…")):g.value.length===0?(d(),o("div",ue," কোনো ফলাফল নেই ")):(d(),o("div",oe,[(d(!0),o(C,null,E(g.value,s=>(d(),o("div",{key:s.id,class:"p-3 flex items-center justify-between"},[t("div",null,[t("div",de,r(s.name),1),t("div",re,[V(" ফোন: "+r(s.phone||"—")+" ",1),s.area_id?(d(),o("span",ie,"| এরিয়া: "+r(W.value[Number(s.area_id)]||s.area_id),1)):k("",!0)])]),t("button",{onClick:c=>P(s),class:"px-3 py-1.5 rounded bg-emerald-600 text-white"}," সিলেক্ট ",8,me)]))),128))]))])])):k("",!0),i.value===2?(d(),o("section",pe,[t("div",be,[e[32]||(e[32]=t("h2",{class:"text-xl font-semibold"},"ফর্ম",-1)),t("div",ye,[e[31]||(e[31]=V(" মোড: ")),t("span",{class:U(["px-2 py-1 rounded",v.value==="NEW"?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700"])},r(v.value),3)])]),t("div",ve,[t("div",null,[e[33]||(e[33]=t("label",{class:"text-sm text-gray-600"},"প্রতিষ্ঠানের নাম",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.name=s),type:"text",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.name]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"text-sm text-gray-600"},"ফোন",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.phone=s),type:"text",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.phone]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"text-sm text-gray-600"},"এরিয়া",-1)),n(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.area_id=s),class:"border rounded px-3 py-2 w-full"},[e[35]||(e[35]=t("option",{value:"",disabled:""},"সিলেক্ট করুন",-1)),(d(!0),o(C,null,E(A.value,s=>(d(),o("option",{key:s.id,value:Number(s.id)},r(s.name)+" ("+r(s.area_code)+") ",9,fe))),128))],512),[[M,l.area_id,void 0,{number:!0}]])])]),t("div",xe,[t("div",null,[e[37]||(e[37]=t("label",{class:"text-sm text-gray-600"},"ঠিকানা",-1)),n(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.address=s),rows:"2",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.address]])]),t("div",ge,[t("div",null,[e[38]||(e[38]=t("label",{class:"text-sm text-gray-600"},"প্রতিষ্ঠার তারিখ",-1)),n(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.established_on=s),type:"date",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.established_on]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"text-sm text-gray-600"},"প্রতিষ্ঠাতা",-1)),n(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.founder_name=s),type:"text",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.founder_name]])])]),t("div",ke,[e[40]||(e[40]=t("div",{class:"font-medium mb-2"},"মূহতামিম",-1)),t("div",_e,[n(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.muhtamim.name=s),placeholder:"নাম",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.muhtamim.name]]),n(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.muhtamim.qualification=s),placeholder:"যোগ্যতা",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.muhtamim.qualification]]),n(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.muhtamim.ihtemam_years=s),type:"number",placeholder:"ইহতেমামের বছর",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.muhtamim.ihtemam_years,void 0,{number:!0}]])])]),t("div",null,[e[41]||(e[41]=t("label",{class:"text-sm text-gray-600"},"মাদরাসা কোন জামাত পর্যন্ত",-1)),n(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.upto_class=s),type:"text",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.upto_class]])]),t("div",he,[e[42]||(e[42]=t("div",{class:"font-medium mb-2"},"শিক্ষক / শিক্ষিকা সংখ্যা",-1)),t("div",ce,[n(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>l.teachers.maktab=s),type:"number",placeholder:"মক্তব",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.teachers.maktab,void 0,{number:!0}]]),n(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.teachers.hifz=s),type:"number",placeholder:"হিফজ",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.teachers.hifz,void 0,{number:!0}]]),n(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>l.teachers.kitab=s),type:"number",placeholder:"কিতাব",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.teachers.kitab,void 0,{number:!0}]]),t("input",{value:l.teachers.total??T(l.teachers.maktab,l.teachers.hifz,l.teachers.kitab),type:"number",placeholder:"মোট",class:"border rounded px-3 py-2 w-full",readonly:""},null,8,we)])]),t("div",Ue,[e[43]||(e[43]=t("div",{class:"font-medium mb-2"},"ছাত্র / ছাত্রী সংখ্যা",-1)),t("div",Ve,[n(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>l.students.maktab=s),type:"number",placeholder:"মক্তব",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.students.maktab,void 0,{number:!0}]]),n(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>l.students.hifz=s),type:"number",placeholder:"হিফজ",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.students.hifz,void 0,{number:!0}]]),n(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>l.students.kitab=s),type:"number",placeholder:"কিতাব",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.students.kitab,void 0,{number:!0}]]),t("input",{value:l.students.total??T(l.students.maktab,l.students.hifz,l.students.kitab),type:"number",placeholder:"মোট",class:"border rounded px-3 py-2 w-full",readonly:""},null,8,Ne)])]),t("div",ze,[t("label",Ae,[n(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>l.has_hostel=s),type:"checkbox"},null,512),[[D,l.has_hostel]]),e[44]||(e[44]=t("span",null,"আবাসিক ব্যবস্থা আছে কিনা?",-1))]),t("label",Se,[n(t("input",{"onUpdate:modelValue":e[19]||(e[19]=s=>l.has_library_for_students=s),type:"checkbox"},null,512),[[D,l.has_library_for_students]]),e[45]||(e[45]=t("span",null,"শিক্ষার্থীদের পাঠাগার আছে কিনা?",-1))]),t("label",Ce,[n(t("input",{"onUpdate:modelValue":e[20]||(e[20]=s=>l.has_kutubkhana=s),type:"checkbox"},null,512),[[D,l.has_kutubkhana]]),e[46]||(e[46]=t("span",null,"কুতুবখানা আছে কিনা?",-1))]),t("div",null,[e[47]||(e[47]=t("label",{class:"text-sm text-gray-600"},"কুতুবখানার কিতাব সংখ্যা",-1)),n(t("input",{"onUpdate:modelValue":e[21]||(e[21]=s=>l.kutubkhana.kitab_count=s),type:"number",class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.kutubkhana.kitab_count,void 0,{number:!0}]])])]),t("div",null,[e[48]||(e[48]=t("label",{class:"text-sm text-gray-600"},"ভূমির তথ্য",-1)),n(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=s=>l.land_info=s),class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.land_info]])]),t("div",null,[e[49]||(e[49]=t("label",{class:"text-sm text-gray-600"},"গৃহের সংক্ষিপ্ত বিবরণ",-1)),n(t("textarea",{"onUpdate:modelValue":e[23]||(e[23]=s=>l.building_summary=s),class:"border rounded px-3 py-2 w-full"},null,512),[[u,l.building_summary]])])]),t("div",Ee,[t("button",{onClick:e[24]||(e[24]=s=>i.value=1),type:"button",class:"px-4 py-2 rounded border"},"পিছনে"),t("button",{onClick:F,disabled:q.value,class:"px-5 py-2 rounded bg-blue-600 text-white disabled:opacity-60"},r(q.value?"সাবমিট হচ্ছে...":"সাবমিট করুন"),9,De)]),j(y).error?(d(),o("p",Ie,r(j(y).error),1)):k("",!0)])):k("",!0),i.value===3?(d(),o("section",Te,[t("div",qe,[e[51]||(e[51]=t("div",{class:"text-green-700 font-medium"},"আবেদন সফলভাবে গ্রহণ করা হয়েছে।",-1)),t("div",Me,[e[50]||(e[50]=V(" আপনার Application ID: ")),t("span",je,r(z.value),1)])]),t("div",We,[G(b,{class:"px-4 py-2 rounded bg-blue-600 text-white",to:{name:"InstituteApplicationTrack"}},{default:H(()=>e[52]||(e[52]=[V(" স্ট্যাটাস দেখুন ")])),_:1}),t("button",{class:"px-4 py-2 rounded border",onClick:e[25]||(e[25]=()=>{i.value=1,z.value=null,f.value="",_.value=null,g.value=[]})}," নতুন আবেদন ")])])):k("",!0)])])}}},Oe=K(Pe,[["__scopeId","data-v-f75e2825"]]);export{Oe as default};
