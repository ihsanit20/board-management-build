import{P as G,r as C,O as B,i as S,Q as V,_ as Q,m as H,o as J,c as y,a as e,b as s,j as h,v as w,G as R,D as W,t as v,h as D,y as A,F as T,e as X,p as Y,d as k}from"./index-CjHXjKej.js";const Z=G("expense",()=>{const _=C([]),i=C(null),x=C(!1),r=C(!1),E=C(!1),d=C(null),l=B({current_page:1,per_page:20,total:0,last_page:1}),g=B({purpose:"",amount:"",medium_user_id:null,description:"",date:"",voucher_no:""}),b=B({search:"",medium_user_id:"",date_from:"",date_to:"",page:1,per_page:20}),$=S(()=>!!d.value);function N(){g.purpose="",g.amount="",g.medium_user_id=null,g.description="",g.date="",g.voucher_no=""}function L(u){const p=u||{};typeof p.current_page<"u"&&(l.current_page=p.current_page),typeof p.per_page<"u"&&(l.per_page=Number(p.per_page)),typeof p.total<"u"&&(l.total=p.total),typeof p.last_page<"u"&&(l.last_page=p.last_page)}function O(u){return Array.isArray(u)?u:Array.isArray(u==null?void 0:u.data)?u.data:[]}async function F(u={}){var p,c;x.value=!0,d.value=null;try{const o={...b,...u,page:u.page??b.page??l.current_page,per_page:u.per_page??b.per_page??l.per_page},{data:m}=await V.get("/expenses",{params:o});return _.value=O(m),L(m),_.value}catch(o){return d.value=((c=(p=o==null?void 0:o.response)==null?void 0:p.data)==null?void 0:c.message)||o.message||"Failed to fetch expenses",[]}finally{x.value=!1}}async function j(u){var p,c;x.value=!0,d.value=null;try{const{data:o}=await V.get(`/expenses/${u}`);return i.value=o,o}catch(o){return d.value=((c=(p=o==null?void 0:o.response)==null?void 0:p.data)==null?void 0:c.message)||o.message||"Failed to fetch expense",null}finally{x.value=!1}}async function I(u={}){var p,c;r.value=!0,d.value=null;try{const o=Object.keys(u).length?u:{...g},{data:m}=await V.post("/expenses",o);return _.value.unshift(m),N(),m}catch(o){throw d.value=((c=(p=o==null?void 0:o.response)==null?void 0:p.data)==null?void 0:c.message)||o.message||"Failed to create expense",o}finally{r.value=!1}}async function q(u,p={}){var c,o,m;r.value=!0,d.value=null;try{const f=Object.keys(p).length?p:{...g},{data:U}=await V.put(`/expenses/${u}`,f),a=_.value.findIndex(t=>t.id===u);return a!==-1&&(_.value[a]=U),((c=i.value)==null?void 0:c.id)===u&&(i.value=U),U}catch(f){throw d.value=((m=(o=f==null?void 0:f.response)==null?void 0:o.data)==null?void 0:m.message)||f.message||"Failed to update expense",f}finally{r.value=!1}}async function M(u,p={}){var c,o,m;r.value=!0,d.value=null;try{const{data:f}=await V.patch(`/expenses/${u}`,p),U=_.value.findIndex(a=>a.id===u);return U!==-1&&(_.value[U]=f),((c=i.value)==null?void 0:c.id)===u&&(i.value=f),f}catch(f){throw d.value=((m=(o=f==null?void 0:f.response)==null?void 0:o.data)==null?void 0:m.message)||f.message||"Failed to patch expense",f}finally{r.value=!1}}async function z(u){var p,c,o;E.value=!0,d.value=null;try{return await V.delete(`/expenses/${u}`),_.value=_.value.filter(m=>m.id!==u),((p=i.value)==null?void 0:p.id)===u&&(i.value=null),!0}catch(m){return d.value=((o=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:o.message)||m.message||"Failed to delete expense",!1}finally{E.value=!1}}return{expenses:_,expense:i,form:g,filters:b,loading:x,saving:r,deleting:E,error:d,hasError:$,pagination:l,fetchExpenses:F,fetchExpense:j,createExpense:I,updateExpense:q,patchExpense:M,deleteExpense:z,resetForm:N}}),ee={class:"my-container space-y-4 py-6"},te={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},se={class:"flex gap-2"},ae=["disabled"],ne={class:"card-bg grid grid-cols-1 gap-3 p-4 sm:grid-cols-2 lg:grid-cols-5"},le={class:"sm:col-span-2 lg:col-span-5 flex gap-2"},ie=["disabled"],oe=["disabled"],ue={key:0,class:"text-red-600"},de={class:"card-bg p-4"},re={class:"sm:col-span-2 lg:col-span-5 rounded-lg border bg-gray-50 p-3 flex flex-wrap items-center justify-between gap-3"},pe={class:"text-sm"},ce={class:"text-sm"},me={class:"overflow-x-auto"},fe={class:"min-w-full overflow-hidden rounded-lg bg-white shadow"},ge={key:0},ve={key:1},_e={class:"px-4 py-2 whitespace-nowrap"},xe={class:"px-4 py-2"},be={class:"px-4 py-2 whitespace-nowrap"},ye={class:"px-4 py-2"},he={class:"px-4 py-2"},ke={key:0},we={class:"text-xs text-gray-500"},Ee={key:1},Ue={key:2,class:"text-gray-400"},Ce={class:"px-4 py-2"},Fe={class:"flex gap-2"},$e=["onClick"],Ve=["onClick","disabled"],Se={key:0,class:"flex items-center justify-between gap-3"},Ne={class:"text-sm text-gray-600"},je={class:"flex items-center gap-2"},Me=["disabled"],Ae=["disabled"],Ie={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},De={class:"relative z-10 w-full max-w-2xl rounded-xl bg-white p-6 shadow-xl"},Le={class:"mb-4 flex items-center justify-between"},Oe={class:"text-xl font-semibold"},qe={class:"sm:col-span-2"},ze={class:"sm:col-span-2"},Be=["value"],Pe={class:"sm:col-span-2 mt-2 flex items-center justify-end gap-2"},Te=["disabled"],Ke={__name:"ManageExpense",setup(_){const i=Z(),x=H(),r=i.filters,E=S(()=>i.expenses),d=i.pagination,l=i.form,g=C(!1),b=C(!1),$=C(null),N=()=>new Date().toLocaleDateString("en-CA"),L=S(()=>E.value.length),O=S(()=>E.value.reduce((a,t)=>a+Number((t==null?void 0:t.amount)??0),0)),F=S(()=>{var a;return((a=x.user)==null?void 0:a.id)??null}),j=S(()=>{var a;return((a=x.user)==null?void 0:a.name)??""});J(async()=>{var a;if(!((a=x.user)!=null&&a.id)&&x.fetchUser)try{await x.fetchUser()}catch{}await i.fetchExpenses()});function I(){r.page=1,i.fetchExpenses({...r})}function q(){r.search="",r.medium_user_id="",r.date_from="",r.date_to="",r.page=1,r.per_page=20,i.fetchExpenses({...r})}function M(a){a<1||a>d.last_page||(r.page=a,i.fetchExpenses({page:a}))}function z(){i.fetchExpenses({page:d.current_page})}function u(){b.value=!1,$.value=null,i.resetForm(),l.medium_user_id=F.value,l.date||(l.date=N()),g.value=!0}function p(a){b.value=!0,$.value=a.id,l.purpose=a.purpose,l.amount=a.amount,l.medium_user_id=a.medium_user_id,l.description=a.description||"",l.date=a.date||"",l.voucher_no=a.voucher_no||"",g.value=!0}function c(){g.value=!1}async function o(){try{b.value||(l.medium_user_id=F.value,l.date||(l.date=N())),b.value&&$.value?await i.updateExpense($.value):await i.createExpense(),g.value=!1,await i.fetchExpenses({page:d.current_page})}catch{}}async function m(a){if(!confirm(`মুছে ফেলতে চান? #${a.id}`))return;await i.deleteExpense(a.id)&&(!E.value.length&&d.current_page>1?M(d.current_page-1):await i.fetchExpenses({page:d.current_page}))}function f(a){if(!a)return"—";try{return new Date(a).toISOString().slice(0,10)}catch{return a}}function U(a){const t=Number(a);return Number.isNaN(t)?a:t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}return(a,t)=>(k(),y(T,null,[e("div",ee,[e("div",te,[t[15]||(t[15]=e("h1",{class:"title-lg"},"খরচ ব্যবস্থাপনা",-1)),e("div",se,[e("button",{class:"btn-2",onClick:t[0]||(t[0]=n=>u())},"+ নতুন এন্ট্রি"),e("button",{class:"btn-1",onClick:t[1]||(t[1]=n=>z()),disabled:s(i).loading},"রিফ্রেশ",8,ae)])]),e("div",ne,[e("div",null,[t[16]||(t[16]=e("label",{class:"label"},"সার্চ",-1)),h(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s(r).search=n),onKeyup:R(I,["enter"]),type:"text",class:"input-1",placeholder:"বাবদ/ভাউচার/ডেসক্রিপশন"},null,544),[[w,s(r).search]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"label"},"তারিখ (থেকে)",-1)),h(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>s(r).date_from=n),type:"date",class:"input-1"},null,512),[[w,s(r).date_from]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"label"},"তারিখ (পর্যন্ত)",-1)),h(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>s(r).date_to=n),type:"date",class:"input-1"},null,512),[[w,s(r).date_to]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"label"},"ব্যক্তি (User ID)",-1)),h(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>s(r).medium_user_id=n),type:"number",class:"input-1",placeholder:"উদাহরণ: 7"},null,512),[[w,s(r).medium_user_id]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"label"},"প্রতি পৃষ্ঠা",-1)),h(e("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>s(r).per_page=n),class:"input-1"},t[20]||(t[20]=[e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[W,s(r).per_page,void 0,{number:!0}]])]),e("div",le,[e("button",{class:"btn-1",onClick:I,disabled:s(i).loading}," ফিল্টার প্রযোজ্য ",8,ie),e("button",{class:"btn-ghost",onClick:q,disabled:s(i).loading}," রিসেট ",8,oe),s(i).error?(k(),y("p",ue,v(s(i).error),1)):D("",!0)])]),e("div",de,[e("div",re,[e("div",pe,[t[22]||(t[22]=A(" মোট (ভিজিবল): ")),e("strong",null,v(L.value),1)]),e("div",ce,[t[23]||(t[23]=A(" মোট খরচ (ভিজিবল): ")),e("strong",null,v(U(O.value)),1)])])]),e("div",me,[e("table",fe,[t[26]||(t[26]=e("thead",null,[e("tr",{class:"bg-gray-200 text-left text-sm uppercase tracking-wider text-gray-700"},[e("th",{class:"px-4 py-2"},"তারিখ"),e("th",{class:"px-4 py-2"},"বাবদ"),e("th",{class:"px-4 py-2"},"এমাউন্ট"),e("th",{class:"px-4 py-2"},"ভাউচার"),e("th",{class:"px-4 py-2"},"মাধ্যম (ব্যক্তি)"),e("th",{class:"px-4 py-2 w-40"},"অ্যাকশন")])],-1)),e("tbody",null,[s(i).loading?(k(),y("tr",ge,t[24]||(t[24]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"},"লোড হচ্ছে...",-1)]))):E.value.length?D("",!0):(k(),y("tr",ve,t[25]||(t[25]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"},"কোনো ডাটা নেই",-1)]))),(k(!0),y(T,null,X(E.value,n=>{var P;return k(),y("tr",{key:n.id,class:"border-t"},[e("td",_e,v(f(n.date)),1),e("td",xe,v(n.purpose),1),e("td",be,v(U(n.amount)),1),e("td",ye,v(n.voucher_no||"—"),1),e("td",he,[(P=n.medium_user)!=null&&P.name?(k(),y("span",ke,[A(v(n.medium_user.name)+" ",1),e("span",we,"(#"+v(n.medium_user_id)+")",1)])):n.medium_user_id?(k(),y("span",Ee,"User #"+v(n.medium_user_id),1)):(k(),y("span",Ue,"—"))]),e("td",Ce,[e("div",Fe,[e("button",{class:"btn-xs",onClick:K=>p(n)},"এডিট",8,$e),e("button",{class:"btn-xs-danger",onClick:K=>m(n),disabled:s(i).deleting}," ডিলিট ",8,Ve)])])])}),128))])])]),s(d).last_page>1?(k(),y("div",Se,[e("div",Ne," পৃষ্ঠা "+v(s(d).current_page)+" / "+v(s(d).last_page)+" • মোট "+v(s(d).total),1),e("div",je,[e("button",{class:"btn-ghost",disabled:s(d).current_page<=1||s(i).loading,onClick:t[7]||(t[7]=n=>M(s(d).current_page-1))}," পূর্ববর্তী ",8,Me),e("button",{class:"btn-ghost",disabled:s(d).current_page>=s(d).last_page||s(i).loading,onClick:t[8]||(t[8]=n=>M(s(d).current_page+1))}," পরবর্তী ",8,Ae)])])):D("",!0)]),g.value?(k(),y("div",Ie,[e("div",{class:"absolute inset-0 bg-black/40",onClick:c}),e("div",De,[e("div",Le,[e("h2",Oe,v(b.value?"খরচ এডিট":"নতুন খরচ"),1),e("button",{class:"btn-ghost",onClick:c},"✕")]),e("form",{onSubmit:Y(o,["prevent"]),class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},[e("div",qe,[t[27]||(t[27]=e("label",{class:"label"},[A("বাবদ "),e("span",{class:"text-red-500"},"*")],-1)),h(e("input",{"onUpdate:modelValue":t[9]||(t[9]=n=>s(l).purpose=n),type:"text",class:"input-1",required:""},null,512),[[w,s(l).purpose]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"label"},[A("এমাউন্ট "),e("span",{class:"text-red-500"},"*")],-1)),h(e("input",{"onUpdate:modelValue":t[10]||(t[10]=n=>s(l).amount=n),type:"number",step:"0.01",min:"0",class:"input-1",required:""},null,512),[[w,s(l).amount,void 0,{number:!0}]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"label"},"তারিখ",-1)),h(e("input",{"onUpdate:modelValue":t[11]||(t[11]=n=>s(l).date=n),type:"date",class:"input-1"},null,512),[[w,s(l).date]])]),e("div",ze,[t[30]||(t[30]=e("label",{class:"label"},"ডেসক্রিপশন",-1)),h(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=n=>s(l).description=n),class:"input-1 min-h-[90px]"},null,512),[[w,s(l).description]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"label"},"ভাউচার নং",-1)),h(e("input",{"onUpdate:modelValue":t[13]||(t[13]=n=>s(l).voucher_no=n),type:"text",class:"input-1"},null,512),[[w,s(l).voucher_no]])]),e("div",null,[t[32]||(t[32]=e("label",{class:"label"},"ব্যক্তি (User)",-1)),h(e("input",{type:"hidden","onUpdate:modelValue":t[14]||(t[14]=n=>s(l).medium_user_id=n)},null,512),[[w,s(l).medium_user_id,void 0,{number:!0}]]),e("input",{value:s(l).medium_user_id?F.value===s(l).medium_user_id&&j.value?`${j.value} (#${s(l).medium_user_id})`:`User #${s(l).medium_user_id}`:F.value?`${j.value||"User"} (#${F.value})`:"—",class:"input-1",disabled:""},null,8,Be)]),e("div",Pe,[e("button",{type:"button",class:"btn-3",onClick:c},"ক্যানসেল"),e("button",{type:"submit",class:"btn-2",disabled:s(i).saving},v(s(i).saving?"সংরক্ষণ হচ্ছে...":b.value?"আপডেট":"সংরক্ষণ"),9,Te)])],32)])])):D("",!0)],64))}},Qe=Q(Ke,[["__scopeId","data-v-9e2629a9"]]);export{Qe as default};
