import{r as y,o as E,B as L,c as n,a as t,j as d,C as h,F as p,e as c,b as g,f as N,w as j,p as B,z as M,d as i,t as v,v as _,D as T,h as G,y as K}from"./index-BBFE9kUS.js";import{a as q,u as F}from"./para-group-CFamqJII.js";import{u as P}from"./zamat-yUeD6_5T.js";import{u as R}from"./center-BNLFNNtV.js";const A={class:"my-container space-y-4"},H={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},J=["label"],O=["value"],W=["disabled"],X=["value"],Y=["disabled"],Z=["value"],I={class:"space-y-2 w-full"},ee={class:"font-bold"},te={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},se=["onUpdate:modelValue"],ae={class:"relative"},oe=["onUpdate:modelValue","onKeyup"],re=["onClick"],le=["onUpdate:modelValue"],ne=["onUpdate:modelValue"],ie=["onClick"],ue={class:"mt-4 flex gap-4 justify-between"},_e={__name:"QuranQuestionAdd",setup(de){const f=R(),x=P(),b=q(),z=F(),w=y(!1),C=y("");E(async()=>{try{w.value=!0,await x.fetchZamats()}catch(l){C.value="ডাটা লোড করতে সমস্যা হয়েছে।",console.error(l)}finally{w.value=!1}});const a=y({center_id:"",zamat_id:"",para_group_id:"",questions:[{id:Date.now(),surah:"",verses:"",text:"",page:""}]});L(()=>a.value.zamat_id,async l=>{if(!l){a.value.center_id="",f.centers=[],b.paraGroups=[];return}try{const s=typeof l=="object"?l.id:l;await f.fetchCenters({zamat_id:s}),await b.fetchParaGroups({zamat_id:s})}catch(s){console.error("Error fetching data:",s),alert("ডেটা লোড করতে সমস্যা হয়েছে।")}});const U=()=>{a.value.questions.push({id:Date.now(),surah:"",verses:"",text:"",page:""})},D=l=>{a.value.questions.splice(l,1)},$=async()=>{try{await z.createQuestion(a.value),alert("কুরআন প্রশ্ন সফলভাবে যোগ করা হয়েছে!"),a.value={center_id:"",zamat_id:"",para_group_id:"",questions:[{id:Date.now(),surah:"",verses:"",text:"",page:""}]}}catch(l){console.error("Error adding Quran question:",l)}},k=async(l,s)=>{try{const{surah:u,verses:e}=l;if(!u||!e){alert("সুরা এবং আয়াত নম্বর সঠিকভাবে দিন।");return}const[o,r]=e.split("-").map(Number);if(!o||!r||o>r){alert("আয়াত নম্বর সঠিকভাবে দিন।");return}let V="";for(let m=o;m<=r;m++){const Q=await fetch(`https://api.quran.com/api/v4/verses/by_key/${u}:${m}?fields=text_uthmani`);if(!Q.ok)throw new Error("কুরআন ডেটা ফেচ করতে সমস্যা হয়েছে।");const S=await Q.json();S.verse?V+=`${S.verse.text_uthmani} - `:alert(`সুরা ${u} এবং আয়াত ${m} পাওয়া যায়নি।`)}a.value.questions[s].text=V.trimEnd(" - ")}catch(u){console.error("Error fetching Quran text:",u),alert("কুরআন টেক্সট লোড করতে সমস্যা হয়েছে।")}};return(l,s)=>{const u=M("RouterLink");return i(),n("div",A,[s[11]||(s[11]=t("div",null,[t("h1",{class:"title-lg"},"কুরআন প্রশ্ন যোগ করুন")],-1)),t("form",{onSubmit:B($,["prevent"]),class:"card-bg md:p-8 p-4"},[t("div",H,[t("div",null,[d(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>a.value.zamat_id=e),class:"input-1",required:""},[s[3]||(s[3]=t("option",{value:"",disabled:""},"-মারহালা সিলেক্ট করুন-",-1)),(i(!0),n(p,null,c(g(x).departments,e=>(i(),n("optgroup",{label:e.name,key:e.id},[(i(!0),n(p,null,c(e.zamats,o=>(i(),n("option",{key:o.id,value:o.id},v(o.name),9,O))),128))],8,J))),128))],512),[[h,a.value.zamat_id]])]),t("div",null,[d(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>a.value.para_group_id=e),class:"input-1",disabled:!a.value.zamat_id},[s[4]||(s[4]=t("option",{value:"",disabled:""},"-পারা গ্রুপ নির্বাচন করুন-",-1)),(i(!0),n(p,null,c(g(b).paraGroups,e=>(i(),n("option",{key:e.id,value:e.id},v(e.name),9,X))),128))],8,W),[[h,a.value.para_group_id]])]),t("div",null,[d(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>a.value.center_id=e),class:"input-1",disabled:!a.value.zamat_id,required:""},[s[5]||(s[5]=t("option",{value:"",disabled:""},"-মারকায নির্বাচন করুন-",-1)),(i(!0),n(p,null,c(g(f).centers,e=>{var o;return i(),n("option",{key:e.id,value:e==null?void 0:e.institute_id},v((o=e==null?void 0:e.institute)==null?void 0:o.name),9,Z)}),128))],8,Y),[[h,a.value.center_id]])])]),s[10]||(s[10]=t("h2",{class:"title-md text-center"},"প্রশ্নসমূহ",-1)),(i(!0),n(p,null,c(a.value.questions,(e,o)=>(i(),n("div",{key:e.id,class:"flex items-center gap-2 border p-4 rounded-md space-y-2 w-full"},[t("div",I,[t("p",ee,v(Number(o+1).toLocaleString("bn-BD"))+" নং প্রশ্ন:",1),t("div",te,[t("div",null,[d(t("input",{"onUpdate:modelValue":r=>e.surah=r,type:"number",placeholder:"সুরা নম্বর",class:"input-1",required:""},null,8,se),[[_,e.surah]])]),t("div",ae,[d(t("input",{"onUpdate:modelValue":r=>e.verses=r,type:"text",class:"input-1",placeholder:"আয়াত (উদাহরণ: 1-5)",onKeyup:T(r=>k(e,o),["enter"])},null,40,oe),[[_,e.verses]]),e.verses?(i(),n("button",{key:0,onClick:r=>k(e,o),class:"absolute right-3 top-2.5",type:"button"},s[6]||(s[6]=[t("i",{class:"fas fa-search"},null,-1)]),8,re)):G("",!0)]),t("div",null,[d(t("input",{"onUpdate:modelValue":r=>e.page=r,type:"number",placeholder:"পৃষ্ঠা নম্বর",class:"input-1"},null,8,le),[[_,e.page]])])]),t("div",null,[d(t("textarea",{"onUpdate:modelValue":r=>e.text=r,placeholder:"কুরআনের টেক্সট",class:"input-1",required:"",dir:"rtl"},null,8,ne),[[_,e.text]])])]),t("button",{type:"button",onClick:r=>D(o),class:"btn-icon"},s[7]||(s[7]=[t("i",{class:"fas fa-trash-alt text-red-600"},null,-1)]),8,ie)]))),128)),t("div",{class:"flex justify-center"},[t("button",{type:"button",onClick:U,class:"btn-4"},"আরও প্রশ্ন যোগ করুন")]),t("div",ue,[N(u,{to:{name:"QuranQuestionList"},type:"submit",class:"btn-contrast"},{default:j(()=>s[8]||(s[8]=[K("পিছনে যান")])),_:1}),s[9]||(s[9]=t("button",{type:"submit",class:"btn-2"},"সংরক্ষণ করুন",-1))])],32)])}}};export{_e as default};
