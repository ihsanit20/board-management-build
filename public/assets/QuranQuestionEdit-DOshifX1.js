import{r as x,C as q,o as B,c as i,a as t,k as j,p as G,j as p,D as w,F as m,e as c,b as h,f as M,w as T,q as F,z as K,d as n,t as f,v as y,G as R,h as P,y as I,L as A}from"./index-DcmbdSU1.js";import{u as H}from"./quran-question-BtX01Cen.js";import{u as J}from"./zamat-DaN8wqYw.js";import{u as O}from"./center-CrmPQKsS.js";import{u as W}from"./para-group-DA_KMOxo.js";const X={class:"my-container space-y-4"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Z=["label"],ee=["value"],te=["disabled"],ae=["value"],se=["disabled"],oe=["value"],re={class:"space-y-2 w-full"},le={class:"font-bold"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ie=["onUpdate:modelValue"],ue={class:"relative"},de=["onUpdate:modelValue","onKeyup"],pe=["onClick"],me=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],ve=["onClick"],fe={class:"mt-4 flex gap-4 justify-between"},he={__name:"QuranQuestionEdit",setup(ye){const b=O(),V=J(),_=W(),z=H(),g=F().params.id,u=x(!1),k=x(""),o=x({center_id:"",zamat_id:"",para_group_id:"",questions:[]}),E=async()=>{try{u.value=!0;const s=await z.fetchQuestionById(g);if(!s)throw new Error(`No data found for question ID: ${g}`);o.value={center_id:s.center_id||"",zamat_id:s.zamat_id||"",para_group_id:s.para_group_id||"",questions:s.questions||[]},s.zamat_id&&await Q(s.zamat_id)}catch(s){k.value="ফর্ম ডেটা লোড করতে সমস্যা হয়েছে।",console.error("Error loading form data:",s)}finally{u.value=!1}},Q=async s=>{if(!s){b.centers=[],_.paraGroups=[];return}try{u.value=!0,await b.fetchCenters({zamat_id:s}),await _.fetchParaGroups({zamat_id:s})}catch(e){k.value="সেন্টার বা পাড়া গ্রুপ লোড করতে সমস্যা হয়েছে।",console.error(e)}finally{u.value=!1}};q(()=>o.value.zamat_id,async s=>{await Q(s)});const S=async(s,e)=>{try{const{surah:d,verses:a}=s;if(!d||!a){alert("সুরা এবং আয়াত নম্বর সঠিকভাবে দিন।");return}const[r,l]=a.split("-").map(Number);if(!r||!l||r>l){alert("আয়াত নম্বর সঠিকভাবে দিন।");return}let C="";for(let v=r;v<=l;v++){const U=await fetch(`https://api.quran.com/api/v4/verses/by_key/${d}:${v}?fields=text_uthmani`);if(!U.ok)throw new Error("কুরআন ডেটা ফেচ করতে সমস্যা হয়েছে।");const D=await U.json();D.verse?C+=`${D.verse.text_uthmani} - `:alert(`সুরা ${d} এবং আয়াত ${v} পাওয়া যায়নি।`)}o.value.questions[e].text=C.trimEnd(" - ")}catch(d){console.error("Error fetching Quran text:",d),alert("কুরআন টেক্সট লোড করতে সমস্যা হয়েছে।")}},$=async()=>{try{u.value=!0,await z.updateQuestion(g,o.value),alert("কুরআন প্রশ্ন সফলভাবে আপডেট করা হয়েছে!")}catch(s){console.error("Error updating Quran question:",s),alert("কুরআন প্রশ্ন আপডেট করতে সমস্যা হয়েছে।")}finally{u.value=!1}},L=()=>{o.value.questions.push({id:Date.now(),surah:"",verses:"",text:"",page:""})},N=s=>{o.value.questions.splice(s,1)};return B(async()=>{try{u.value=!0,await V.fetchZamats(),await E()}catch(s){k.value="ডাটা লোড করতে সমস্যা হয়েছে।",console.error(s)}finally{u.value=!1}}),(s,e)=>{const d=K("RouterLink");return n(),i("div",X,[e[18]||(e[18]=t("div",null,[t("h1",{class:"title-lg"},"কুরআন প্রশ্ন সম্পাদনা করুন")],-1)),u.value?(n(),j(A,{key:0})):(n(),i("form",{key:1,onSubmit:G($,["prevent"]),class:"card-bg md:p-8 p-4"},[t("div",Y,[t("div",null,[e[4]||(e[4]=t("label",{for:"zamat_id",class:"block text-gray-700 font-medium"},"মারহালা নির্বাচন করুন",-1)),p(t("select",{id:"zamat_id","onUpdate:modelValue":e[0]||(e[0]=a=>o.value.zamat_id=a),class:"input-1",required:""},[e[3]||(e[3]=t("option",{value:"",disabled:""},"-মারহালা সিলেক্ট করুন-",-1)),(n(!0),i(m,null,c(h(V).departments,a=>(n(),i("optgroup",{label:a.name,key:a.id},[(n(!0),i(m,null,c(a.zamats,r=>(n(),i("option",{key:r.id,value:r.id},f(r.name),9,ee))),128))],8,Z))),128))],512),[[w,o.value.zamat_id]])]),t("div",null,[e[6]||(e[6]=t("label",{for:"para_group_id",class:"block text-gray-700 font-medium"},"পাড়া গ্রুপ নির্বাচন করুন",-1)),p(t("select",{id:"para_group_id","onUpdate:modelValue":e[1]||(e[1]=a=>o.value.para_group_id=a),class:"input-1",disabled:!o.value.zamat_id},[e[5]||(e[5]=t("option",{value:"",disabled:""},"-পাড়া গ্রুপ নির্বাচন করুন-",-1)),(n(!0),i(m,null,c(h(_).paraGroups,a=>(n(),i("option",{key:a.id,value:a.id},f(a.name),9,ae))),128))],8,te),[[w,o.value.para_group_id]])]),t("div",null,[e[8]||(e[8]=t("label",{for:"center_id",class:"block text-gray-700 font-medium"},"মারকায নির্বাচন করুন",-1)),p(t("select",{id:"center_id","onUpdate:modelValue":e[2]||(e[2]=a=>o.value.center_id=a),class:"input-1",disabled:!o.value.zamat_id,required:""},[e[7]||(e[7]=t("option",{value:"",disabled:""},"-মারকায নির্বাচন করুন-",-1)),(n(!0),i(m,null,c(h(b).centers,a=>{var r;return n(),i("option",{key:a.id,value:a==null?void 0:a.institute_id},f((r=a==null?void 0:a.institute)==null?void 0:r.name),9,oe)}),128))],8,se),[[w,o.value.center_id]])])]),e[17]||(e[17]=t("h2",{class:"title-md text-center"},"প্রশ্নসমূহ",-1)),(n(!0),i(m,null,c(o.value.questions,(a,r)=>(n(),i("div",{key:a.id,class:"flex items-center gap-2 border p-4 rounded-md space-y-2 w-full bg-gray-50"},[t("div",re,[t("p",le,f(Number(r+1).toLocaleString("bn-BD"))+" নং প্রশ্ন:",1),t("div",ne,[t("div",null,[e[9]||(e[9]=t("label",{for:"surah",class:"block text-gray-700 font-medium"},"সুরা নম্বর",-1)),p(t("input",{id:"surah","onUpdate:modelValue":l=>a.surah=l,type:"number",placeholder:"সুরা নম্বর",class:"input-1",required:""},null,8,ie),[[y,a.surah]])]),t("div",null,[e[11]||(e[11]=t("label",{for:"verses",class:"block text-gray-700 font-medium"},"আয়াত",-1)),t("div",ue,[p(t("input",{id:"verses","onUpdate:modelValue":l=>a.verses=l,type:"text",class:"input-1",placeholder:"আয়াত (উদাহরণ: 1-5)",onKeyup:R(l=>S(a,r),["enter"])},null,40,de),[[y,a.verses]]),a.verses?(n(),i("button",{key:0,onClick:l=>S(a,r),class:"absolute right-3 top-2.5"},e[10]||(e[10]=[t("i",{class:"fas fa-search"},null,-1)]),8,pe)):P("",!0)])]),t("div",null,[e[12]||(e[12]=t("label",{for:"page",class:"block text-gray-700 font-medium"},"পৃষ্ঠা নম্বর",-1)),p(t("input",{id:"page","onUpdate:modelValue":l=>a.page=l,type:"number",placeholder:"পৃষ্ঠা নম্বর",class:"input-1"},null,8,me),[[y,a.page]])])]),t("div",null,[e[13]||(e[13]=t("label",{for:"text",class:"block text-gray-700 font-medium"},"কুরআনের টেক্সট",-1)),p(t("textarea",{id:"text","onUpdate:modelValue":l=>a.text=l,placeholder:"কুরআনের টেক্সট",class:"input-1",dir:"rtl",required:""},null,8,ce),[[y,a.text]])])]),t("button",{type:"button",onClick:l=>N(r),class:"btn-icon"},e[14]||(e[14]=[t("i",{class:"fas fa-trash-alt text-red-600"},null,-1)]),8,ve)]))),128)),t("div",{class:"flex justify-center"},[t("button",{type:"button",onClick:L,class:"btn-4"},"আরও প্রশ্ন যোগ করুন")]),t("div",fe,[M(d,{to:{name:"QuranQuestionList"},type:"button",class:"btn-contrast"},{default:T(()=>e[15]||(e[15]=[I(" পিছনে যান ")])),_:1}),e[16]||(e[16]=t("button",{type:"submit",class:"btn-2"},"সংরক্ষণ করুন",-1))])],32))])}}};export{he as default};
