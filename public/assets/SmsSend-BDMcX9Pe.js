import{_ as j,r as a,i as z,A as N,c as i,a as s,n as y,m as B,P as U,z as S,F as G,e as X,t as n,v as q,b as O,h as R,d as u,q as H}from"./index-BUH1Oswi.js";import{u as J}from"./sms-DupXTaQ5.js";import{u as K}from"./institute-D5Zcg_H7.js";const Q={class:"my-container space-y-4 card-bg p-8"},Y={class:"flex justify-center gap-2"},Z={class:"mb-4"},ee={class:"mb-4"},se={class:"overflow-y-auto max-h-64 relative"},te={class:"table-auto w-full text-left"},le={class:"bg-gray-50"},ae={key:0},oe={class:"border px-4 py-2"},ne=["checked","onChange"],ie={class:"border px-4 py-2"},ue={class:"border px-4 py-2"},ce={class:"border px-4 py-2"},re={class:"mb-4"},de={class:"text-gray-700"},ve={class:"mb-4"},pe={class:"mb-4"},fe={for:"message",class:"block text-gray-700"},he={class:""},me={class:"flex justify-center"},_e=["disabled"],be={key:0,class:"fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},ge={class:"bg-white p-6 rounded shadow-lg text-center"},xe={key:0},ye={key:1},Se={key:0,class:"text-red-600 text-4xl"},ke={key:1,class:"text-green-600 text-4xl"},we=.5,Ie={__name:"SmsSend",setup(Ce){const _=J(),v=K(),F=H(),r=a(""),o=a([]),p=a([]),b=a(""),f=a(!1),k=a(!1),L=a("all"),h=a(!1),g=a(""),c=a(""),w=a("GSM_7BIT_EX"),I=a(0),d=a(0),m=a(160),C=a(0),x=a(!1),P=z(()=>o.value.length),M=z(()=>p.value.filter(t=>t.phone)),T=async t=>{k.value=!0,b.value=t,o.value=[],x.value=!1;const e={per_page:L.value};t==="with"?(await v.fetchInstitutesWithApplications(),p.value=[...v.institutesWithApplications]):t==="without"?(await v.fetchInstitutesWithoutApplications(),p.value=[...v.institutesWithoutApplications]):(await v.fetchInstitutes(e),p.value=[...v.institutes]),k.value=!1},V=async()=>{if(o.value.length===0){_.error="Please select at least one institute",h.value=!0,f.value=!1,c.value=_.error;return}h.value=!0,f.value=!0;const t=p.value.filter(e=>o.value.includes(e.id));try{for(const e of t)if(!(await _.sendSms({number:e.phone,message:r.value,institute_name:e.name,institute_code:e.institute_code,sms_parts:d.value,cost:C.value})).success)throw new Error("SMS sending failed on server");g.value="SMS sent successfully!",c.value="",r.value="",o.value=[],x.value=!1,setTimeout(()=>{h.value=!1,g.value="",F.push({name:"SmsLogs"})},3e3)}catch(e){f.value=!1,g.value="",c.value=e.message||"Failed to send SMS",setTimeout(()=>{h.value=!1,c.value=""},3e3)}finally{f.value=!1}},$=t=>{const e=o.value.findIndex(l=>l===t.id);e!==-1?o.value.splice(e,1):o.value.push(t.id)},A=t=>o.value.includes(t.id),D=t=>{t.target.checked?M.value.forEach(e=>{A(e)||o.value.push(e.id)}):M.value.forEach(e=>{const l=o.value.findIndex(E=>E===e.id);l!==-1&&o.value.splice(l,1)})},W=()=>{const t=r.value.length;/^[\x00-\x7F]*$/.test(r.value)?(w.value="GSM_7BIT_EX",I.value=t,t<=160?(d.value=1,m.value=160-t):(d.value=Math.ceil(t/153),m.value=153-t%153)):(w.value="UTF16",I.value=t,t<=70?(d.value=1,m.value=70-t):(d.value=Math.ceil(t/67),m.value=67-t%67)),C.value=d.value*we};return N(r,()=>{W()}),(t,e)=>(u(),i("div",Q,[e[13]||(e[13]=s("h2",{class:"title-xl text-center"},"এসএমএস পাঠান",-1)),s("div",Y,[s("button",{class:y(["btn-1",{"btn-2":b.value==="all"}]),onClick:e[0]||(e[0]=l=>T("all"))}," সকল মাদরাসা ",2),s("button",{class:y(["btn-1",{"btn-2":b.value==="with"}]),onClick:e[1]||(e[1]=l=>T("with"))}," নিবন্ধন করেছে ",2),s("button",{class:y(["btn-1",{"btn-2":b.value==="without"}]),onClick:e[2]||(e[2]=l=>T("without"))}," নিবন্ধন করেনি ",2)]),s("div",null,[s("div",Z,[s("label",null,[B(s("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=l=>x.value=l),onChange:D},null,544),[[U,x.value]]),e[5]||(e[5]=S(" Select/Deselect All "))])]),s("div",ee,[s("div",se,[s("table",te,[e[7]||(e[7]=s("thead",{class:"bg-gray-200 sticky top-0 z-10"},[s("tr",null,[s("th",{class:"border px-4 py-2"},"সিলেক্ট"),s("th",{class:"border px-4 py-2"},"ইলহাক"),s("th",{class:"border px-4 py-2"},"মাদরাসার নাম ও ঠিকানা"),s("th",{class:"border px-4 py-2"},"ফোন নাম্বার")])],-1)),s("tbody",le,[k.value?(u(),i("tr",ae,e[6]||(e[6]=[s("td",{colspan:"4",class:"text-center py-4"},[s("div",{class:"loader mx-auto"})],-1)]))):(u(!0),i(G,{key:1},X(M.value,l=>(u(),i("tr",{key:l.id},[s("td",oe,[s("input",{type:"checkbox",checked:A(l),onChange:E=>$(l)},null,40,ne)]),s("td",ie,n(l.institute_code),1),s("td",ue,n(l.name),1),s("td",ce,n(l.phone),1)]))),128))])])])])]),s("div",re,[s("p",de,"নাম্বার নির্বাচন করা হয়েছে: "+n(P.value)+" টি",1)]),s("div",ve,[s("p",null,[e[8]||(e[8]=s("strong",null,"প্রতি SMS:",-1)),S(" "+n(C.value)+" টাকা",1)])]),s("div",pe,[s("label",fe,[e[9]||(e[9]=S("Message (")),s("span",null,n(d.value),1),S(") ভাষা: "+n(w.value),1)]),s("div",he,[B(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>r.value=l),class:"input-1 w-full",rows:"4"},null,512),[[q,r.value]]),s("p",null,n(I.value)+"/"+n(m.value),1)])]),s("div",me,[s("button",{type:"submit",class:"btn-2",onClick:V,disabled:O(_).loading}," Send SMS ",8,_e)]),h.value?(u(),i("div",be,[s("div",ge,[f.value?(u(),i("div",xe,e[10]||(e[10]=[s("div",{class:"loader mx-auto"},null,-1),s("p",null,"Sending SMS...",-1)]))):(u(),i("div",ye,[c.value?(u(),i("span",Se,e[11]||(e[11]=[s("i",{class:"fas fa-times-circle"},null,-1)]))):(u(),i("span",ke,e[12]||(e[12]=[s("i",{class:"fas fa-check-circle"},null,-1)]))),s("p",{class:y([{"text-green-600":!c.value,"text-red-600":c.value},"font-semibold"])},n(c.value||g.value),3)]))])])):R("",!0)]))}},Ee=j(Ie,[["__scopeId","data-v-1531bf5c"]]);export{Ee as default};
