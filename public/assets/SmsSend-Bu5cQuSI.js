import{r as a,i as B,C as U,c as i,a as e,n as I,j as E,N as z,y,f as G,F as W,e as X,t as n,v as O,b as R,k as q,h as H,d as u,L as P,s as J}from"./index-CSv3p2Td.js";import{u as K}from"./sms-DK9kCjoz.js";import{u as Q}from"./institute-DVSrI-IG.js";const Y={class:"my-container space-y-4 card-bg p-8"},Z={class:"flex justify-center gap-2"},ee={class:"mb-4"},se={class:"mb-4"},te={class:"overflow-y-auto max-h-64 relative"},le={class:"table-auto w-full text-left"},ae={class:"bg-gray-50"},oe={key:0},ne={colspan:"4"},ue={class:"border px-4 py-2"},ce=["checked","onChange"],ie={class:"border px-4 py-2"},re={class:"border px-4 py-2"},de={class:"border px-4 py-2"},ve={class:"mb-4"},pe={class:"text-gray-700"},fe={class:"mb-4"},he={class:"mb-4"},me={for:"message",class:"block text-gray-700"},_e={class:""},be={class:"flex justify-center"},ge=["disabled"],xe={key:0,class:"modal-bg"},ye={class:"modal-card"},Se={key:1},ke={key:0,class:"text-red-600 text-4xl"},Ce={key:1,class:"text-green-600 text-4xl"},we=.5,Ve={__name:"SmsSend",setup(Me){const h=K(),m=Q(),F=J(),r=a(""),o=a([]),_=a([]),S=a(""),v=a(!1),k=a(!1),p=a(!1),b=a(""),c=a(""),C=a("GSM_7BIT_EX"),w=a(0),d=a(0),f=a(160),T=a(0),g=a(!1),N=B(()=>o.value.length),M=B(()=>_.value.filter(t=>t.phone)),L=async t=>{k.value=!0,S.value=t,o.value=[],g.value=!1,t==="centers"?(await m.fetchCentersWithPhone(),_.value=[...m.institutes]):(await m.fetchInstitutesWithPhone(),_.value=[...m.institutes]),k.value=!1},j=async()=>{if(o.value.length===0){h.error="Please select at least one institute",p.value=!0,v.value=!1,c.value=h.error;return}p.value=!0,v.value=!0;const t=_.value.filter(s=>o.value.includes(s.id));try{let s=t.map(x=>x.phone).join(",");if(!(await h.sendSms({numbers:s,message:r.value})).success)throw new Error("SMS sending failed on server");b.value="SMS sent successfully!",c.value="",r.value="",o.value=[],g.value=!1,setTimeout(()=>{p.value=!1,b.value="",F.push({name:"SmsLogs"})},3e3)}catch(s){v.value=!1,b.value="",c.value=s.message||"Failed to send SMS",setTimeout(()=>{p.value=!1,c.value=""},3e3)}finally{v.value=!1}},D=t=>{const s=o.value.findIndex(l=>l===t.id);s!==-1?o.value.splice(s,1):o.value.push(t.id)},V=t=>o.value.includes(t.id),$=t=>{t.target.checked?M.value.forEach(s=>{V(s)||o.value.push(s.id)}):M.value.forEach(s=>{const l=o.value.findIndex(x=>x===s.id);l!==-1&&o.value.splice(l,1)})},A=()=>{const t=r.value.length;/^[\x00-\x7F]*$/.test(r.value)?(C.value="GSM_7BIT_EX",w.value=t,t<=160?(d.value=1,f.value=160-t):(d.value=Math.ceil(t/153),f.value=153-t%153)):(C.value="UTF16",w.value=t,t<=70?(d.value=1,f.value=70-t):(d.value=Math.ceil(t/67),f.value=67-t%67)),T.value=d.value*we};return U(r,()=>{A()}),(t,s)=>(u(),i("div",Y,[s[10]||(s[10]=e("h2",{class:"title-xl text-center"},"এসএমএস পাঠান",-1)),e("div",Z,[e("button",{class:I(["btn-1",{"btn-2":S.value==="all"}]),onClick:s[0]||(s[0]=l=>L("all"))}," সকল মাদরাসা ",2),e("button",{class:I(["btn-1",{"btn-2":S.value==="centers"}]),onClick:s[1]||(s[1]=l=>L("centers"))}," মারকায মাদরাসা ",2)]),e("div",null,[e("div",ee,[e("label",null,[E(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=l=>g.value=l),onChange:$},null,544),[[z,g.value]]),s[4]||(s[4]=y(" Select/Deselect All "))])]),e("div",se,[e("div",te,[e("table",le,[s[5]||(s[5]=e("thead",{class:"bg-gray-200 sticky top-0 z-10"},[e("tr",null,[e("th",{class:"border px-4 py-2"},"সিলেক্ট"),e("th",{class:"border px-4 py-2"},"ইলহাক"),e("th",{class:"border px-4 py-2"},"মাদরাসার নাম ও ঠিকানা"),e("th",{class:"border px-4 py-2"},"ফোন নাম্বার")])],-1)),e("tbody",ae,[k.value?(u(),i("tr",oe,[e("td",ne,[G(P,{class:"shadow-none"})])])):(u(!0),i(W,{key:1},X(M.value,l=>(u(),i("tr",{key:l.id},[e("td",ue,[e("input",{type:"checkbox",checked:V(l),onChange:x=>D(l)},null,40,ce)]),e("td",ie,n(l.institute_code),1),e("td",re,n(l.name),1),e("td",de,n(l.phone),1)]))),128))])])])])]),e("div",ve,[e("p",pe,"নাম্বার নির্বাচন করা হয়েছে: "+n(N.value)+" টি",1)]),e("div",fe,[e("p",null,[s[6]||(s[6]=e("strong",null,"প্রতি SMS:",-1)),y(" "+n(T.value)+" টাকা",1)])]),e("div",he,[e("label",me,[s[7]||(s[7]=y("Message (")),e("span",null,n(d.value),1),y(") ভাষা: "+n(C.value),1)]),e("div",_e,[E(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=l=>r.value=l),class:"input-1 w-full",rows:"4"},null,512),[[O,r.value]]),e("p",null,n(w.value)+"/"+n(f.value),1)])]),e("div",be,[e("button",{type:"submit",class:"btn-2",onClick:j,disabled:R(h).loading}," Send SMS ",8,ge)]),p.value?(u(),i("div",xe,[e("div",ye,[v.value?(u(),q(P,{key:0,class:"shadow-none"})):(u(),i("div",Se,[c.value?(u(),i("span",ke,s[8]||(s[8]=[e("i",{class:"fas fa-times-circle"},null,-1)]))):(u(),i("span",Ce,s[9]||(s[9]=[e("i",{class:"fas fa-check-circle"},null,-1)]))),e("p",{class:I([{"text-green-600":!c.value,"text-red-600":c.value},"font-semibold"])},n(c.value||b.value),3)]))])])):H("",!0)]))}};export{Ve as default};
