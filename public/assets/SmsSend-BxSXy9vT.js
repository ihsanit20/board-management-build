import{r as a,i as L,B as N,c as r,a as e,n as _,j as V,M as U,y as w,f as z,F as G,e as X,t as o,v as O,b as R,k as q,h as H,d as u,L as E,s as J}from"./index-Bgyp-V2S.js";import{u as K}from"./sms-s36Wvd6Z.js";import{u as Q}from"./institute-BwwG1l8J.js";const Y={class:"my-container space-y-4 card-bg p-8"},Z={class:"flex justify-center gap-2"},ee={class:"mb-4"},se={class:"mb-4"},te={class:"overflow-y-auto max-h-64 relative"},le={class:"table-auto w-full text-left"},ae={class:"bg-gray-50"},ne={key:0},oe={colspan:"4"},ue={class:"border px-4 py-2"},ie=["checked","onChange"],ce={class:"border px-4 py-2"},re={class:"border px-4 py-2"},de={class:"border px-4 py-2"},ve={class:"mb-4"},pe={class:"text-gray-700"},he={class:"mb-4"},fe={class:"mb-4"},me={for:"message",class:"block text-gray-700"},be={class:""},_e={class:"flex justify-center"},ge=["disabled"],xe={key:0,class:"modal-bg"},ye={class:"modal-card"},Se={key:1},ke={key:0,class:"text-red-600 text-4xl"},we={key:1,class:"text-green-600 text-4xl"},Ce=.5,Be={__name:"SmsSend",setup(Ie){const g=K(),i=Q(),P=J(),d=a(""),n=a([]),v=a([]),h=a(""),f=a(!1),C=a(!1),m=a(!1),x=a(""),c=a(""),I=a("GSM_7BIT_EX"),M=a(0),p=a(0),b=a(160),A=a(0),y=a(!1),W=L(()=>n.value.length),T=L(()=>v.value.filter(t=>t.phone)),S=async t=>{C.value=!0,h.value=t,n.value=[],y.value=!1,t==="with"?(await i.fetchInstitutesWithApplications(),v.value=[...i.institutesWithApplications]):t==="without"?(await i.fetchInstitutesWithoutApplications(),v.value=[...i.institutesWithoutApplications]):t==="centers"?(await i.fetchCentersWithPhone(),v.value=[...i.institutes]):(await i.fetchInstitutesWithPhone(),v.value=[...i.institutes]),C.value=!1},$=async()=>{if(n.value.length===0){g.error="Please select at least one institute",m.value=!0,f.value=!1,c.value=g.error;return}m.value=!0,f.value=!0;const t=v.value.filter(s=>n.value.includes(s.id));try{let s=t.map(k=>k.phone).join(",");if(!(await g.sendSms({numbers:s,message:d.value})).success)throw new Error("SMS sending failed on server");x.value="SMS sent successfully!",c.value="",d.value="",n.value=[],y.value=!1,setTimeout(()=>{m.value=!1,x.value="",P.push({name:"SmsLogs"})},3e3)}catch(s){f.value=!1,x.value="",c.value=s.message||"Failed to send SMS",setTimeout(()=>{m.value=!1,c.value=""},3e3)}finally{f.value=!1}},F=t=>{const s=n.value.findIndex(l=>l===t.id);s!==-1?n.value.splice(s,1):n.value.push(t.id)},B=t=>n.value.includes(t.id),j=t=>{t.target.checked?T.value.forEach(s=>{B(s)||n.value.push(s.id)}):T.value.forEach(s=>{const l=n.value.findIndex(k=>k===s.id);l!==-1&&n.value.splice(l,1)})},D=()=>{const t=d.value.length;/^[\x00-\x7F]*$/.test(d.value)?(I.value="GSM_7BIT_EX",M.value=t,t<=160?(p.value=1,b.value=160-t):(p.value=Math.ceil(t/153),b.value=153-t%153)):(I.value="UTF16",M.value=t,t<=70?(p.value=1,b.value=70-t):(p.value=Math.ceil(t/67),b.value=67-t%67)),A.value=p.value*Ce};return N(d,()=>{D()}),(t,s)=>(u(),r("div",Y,[s[12]||(s[12]=e("h2",{class:"title-xl text-center"},"এসএমএস পাঠান",-1)),e("div",Z,[e("button",{class:_(["btn-1",{"btn-2":h.value==="all"}]),onClick:s[0]||(s[0]=l=>S("all"))}," সকল মাদরাসা ",2),e("button",{class:_(["btn-1",{"btn-2":h.value==="with"}]),onClick:s[1]||(s[1]=l=>S("with"))}," নিবন্ধন করেছে ",2),e("button",{class:_(["btn-1",{"btn-2":h.value==="without"}]),onClick:s[2]||(s[2]=l=>S("without"))}," নিবন্ধন করেনি ",2),e("button",{class:_(["btn-1",{"btn-2":h.value==="centers"}]),onClick:s[3]||(s[3]=l=>S("centers"))}," মারকায মাদরাসা ",2)]),e("div",null,[e("div",ee,[e("label",null,[V(e("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=l=>y.value=l),onChange:j},null,544),[[U,y.value]]),s[6]||(s[6]=w(" Select/Deselect All "))])]),e("div",se,[e("div",te,[e("table",le,[s[7]||(s[7]=e("thead",{class:"bg-gray-200 sticky top-0 z-10"},[e("tr",null,[e("th",{class:"border px-4 py-2"},"সিলেক্ট"),e("th",{class:"border px-4 py-2"},"ইলহাক"),e("th",{class:"border px-4 py-2"},"মাদরাসার নাম ও ঠিকানা"),e("th",{class:"border px-4 py-2"},"ফোন নাম্বার")])],-1)),e("tbody",ae,[C.value?(u(),r("tr",ne,[e("td",oe,[z(E,{class:"shadow-none"})])])):(u(!0),r(G,{key:1},X(T.value,l=>(u(),r("tr",{key:l.id},[e("td",ue,[e("input",{type:"checkbox",checked:B(l),onChange:k=>F(l)},null,40,ie)]),e("td",ce,o(l.institute_code),1),e("td",re,o(l.name),1),e("td",de,o(l.phone),1)]))),128))])])])])]),e("div",ve,[e("p",pe,"নাম্বার নির্বাচন করা হয়েছে: "+o(W.value)+" টি",1)]),e("div",he,[e("p",null,[s[8]||(s[8]=e("strong",null,"প্রতি SMS:",-1)),w(" "+o(A.value)+" টাকা",1)])]),e("div",fe,[e("label",me,[s[9]||(s[9]=w("Message (")),e("span",null,o(p.value),1),w(") ভাষা: "+o(I.value),1)]),e("div",be,[V(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=l=>d.value=l),class:"input-1 w-full",rows:"4"},null,512),[[O,d.value]]),e("p",null,o(M.value)+"/"+o(b.value),1)])]),e("div",_e,[e("button",{type:"submit",class:"btn-2",onClick:$,disabled:R(g).loading}," Send SMS ",8,ge)]),m.value?(u(),r("div",xe,[e("div",ye,[f.value?(u(),q(E,{key:0,class:"shadow-none"})):(u(),r("div",Se,[c.value?(u(),r("span",ke,s[10]||(s[10]=[e("i",{class:"fas fa-times-circle"},null,-1)]))):(u(),r("span",we,s[11]||(s[11]=[e("i",{class:"fas fa-check-circle"},null,-1)]))),e("p",{class:_([{"text-green-600":!c.value,"text-red-600":c.value},"font-semibold"])},o(c.value||x.value),3)]))])])):H("",!0)]))}};export{Be as default};
