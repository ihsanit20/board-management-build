import{_ as W,r as a,i as E,B as N,c as u,a as e,n as S,m as z,M as U,z as k,F as G,e as X,t as n,v as q,b as O,h as R,d as i,q as H}from"./index-DZMr5Sly.js";import{u as J}from"./sms-Wc0Sw0jE.js";import{u as K}from"./institute-DOYWfJPF.js";const Q={class:"my-container space-y-4 card-bg p-8"},Y={class:"flex justify-center gap-2"},Z={class:"mb-4"},ee={class:"mb-4"},se={class:"overflow-y-auto max-h-64 relative"},te={class:"table-auto w-full text-left"},le={class:"bg-gray-50"},ae={key:0},oe={class:"border px-4 py-2"},ne=["checked","onChange"],ue={class:"border px-4 py-2"},ie={class:"border px-4 py-2"},ce={class:"border px-4 py-2"},re={class:"mb-4"},de={class:"text-gray-700"},ve={class:"mb-4"},pe={class:"mb-4"},fe={for:"message",class:"block text-gray-700"},he={class:""},me={class:"flex justify-center"},be=["disabled"],ge={key:0,class:"fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},xe={class:"bg-white p-6 rounded shadow-lg text-center"},_e={key:0},ye={key:1},Se={key:0,class:"text-red-600 text-4xl"},ke={key:1,class:"text-green-600 text-4xl"},we=.5,Ie={__name:"SmsSend",setup(Me){const b=J(),d=K(),F=H(),r=a(""),o=a([]),p=a([]),g=a(""),f=a(!1),w=a(!1),L=a("all"),h=a(!1),x=a(""),c=a(""),I=a("GSM_7BIT_EX"),M=a(0),v=a(0),m=a(160),A=a(0),_=a(!1),V=E(()=>o.value.length),C=E(()=>p.value.filter(t=>t.phone)),T=async t=>{w.value=!0,g.value=t,o.value=[],_.value=!1;const s={per_page:L.value};t==="with"?(await d.fetchInstitutesWithApplications(),p.value=[...d.institutesWithApplications]):t==="without"?(await d.fetchInstitutesWithoutApplications(),p.value=[...d.institutesWithoutApplications]):(await d.fetchInstitutes(s),p.value=[...d.institutes]),w.value=!1},$=async()=>{if(o.value.length===0){b.error="Please select at least one institute",h.value=!0,f.value=!1,c.value=b.error;return}h.value=!0,f.value=!0;const t=p.value.filter(s=>o.value.includes(s.id));try{let s=t.map(y=>y.phone).join(",");if(!(await b.sendSms({numbers:s,message:r.value})).success)throw new Error("SMS sending failed on server");x.value="SMS sent successfully!",c.value="",r.value="",o.value=[],_.value=!1,setTimeout(()=>{h.value=!1,x.value="",F.push({name:"SmsLogs"})},3e3)}catch(s){f.value=!1,x.value="",c.value=s.message||"Failed to send SMS",setTimeout(()=>{h.value=!1,c.value=""},3e3)}finally{f.value=!1}},j=t=>{const s=o.value.findIndex(l=>l===t.id);s!==-1?o.value.splice(s,1):o.value.push(t.id)},B=t=>o.value.includes(t.id),D=t=>{t.target.checked?C.value.forEach(s=>{B(s)||o.value.push(s.id)}):C.value.forEach(s=>{const l=o.value.findIndex(y=>y===s.id);l!==-1&&o.value.splice(l,1)})},P=()=>{const t=r.value.length;/^[\x00-\x7F]*$/.test(r.value)?(I.value="GSM_7BIT_EX",M.value=t,t<=160?(v.value=1,m.value=160-t):(v.value=Math.ceil(t/153),m.value=153-t%153)):(I.value="UTF16",M.value=t,t<=70?(v.value=1,m.value=70-t):(v.value=Math.ceil(t/67),m.value=67-t%67)),A.value=v.value*we};return N(r,()=>{P()}),(t,s)=>(i(),u("div",Q,[s[13]||(s[13]=e("h2",{class:"title-xl text-center"},"এসএমএস পাঠান",-1)),e("div",Y,[e("button",{class:S(["btn-1",{"btn-2":g.value==="all"}]),onClick:s[0]||(s[0]=l=>T("all"))}," সকল মাদরাসা ",2),e("button",{class:S(["btn-1",{"btn-2":g.value==="with"}]),onClick:s[1]||(s[1]=l=>T("with"))}," নিবন্ধন করেছে ",2),e("button",{class:S(["btn-1",{"btn-2":g.value==="without"}]),onClick:s[2]||(s[2]=l=>T("without"))}," নিবন্ধন করেনি ",2)]),e("div",null,[e("div",Z,[e("label",null,[z(e("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=l=>_.value=l),onChange:D},null,544),[[U,_.value]]),s[5]||(s[5]=k(" Select/Deselect All "))])]),e("div",ee,[e("div",se,[e("table",te,[s[7]||(s[7]=e("thead",{class:"bg-gray-200 sticky top-0 z-10"},[e("tr",null,[e("th",{class:"border px-4 py-2"},"সিলেক্ট"),e("th",{class:"border px-4 py-2"},"ইলহাক"),e("th",{class:"border px-4 py-2"},"মাদরাসার নাম ও ঠিকানা"),e("th",{class:"border px-4 py-2"},"ফোন নাম্বার")])],-1)),e("tbody",le,[w.value?(i(),u("tr",ae,s[6]||(s[6]=[e("td",{colspan:"4",class:"text-center py-4"},[e("div",{class:"loader mx-auto"})],-1)]))):(i(!0),u(G,{key:1},X(C.value,l=>(i(),u("tr",{key:l.id},[e("td",oe,[e("input",{type:"checkbox",checked:B(l),onChange:y=>j(l)},null,40,ne)]),e("td",ue,n(l.institute_code),1),e("td",ie,n(l.name),1),e("td",ce,n(l.phone),1)]))),128))])])])])]),e("div",re,[e("p",de,"নাম্বার নির্বাচন করা হয়েছে: "+n(V.value)+" টি",1)]),e("div",ve,[e("p",null,[s[8]||(s[8]=e("strong",null,"প্রতি SMS:",-1)),k(" "+n(A.value)+" টাকা",1)])]),e("div",pe,[e("label",fe,[s[9]||(s[9]=k("Message (")),e("span",null,n(v.value),1),k(") ভাষা: "+n(I.value),1)]),e("div",he,[z(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=l=>r.value=l),class:"input-1 w-full",rows:"4"},null,512),[[q,r.value]]),e("p",null,n(M.value)+"/"+n(m.value),1)])]),e("div",me,[e("button",{type:"submit",class:"btn-2",onClick:$,disabled:O(b).loading}," Send SMS ",8,be)]),h.value?(i(),u("div",ge,[e("div",xe,[f.value?(i(),u("div",_e,s[10]||(s[10]=[e("div",{class:"loader mx-auto"},null,-1),e("p",null,"Sending SMS...",-1)]))):(i(),u("div",ye,[c.value?(i(),u("span",Se,s[11]||(s[11]=[e("i",{class:"fas fa-times-circle"},null,-1)]))):(i(),u("span",ke,s[12]||(s[12]=[e("i",{class:"fas fa-check-circle"},null,-1)]))),e("p",{class:S([{"text-green-600":!c.value,"text-red-600":c.value},"font-semibold"])},n(c.value||x.value),3)]))])])):R("",!0)]))}},Be=W(Ie,[["__scopeId","data-v-50c9ad9b"]]);export{Be as default};
