import{P as c,Q as n}from"./index-_aqdL-fb.js";const d=c("application",{state:()=>({applications:[],zamatCounts:[],userCounts:[],application:null,loading:!1,error:null,showStatusModal:!1,totalApplications:0,pendingApplications:0,paidApplications:0,totalStudents:0,onlineApplications:0,offlineApplications:0,pagination:{current_page:1,last_page:1,per_page:15,total:0}}),actions:{async fetchApplications(e={}){var i,t;this.loading=!0,this.error=null;try{const a=await n.get("/applications",{params:e});this.applications=a.data.data||[],this.pagination={current_page:a.data.current_page||1,last_page:a.data.last_page||1,per_page:a.data.per_page||15,total:a.data.total||0},console.log("Pagination:",this.pagination)}catch(a){this.error=((t=(i=a.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to fetch applications",this.applications=[]}finally{this.loading=!1}},async fetchApplicationsPrint(e={}){var i,t;this.loading=!0,this.error=null;try{const a=await n.get("/applications/print",{params:e});this.applications=a.data,console.log(this.applications)}catch(a){this.error=((t=(i=a.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to fetch applications"}finally{this.loading=!1}},async fetchApplication(e,i={}){var t,a;this.loading=!0,this.error=null;try{const s=await n.get(`/applications/${e}`,{params:i});this.application=s.data}catch(s){this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to fetch application"}finally{this.loading=!1}},async fetchPublicApplication(e,i){var t,a;this.loading=!0,this.error=null,this.application=null;try{const s=await n.get("/applications/public-show",{params:{application_id:e,institute_code:i}});this.application=s.data}catch(s){this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to fetch public application"}finally{this.loading=!1}},async createApplication(e){var i,t;this.loading=!0,this.error=null;try{const a=await n.post("/applications",e);return this.applications.push(a.data.application),this.application=a.data.application,a.data.application}catch(a){throw this.error=((t=(i=a.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to create application",a}finally{this.loading=!1}},async updateApplication(e,i){var t,a;this.loading=!0,this.error=null;try{const s=await n.put(`/applications/${e}`,i),o=this.applications.findIndex(r=>r.id===e);o!==-1&&(this.applications[o]=s.data)}catch(s){this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update application"}finally{this.loading=!1}},async deleteApplication(e,{refetch:i=!0,params:t={}}={}){var a,s,o;this.loading=!0,this.error=null;try{await n.delete(`/applications/${e}`);const r=Number(e);if(this.applications=this.applications.filter(p=>Number(p.id)!==r),((a=this.pagination)==null?void 0:a.total)>0&&(this.pagination.total-=1),i){const l=this.applications.length===0&&this.pagination.current_page>1?this.pagination.current_page-1:this.pagination.current_page;await this.fetchApplications({...t,page:l})}return!0}catch(r){return this.error=((o=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:o.message)||"Failed to delete application",!1}finally{this.loading=!1}},async fetchMatchingPayments(e){var i,t;this.error=null;try{const{data:a}=await n.get(`/applications/${e}/matching-payments`);return(a==null?void 0:a.data)||[]}catch(a){return this.error=((t=(i=a.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to fetch matching payments",[]}},async updatePaymentStatus(e,i){var t,a;this.loading=!0,this.error=null;try{const s=typeof i=="string"?{payment_status:i}:i,{data:o}=await n.patch(`/applications/${e}/payment-status`,s),r=this.applications.findIndex(p=>Number(p.id)===Number(e));return r!==-1&&(s!=null&&s.payment_status&&(this.applications[r].payment_status=s.payment_status),o!=null&&o.linked_payment_id&&(this.applications[r].payment_id=o.linked_payment_id)),o}catch(s){throw this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update payment status",s}finally{this.loading=!1}},async bkashCreatePayment(e,i={}){var t,a;this.error=null;try{return(await n.post(`/applications/${e}/bkash-create-payment`,i)).data}catch(s){this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to create bkash payment"}},async bkashExecutePayment(e,i={}){var t,a;this.loading=!0,this.error=null;try{return await n.post(`/applications/${e}/bkash-execute-payment`,i)}catch(s){this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to execute bkash payment"}finally{this.loading=!1}},findApplicationById(e){return this.applications.find(i=>parseInt(i.id)===parseInt(e))},async fetchApplicationCounts(){var e,i;this.loading=!0,this.error=null;try{const{data:t}=await n.get("/applications/counts");this.totalApplications=t.totalApplications,this.pendingApplications=t.pendingApplications,this.paidApplications=t.paidApplications,this.totalStudents=t.totalStudents,this.onlineApplications=t.onlineApplications??0,this.offlineApplications=t.offlineApplications??0}catch(t){this.error=((i=(e=t.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to fetch application counts"}finally{this.loading=!1}},async fetchZamatWiseCounts(){var e,i;this.loading=!0,this.error=null;try{const t=await n.get("/applications/zamat-wise-counts");this.zamatCounts=t.data}catch(t){this.error=((i=(e=t.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to fetch zamat-wise application counts"}finally{this.loading=!1}},async fetchUserWiseCounts(){var e,i;this.loading=!0,this.error=null;try{const t=await n.get("/applications/user-wise-counts");this.userCounts=t.data}catch(t){this.error=((i=(e=t.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to fetch user-wise counts"}finally{this.loading=!1}},async updateRegistrationPart(e,i){var t,a;this.loading=!0,this.error=null;try{const s=await n.put(`/applications/${e}/update-registration`,i);return this.application=s.data.application,s.data.application}catch(s){throw this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update registration information",s}finally{this.loading=!1}},async updateStudentsPart(e,i){var t,a;this.loading=!0,this.error=null;try{const s=await n.put(`/applications/${e}/update-students`,i);return this.application=s.data.application,s.data.application}catch(s){throw this.error=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update students information",s}finally{this.loading=!1}}}});export{d as u};
