import{P as A,Q as r}from"./index-VisWtOtk.js";const x=A("application",{state:()=>({applications:[],zamatCounts:[],userCounts:[],application:null,print:{exam_id:null,per_page:10,pages:[]},loading:!1,error:null,showStatusModal:!1,totalApplications:0,pendingApplications:0,paidApplications:0,totalStudents:0,onlineApplications:0,offlineApplications:0,pagination:{current_page:1,last_page:1,per_page:15,total:0},centerZamatSummary:[],centerZamatGrandTotal:0,centerZamatExamId:null}),actions:{async fetchApplications(n={}){var i,a;this.loading=!0,this.error=null;try{const t=await r.get("/applications",{params:n});this.applications=t.data.data||[],this.pagination={current_page:t.data.current_page||1,last_page:t.data.last_page||1,per_page:t.data.per_page||15,total:t.data.total||0},console.log("Pagination:",this.pagination)}catch(t){this.error=((a=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to fetch applications",this.applications=[]}finally{this.loading=!1}},async fetchApplicationsPrint(n={}){var i,a,t,e;this.loading=!0,this.error=null;try{const l={per_page:n.per_page??10,status:n.status??"Paid",...n},{data:o}=await r.get("/applications/print",{params:l});if(o&&Array.isArray(o.pages))return this.print={exam_id:o.exam_id??null,per_page:Number(o.per_page??l.per_page??10),pages:o.pages},this.applications=[],this.print;if(Array.isArray(o)){const p=o.map(s=>{var h,d,u,g,m,f,y;return{meta:{generated_at:new Date().toISOString(),exam:{id:null,name:""},institute:{id:null,name:((u=(d=(h=s==null?void 0:s.institute_code_name)==null?void 0:h.split(" - "))==null?void 0:d.slice(1))==null?void 0:u.join(" - "))||"",code:((m=(g=s==null?void 0:s.institute_code_name)==null?void 0:g.split(" - "))==null?void 0:m[0])||""},zamat:{id:null,name:(s==null?void 0:s.zamat_name)||""},area_name:(s==null?void 0:s.area_name)||"",center_name:(s==null?void 0:s.center_name)||"",group_name:(s==null?void 0:s.group_name)||"",page:1,pages:1,per_page:((f=s==null?void 0:s.students)==null?void 0:f.length)??0,total_students:((y=s==null?void 0:s.students)==null?void 0:y.length)??0},students:((s==null?void 0:s.students)??[]).map((c,_)=>({sl:_+1,name:(c==null?void 0:c.name)||"",father_name:(c==null?void 0:c.father_name)||"",date_of_birth:(c==null?void 0:c.date_of_birth)||null,para:(c==null?void 0:c.para)??null,address:(c==null?void 0:c.address)||"",application_id:(s==null?void 0:s.id)??null,application_date:(s==null?void 0:s.application_date)||null,area_name:(s==null?void 0:s.area_name)||"",center_name:(s==null?void 0:s.center_name)||"",group_name:(s==null?void 0:s.group_name)||""}))}});return this.print={exam_id:n.exam_id??null,per_page:((a=(i=p[0])==null?void 0:i.meta)==null?void 0:a.per_page)??10,pages:p},this.applications=[],this.print}throw this.print={exam_id:null,per_page:10,pages:[]},new Error("Unexpected print response shape")}catch(l){return this.error=((e=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:e.message)||(l==null?void 0:l.message)||"Failed to fetch applications",this.print={exam_id:null,per_page:10,pages:[]},null}finally{this.loading=!1}},async fetchApplication(n,i={}){var a,t;this.loading=!0,this.error=null;try{const e=await r.get(`/applications/${n}`,{params:i});this.application=e.data}catch(e){this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to fetch application"}finally{this.loading=!1}},async fetchPublicApplication(n,i){var a,t;this.loading=!0,this.error=null,this.application=null;try{const e=await r.get("/applications/public-show",{params:{application_id:n,institute_code:i}});this.application=e.data}catch(e){this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to fetch public application"}finally{this.loading=!1}},async createApplication(n){var i,a;this.loading=!0,this.error=null;try{const t=await r.post("/applications",n);return this.applications.push(t.data.application),this.application=t.data.application,t.data.application}catch(t){throw this.error=((a=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to create application",t}finally{this.loading=!1}},async updateApplication(n,i){var a,t;this.loading=!0,this.error=null;try{const e=await r.put(`/applications/${n}`,i),l=this.applications.findIndex(o=>o.id===n);l!==-1&&(this.applications[l]=e.data)}catch(e){this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update application"}finally{this.loading=!1}},async deleteApplication(n,{refetch:i=!0,params:a={}}={}){var t,e,l;this.loading=!0,this.error=null;try{await r.delete(`/applications/${n}`);const o=Number(n);if(this.applications=this.applications.filter(p=>Number(p.id)!==o),((t=this.pagination)==null?void 0:t.total)>0&&(this.pagination.total-=1),i){const s=this.applications.length===0&&this.pagination.current_page>1?this.pagination.current_page-1:this.pagination.current_page;await this.fetchApplications({...a,page:s})}return!0}catch(o){return this.error=((l=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to delete application",!1}finally{this.loading=!1}},async fetchMatchingPayments(n){var i,a;this.error=null;try{const{data:t}=await r.get(`/applications/${n}/matching-payments`);return(t==null?void 0:t.data)||[]}catch(t){return this.error=((a=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to fetch matching payments",[]}},async updatePaymentStatus(n,i){var a,t;this.loading=!0,this.error=null;try{const e=typeof i=="string"?{payment_status:i}:i,{data:l}=await r.patch(`/applications/${n}/payment-status`,e),o=this.applications.findIndex(p=>Number(p.id)===Number(n));return o!==-1&&(e!=null&&e.payment_status&&(this.applications[o].payment_status=e.payment_status),l!=null&&l.linked_payment_id&&(this.applications[o].payment_id=l.linked_payment_id)),l}catch(e){throw this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update payment status",e}finally{this.loading=!1}},async bkashCreatePayment(n,i={}){var a,t;this.error=null;try{return(await r.post(`/applications/${n}/bkash-create-payment`,i)).data}catch(e){this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to create bkash payment"}},async bkashExecutePayment(n,i={}){var a,t;this.loading=!0,this.error=null;try{return await r.post(`/applications/${n}/bkash-execute-payment`,i)}catch(e){this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to execute bkash payment"}finally{this.loading=!1}},findApplicationById(n){return this.applications.find(i=>parseInt(i.id)===parseInt(n))},async fetchApplicationCounts(){var n,i;this.loading=!0,this.error=null;try{const{data:a}=await r.get("/applications/counts");this.totalApplications=a.totalApplications,this.pendingApplications=a.pendingApplications,this.paidApplications=a.paidApplications,this.totalStudents=a.totalStudents,this.onlineApplications=a.onlineApplications??0,this.offlineApplications=a.offlineApplications??0}catch(a){this.error=((i=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to fetch application counts"}finally{this.loading=!1}},async fetchZamatWiseCounts(){var n,i;this.loading=!0,this.error=null;try{const a=await r.get("/applications/zamat-wise-counts");this.zamatCounts=a.data}catch(a){this.error=((i=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to fetch zamat-wise application counts"}finally{this.loading=!1}},async fetchUserWiseCounts(){var n,i;this.loading=!0,this.error=null;try{const a=await r.get("/applications/user-wise-counts");this.userCounts=a.data}catch(a){this.error=((i=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to fetch user-wise counts"}finally{this.loading=!1}},async updateRegistrationPart(n,i){var a,t;this.loading=!0,this.error=null;try{const e=await r.put(`/applications/${n}/update-registration`,i);return this.application=e.data.application,e.data.application}catch(e){throw this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update registration information",e}finally{this.loading=!1}},async updateStudentsPart(n,i){var a,t;this.loading=!0,this.error=null;try{const e=await r.put(`/applications/${n}/update-students`,i);return this.application=e.data.application,e.data.application}catch(e){throw this.error=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update students information",e}finally{this.loading=!1}},async fetchCenterZamatStudents(n={}){var i,a;this.loading=!0,this.error=null;try{const{data:t}=await r.get("/applications/center-zamat-students",{params:n});return this.centerZamatExamId=(t==null?void 0:t.exam_id)??null,this.centerZamatGrandTotal=Number((t==null?void 0:t.grand_total)??0),this.centerZamatSummary=Array.isArray(t==null?void 0:t.centers)?t.centers:[],{exam_id:this.centerZamatExamId,grand_total:this.centerZamatGrandTotal,centers:this.centerZamatSummary}}catch(t){return this.error=((a=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to fetch center-zamat student summary",this.centerZamatExamId=null,this.centerZamatGrandTotal=0,this.centerZamatSummary=[],null}finally{this.loading=!1}}}});export{x as u};
