import{P as C,r as s,i as E,Q as p}from"./index-wkA3WKam.js";const Q=C("applicationPayment",()=>{const o=s([]),m=s(null),u=s(!1),i=s(null),g=s(null),y=s(!1),v=s(null),_=s(null),h=s(!1),w=s(null),n=s({total:0,per_page:20,current_page:1,last_page:1}),f=s({exam_id:"",institute_id:"",zamat_id:"",application_id:"",status:"all",method:"all",q:"",date_from:"",date_to:"",sort:"paid_at",order:"desc",per_page:20,page:1}),N=E(()=>n.value.current_page<n.value.last_page),x=E(()=>n.value.current_page>1);function F(l={}){const t={...f.value,...l},r={};return t.exam_id&&(r.exam_id=Number(t.exam_id)),t.institute_id&&(r.institute_id=Number(t.institute_id)),t.zamat_id&&(r.zamat_id=Number(t.zamat_id)),t.application_id&&(r.application_id=Number(t.application_id)),t.status&&t.status!=="all"&&(r.status=t.status),t.method&&t.method!=="all"&&(r.method=t.method),t.q&&(r.q=t.q),t.date_from&&(r.date_from=t.date_from),t.date_to&&(r.date_to=t.date_to),r.sort=["paid_at","created_at","amount","id"].includes(t.sort)?t.sort:"paid_at",r.order=t.order==="asc"?"asc":"desc",r.per_page=t.per_page||20,r.page=t.page||1,r}function b(l){f.value.page=l||1}function q(){f.value={exam_id:"",institute_id:"",zamat_id:"",application_id:"",status:"all",method:"all",q:"",date_from:"",date_to:"",sort:"paid_at",order:"desc",per_page:20,page:1}}async function A(l={}){var t,r;u.value=!0,i.value=null;try{const a=F(l),{data:e}=await p.get("/application-payments",{params:a}),d=Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e)?e:[];return o.value=d,Array.isArray(e)?n.value={total:d.length,per_page:d.length,current_page:1,last_page:1}:n.value={total:Number((e==null?void 0:e.total)??0),per_page:Number((e==null?void 0:e.per_page)??a.per_page??20),current_page:Number((e==null?void 0:e.current_page)??a.page??1),last_page:Number((e==null?void 0:e.last_page)??1)},o.value}catch(a){return console.error("Error fetching payments:",a),i.value=((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"Failed to fetch payments",[]}finally{u.value=!1}}async function z(l){var t,r;u.value=!0,i.value=null;try{const{data:a}=await p.get(`/application-payments/${l}`);return m.value=a||null,m.value}catch(a){throw console.error("Error fetching payment by id:",a),i.value=((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"Failed to fetch payment",a}finally{u.value=!1}}async function B(){return N.value?(b(n.value.current_page+1),A()):[]}async function S(){return x.value?(b(n.value.current_page-1),A()):[]}async function L(l={}){var t,r;u.value=!0,i.value=null;try{const{data:a}=await p.post("/application-payments",l);return m.value=a||null,Array.isArray(o.value)&&(o.value=[a,...o.value],n.value.total=Number(n.value.total||0)+1),a}catch(a){throw console.error("Error creating payment:",a),i.value=((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"Failed to create payment",a}finally{u.value=!1}}async function $(l=[]){var t,r;if(!Array.isArray(l)||l.length===0)throw new Error("No items to create.");u.value=!0,i.value=null;try{const a={items:l},{data:e,status:d}=await p.post("/application-payments",a),c=Array.isArray(e==null?void 0:e.items)?e.items:[],P=Number((e==null?void 0:e.count)??c.length);return c.length&&(m.value=c[0]),Array.isArray(o.value)&&c.length&&(o.value=[...c,...o.value]),n.value.total=Number(n.value.total||0)+P,{count:P,items:c,status:d}}catch(a){throw console.error("Error creating payments (bulk):",a),i.value=((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"Failed to create payments (bulk)",a}finally{u.value=!1}}async function k(l,t={}){var r,a;y.value=!0,v.value=null,g.value=null;try{const{data:e}=await p.get(`/application-payments/exams/${l}`,{params:t});return g.value=e,e}catch(e){throw v.value=((a=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:a.message)||(e==null?void 0:e.message)||"Failed to load",e}finally{y.value=!1}}async function I(l,t){var r,a;h.value=!0,w.value=null,_.value=null;try{const{data:e}=await p.get(`/application-payments/${l}/institutes/${t}`);return _.value=e,e}catch(e){throw w.value=((a=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:a.message)||(e==null?void 0:e.message)||"Failed to load",e}finally{h.value=!1}}return{rows:o,selected:m,isLoading:u,error:i,meta:n,filters:f,hasNext:N,hasPrev:x,fetchPayments:A,fetchPaymentById:z,nextPage:B,prevPage:S,setPage:b,resetFilters:q,createPayment:L,createPaymentsBulk:$,fetchListByExam:k,fetchShowByExamInstitute:I,listByExam:g,loadingList:y,errorList:v,showData:_,loadingShow:h,errorShow:w}});export{Q as u};
