import{P as W,r as b,O as v,i as B,Q as m}from"./index-VisWtOtk.js";const O=W("committee",()=>{const l=b([]),c=b(null),s=v({}),n=v({list:!1,show:!1,members:{},saving:!1,deleting:!1,reordering:!1}),y=v({active:null}),h=B(()=>{var e;return!!((e=c.value)!=null&&e.id)});async function g(e={}){try{n.list=!0;const r=e.active===void 0?y.active:e.active,a=await m.get("/committees",{params:{...r===null?{}:{active:r}}});return l.value=Array.isArray(a.data)?a.data:[],y.active=r??null,l.value}catch(r){throw console.error("fetchCommittees error",r),r}finally{n.list=!1}}async function w(e){var r;try{n.show=!0;const a=await m.get(`/committees/${e}`);return c.value=a.data,Array.isArray((r=a.data)==null?void 0:r.members)&&(s[e]=a.data.members),a.data}catch(a){throw console.error("getCommittee error",a),a}finally{n.show=!1}}async function A(e){var r;try{n.saving=!0;const a=await m.post("/committees",e),o={...a.data,members_count:Array.isArray((r=a.data)==null?void 0:r.members)?a.data.members.length:0};return l.value.unshift(o),o}catch(a){throw console.error("createCommittee error",a),a}finally{n.saving=!1}}async function C(e,r){var a,o,u;try{n.saving=!0;const t=await m.put(`/committees/${e}`,r),i={...t.data,members_count:Array.isArray((a=t.data)==null?void 0:a.members)?t.data.members.length:0};((o=c.value)==null?void 0:o.id)===e&&(c.value=t.data,Array.isArray((u=t.data)==null?void 0:u.members)&&(s[e]=t.data.members));const f=l.value.findIndex(d=>d.id===e);return f!==-1&&(l.value[f]={...l.value[f],...i}),i}catch(t){throw console.error("updateCommittee error",t),t}finally{n.saving=!1}}async function p(e){var r;try{n.deleting=!0,await m.delete(`/committees/${e}`),l.value=l.value.filter(a=>a.id!==e),((r=c.value)==null?void 0:r.id)===e&&(c.value=null),delete s[e]}catch(a){throw console.error("deleteCommittee error",a),a}finally{n.deleting=!1}}async function M(e){try{n.members[e]=!0;const r=await m.get(`/committees/${e}/members`);return s[e]=Array.isArray(r.data)?r.data:[],s[e]}catch(r){throw console.error("fetchMembers error",r),r}finally{n.members[e]=!1}}async function x(e,r){var a,o;try{n.saving=!0;const u=await m.post(`/committees/${e}/members`,r);Array.isArray(s[e])||(s[e]=[]),s[e].push(u.data);const t=l.value.findIndex(i=>i.id===e);if(t!==-1){const i=((a=l.value[t])==null?void 0:a.members_count)??0;l.value[t]={...l.value[t],members_count:i+1}}return((o=c.value)==null?void 0:o.id)===e&&(c.value.members=s[e]),u.data}catch(u){throw console.error("createMember error",u),u}finally{n.saving=!1}}async function $(e,r,a=null){var o,u;try{n.saving=!0;const t=await m.put(`/members/${e}`,r),i=a??((o=c.value)==null?void 0:o.id)??null;if(i&&Array.isArray(s[i])){const f=s[i].findIndex(d=>d.id===e);f!==-1&&(s[i][f]={...s[i][f],...t.data}),((u=c.value)==null?void 0:u.id)===i&&(c.value.members=s[i])}return t.data}catch(t){throw console.error("updateMember error",t),t}finally{n.saving=!1}}async function _(e,r){var a,o;try{if(n.deleting=!0,await m.delete(`/members/${e}`),r&&Array.isArray(s[r])){const u=s[r].length;s[r]=s[r].filter(i=>i.id!==e);const t=l.value.findIndex(i=>i.id===r);if(t!==-1){const i=((a=l.value[t])==null?void 0:a.members_count)??u;l.value[t]={...l.value[t],members_count:Math.max(0,i-1)}}((o=c.value)==null?void 0:o.id)===r&&(c.value.members=s[r])}}catch(u){throw console.error("deleteMember error",u),u}finally{n.deleting=!1}}async function P(e,r){var a;try{n.reordering=!0;const o=await m.post(`/committees/${e}/members/reorder`,{orders:r});return s[e]=Array.isArray(o.data)?o.data:[],((a=c.value)==null?void 0:a.id)===e&&(c.value.members=s[e]),o.data}catch(o){throw console.error("reorderMembers error",o),o}finally{n.reordering=!1}}async function S(){try{n.list=!0;const e=await m.get("/committees-with-members"),r=Array.isArray(e.data)?e.data:[];return l.value=r,r.forEach(a=>{s[a.id]=Array.isArray(a.members)?a.members:[]}),r}catch(e){throw console.error("fetchPublicCommitteesWithMembers error",e),e}finally{n.list=!1}}return{committees:l,currentCommittee:c,membersByCommittee:s,loading:n,paramsState:y,hasCurrent:h,fetchCommittees:g,getCommittee:w,createCommittee:A,updateCommittee:C,deleteCommittee:p,fetchMembers:M,createMember:x,updateMember:$,deleteMember:_,reorderMembers:P,fetchPublicCommitteesWithMembers:S}});export{O as u};
