import{P as K,r as l,O as A,i as R,Q as r}from"./index-CBPYhcDR.js";const V=K("institute-application",()=>{const g=l([]),f=l(null),v=l(null),q=l(null),y=l(!1),d=l(!1),h=l(!1),_=l(!1),m=l(!1),w=l(!1),F=l(!1),$=l(!1),b=l(!1),k=l(!1),I=l(!1),j=l(!1),o=l(""),i=A({status:"",type:"",q:"",area_id:"",institute_id:"",date_from:"",date_to:"",page:1,per_page:20}),p=A({current_page:1,per_page:20,total:0,last_page:1}),L=R(()=>!!o.value);function O(s={}){try{Object.assign(i,s),"per_page"in s&&(p.per_page=Number(s.per_page)||20)}catch{}}function E(){i.status="",i.type="",i.q="",i.area_id="",i.institute_id="",i.date_from="",i.date_to="",i.page=1,i.per_page=20}function c(){o.value=""}async function S(s){var n,e;h.value=!0,c();try{const{data:t}=await r.post("/institute-applications",s);return t}catch(t){throw o.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to submit application.",t}finally{h.value=!1}}async function x(s,n=null){var e,t;k.value=!0,c();try{const{data:a}=await r.get("/institute-applications/suggest-matches",{params:{q:s,area_id:n}});return a}catch(a){throw o.value=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to fetch suggestions.",a}finally{k.value=!1}}async function C(s){var n,e;I.value=!0,c();try{const{data:t}=await r.get("/institute-applications/prefill",{params:{institute_id:s}});return t}catch(t){throw o.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to load prefill data.",t}finally{I.value=!1}}async function D(s){var n,e;j.value=!0,c();try{const{data:t}=await r.get(`/institute-applications/${s}/track`);return q.value=t,t}catch(t){throw o.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to fetch tracking info.",t}finally{j.value=!1}}async function M(s={}){var n,e;y.value=!0,c();try{const t={status:i.status||void 0,type:i.type||void 0,q:i.q||void 0,area_id:i.area_id||void 0,institute_id:i.institute_id||void 0,date_from:i.date_from||void 0,date_to:i.date_to||void 0,per_page:i.per_page||p.per_page,page:i.page||p.current_page,...s},{data:a}=await r.get("/institute-applications",{params:t});return g.value=(a==null?void 0:a.data)||[],p.current_page=(a==null?void 0:a.current_page)??1,p.per_page=(a==null?void 0:a.per_page)??t.per_page??20,p.total=(a==null?void 0:a.total)??0,p.last_page=(a==null?void 0:a.last_page)??1,a}catch(t){throw o.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to load applications.",t}finally{y.value=!1}}async function P(s){var n,e;d.value=!0,c();try{const{data:t}=await r.get(`/institute-applications/${s}`);return f.value=t,t}catch(t){throw o.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to load application.",t}finally{d.value=!1}}async function Q(s){var n,e;d.value=!0,c();try{const{data:t}=await r.get(`/institute-applications/${s}/diff`);return v.value=t,t}catch(t){throw o.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to load diff.",t}finally{d.value=!1}}async function T(s,{merge_plan:n=null,edited_values:e=null}={}){var t,a;_.value=!0,c();try{const{data:u}=await r.post(`/institute-applications/${s}/approve`,{...n?{merge_plan:n}:{},...e?{edited_values:e}:{}});return u}catch(u){throw o.value=((a=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to approve application.",u}finally{_.value=!1}}async function z(s,n){var e,t;m.value=!0,c();try{const{data:a}=await r.post(`/institute-applications/${s}/reject`,{admin_notes:n});return a}catch(a){throw o.value=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to reject application.",a}finally{m.value=!1}}async function B(s,n){var e,t;w.value=!0,c();try{const{data:a}=await r.post(`/institute-applications/${s}/needs-info`,{admin_notes:n});return a}catch(a){throw o.value=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to mark as needs info.",a}finally{w.value=!1}}async function G(s,n){var e,t;F.value=!0,c();try{const{data:a}=await r.post(`/institute-applications/${s}/attach`,{target_institute_id:n});return a}catch(a){throw o.value=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to attach application.",a}finally{F.value=!1}}async function H(s,n={}){var e,t;$.value=!0,c();try{const{data:a}=await r.patch(`/institute-applications/${s}`,n);return a}catch(a){throw o.value=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to update application.",a}finally{$.value=!1}}async function J(s){var n,e,t,a;b.value=!0,c();try{return await r.delete(`/institute-applications/${s}`),g.value=g.value.filter(u=>{var N;return(u.id??((N=u==null?void 0:u.application)==null?void 0:N.id))!==Number(s)}),f.value&&(f.value.id===Number(s)||((e=(n=f.value)==null?void 0:n.application)==null?void 0:e.id)===Number(s))&&(f.value=null,v.value=null),!0}catch(u){throw o.value=((a=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete application.",u}finally{b.value=!1}}return{items:g,current:f,diff:v,trackInfo:q,loadingList:y,loadingItem:d,saving:h,approving:_,rejecting:m,needingInfo:w,attaching:F,updating:$,deleting:b,suggesting:k,prefillLoading:I,tracking:j,error:o,hasError:L,filters:i,pagination:p,setFilters:O,resetFilters:E,clearError:c,submitApplication:S,suggestMatches:x,prefill:C,track:D,fetchList:M,fetchOne:P,fetchDiff:Q,approve:T,reject:z,needsInfo:B,attachToInstitute:G,updateApplication:H,destroy:J}});export{V as u};
